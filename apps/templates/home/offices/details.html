{% extends 'layouts/base.html' %}

{% block title %} {{ office.company_name }} {% endblock title %}

{% block stylesheets %}

    <style>
        .pointer-hover:hover {
            cursor: pointer;
        }
        .rotate {
            transition: transform 0.3s ease;
        }
        .rotate.down {
            transform: rotate(180deg);
        }
        .dropzone {
            border: 0;
            padding: 0 0;
        }
        .dropzone .dz-message{
            margin: 0 0;
        }
        .dz-preview .dz-error-message {
            display: none !important;
        }
        .dropzone .dz-preview .dz-remove {
            display: none;
        }
    </style>

{% endblock stylesheets %}

{% block content %}

{% load filters %}

<!-- Header container -->
<div class="header bg-primary pb-6">
    <div class="container-fluid">
        <div class="header-body">
            <div class="row align-items-center py-4">
                <div class="col-lg-6 col-7">
                    <nav aria-label="breadcrumb" class="d-none d-md-inline-block ml-md-4">
                        <ol class="breadcrumb breadcrumb-links breadcrumb-dark">
                            <li class="breadcrumb-item">
                                <a href="/">
                                    <i class="fas fa-home"></i>
                                </a>
                            </li>
                            <li class="breadcrumb-item">
                                <a href="{% url 'offices_home' %}">
                                    Offices
                                </a>
                            </li>
                            <li class="breadcrumb-item active">
                                {{ office.company_name|default:office.slug|truncatechars:25 }}
                            </li>
                        </ol>
                    </nav>
                </div>
                <div class="col-lg-6 col-5 text-right">
                    <a href="#" data-toggle="modal" data-target="#editOfficeModal" class="btn btn-sm btn-neutral"><i class="fas fa-cog"></i></a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Page content -->
<div class="container-fluid mt--6" style="min-height: calc(100vh - 274px)">

    <!-- Office Infos Row -->
    <div class="row">
    
        <!-- Office Title Column -->
        <div class="{% if office.municipal_inscription or office.state_inscription or office.duns or office.fantasy_name %}col-lg-8{% else %}col-lg-12{% endif %}">
            <div class="card card-stats" style="height: calc(100% - 30px)">
                <div class="card-body align-items-center py-5 py-lg-4" style="display: flex">
                    <div class="row px-md-4">
                        <div class="col-md-auto align-items-center mb-md-0 mb-3 justify-content-center" style="display: flex;">
                            <a href="#" data-toggle="modal" data-target="#pictureModal">
                                <img class="rounded-circle"
                                     style="width: 100px; height: 100px; object-fit: cover; background-color: #fff; z-index: 1"
                                     src="{{ office.avatar.url }}" alt="{{ office.company_name }}">
                            </a>
                        </div>
                        <div class="col-md align-items-center" style="display: flex;">
                            <div class="pl-2 row">
                                <span class="h3 p-0 m-0 pl-4">
                                    <span>{{ office.company_name }}</span>
                                    <small class="d-block h5 font-weight-light text-muted">{{ office.cnpj|default:'00.000.000/0001-00' }}</small>
                                    {% if office.address %}
                                        <div class="h5 font-weight-normal">
                                            <i class="fas fa-map-marker-alt mr-1" style="font-size: 0.7rem"></i>
                                            {{ office.address }}
                                        </div>
                                    {% endif %}
                                    {% if office.description %}
                                        <div class="h5 font-weight-500">
                                            <i>" {{ office.description }} "</i>
                                        </div>
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Office Infos Column -->
        {% if office.municipal_inscription or office.state_inscription or office.duns or office.fantasy_name %}
            <div class="col-lg-4">
                <div class="card card-stats" style="height: calc(100% - 30px)">
                    <div class="card-body py-lg-4">
                        <div class="row align-items-center" style="height: 100%">
                            <div class="col">
                                <div class="h5 pl-2">
                                    <span>INFO:</span>
                                </div>
                                {% if office.fantasy_name %}
                                    <div class="h5 mt-2 pl-2">
                                        <a data-toggle="tooltip" data-placement="top" title="" class="pointer-hover"
                                           onpointerdown="copyToClipboard('{{ office.fantasy_name }}', this)"
                                           onpointerleave="clearTitle('Copy', this)" data-original-title="Copy">
                                            <i class="far fa-copy pr-2 font-weight-light text-blue"
                                               style="font-size: 90%"></i>
                                        </a>
                                        <span>Fantasy Name: {{ office.fantasy_name }}</span>
                                    </div>
                                {% endif %}
                                {% if office.duns %}
                                    <div class="h5 font-weight-400 pl-2">
                                        <a data-toggle="tooltip" data-placement="top" title="" class="pointer-hover"
                                           onpointerdown="copyToClipboard('{{ office.duns }}', this)"
                                           onpointerleave="clearTitle('Copy', this)" data-original-title="Copy">
                                            <i class="far fa-copy pr-2 font-weight-light text-blue"
                                               style="font-size: 90%"></i>
                                        </a>
                                        <span>Duns: {{ office.duns }}</span>
                                    </div>
                                {% endif %}
                                {% if office.state_inscription %}
                                    <div class="h5 font-weight-400 pl-2">
                                        <a data-toggle="tooltip" data-placement="top" title="" class="pointer-hover"
                                           onpointerdown="copyToClipboard('{{ office.state_inscription }}', this)"
                                           onpointerleave="clearTitle('Copy', this)" data-original-title="Copy">
                                            <i class="far fa-copy pr-2 font-weight-light text-blue"
                                               style="font-size: 90%"></i>
                                        </a>
                                        <span>SI: {{ office.state_inscription }}</span>
                                    </div>
                                {% endif %}
                                {% if office.municipal_inscription %}
                                    <div class="h5 font-weight-400 pl-2">
                                        <a data-toggle="tooltip" data-placement="top" title="" class="pointer-hover"
                                           onpointerdown="copyToClipboard('{{ office.municipal_inscription }}', this)"
                                           onpointerleave="clearTitle('Copy', this)" data-original-title="Copy">
                                            <i class="far fa-copy pr-2 font-weight-light text-blue"
                                               style="font-size: 90%"></i>
                                        </a>
                                        <span>MI: {{ office.municipal_inscription }}</span>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    
    </div>

    <!-- Office Data Row -->
    <div class="row">

        <!-- Documents Highlights Column -->
        <div class="col-lg-4">

            <!-- Bank Infos Card -->
            {% if office.bank_accounts.count > 0 and perms.home.view_bankaccount %}
                <div class="card" style="height: 280.19px">
                    <div class="card-body">
                        <div class="row" style="display: inline-table !important">
                            <div class="col">
                                {% for account in office.bank_accounts.all %}
                                    <button type="button" class="mr-0 btn btn-sm btn-neutral tabLinks"
                                            onclick="openTabContent(event, {{ account.id }})"
                                            {% if account == office.bank_accounts.first %}
                                            id="default_tab"{% endif %}>
                                        {{ office.bank_accounts.all|index_of:account.id|add:1 }}
                                    </button>
                                {% endfor %}
                                {% if perms.home.add_bankaccount %}
                                    <a href="#" data-toggle="modal" data-target="#addBankAccountModal"
                                       class="btn btn-sm btn-neutral tabLinks">
                                        <i class="fas fa-plus"></i>
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                        <div class="row justify-content-between mt-3">
                            <div class="col">

                                {% for account in office.bank_accounts.all %}

                                    <div id="{{ account.id }}" class="tabcontent">
                                        <div>
                                            <span class="h6 surtitle text-muted">
                                               Bank
                                            </span>
                                            <p class="h5">
                                                {{ account.bank_code }} - {{ account.bank_name|truncatechars:40 }}
                                            </p>
                                        </div>
                                        <div class="mt-3">
                                            <span class="h6 surtitle text-muted">Agency / Bank account</span>
                                            <br>
                                            <span class="h2">{{ account.agency }}</span>
                                            <span class="ml-2 h2">{{ account.account }}</span>
                                        </div>
                                        <div class="mt-2">
                                            <span class="h6 surtitle text-muted">Pix</span>
                                            <br>
                                            <p class="h4">{{ account.pix|default:'-' }}</p>
                                        </div>
                                        {% if perms.home.change_bankaccount %}
                                            <a href="#" data-toggle="modal"
                                               data-target="#editBankAccountModal{{ account.id }}"
                                               class="btn btn-sm btn-neutral tabLinks mt--3"
                                               style="z-index: 1; position: absolute; right: 10px; top: -30px">
                                                <i class="fas fa-cog"></i>
                                            </a>
                                        {% endif %}
                                    </div>

                                    <!-- Edit Bank Account Modal -->
                                    {% if perms.home.change_bankaccount %}
                                        <div class="modal fade" id="editBankAccountModal{{ account.id }}" tabindex="-1"
                                             role="dialog"
                                             aria-labelledby="editBankAccountModal{{ account.id }}Label"
                                             aria-hidden="true">
                                            <div class="modal-dialog modal-dialog-centered" role="document"
                                                 style="max-width: 500px">
                                                <div class="modal-content">
                                                    <div class="modal-header mt-2 align-items-center">
                                                        <h5 class="modal-title" style="margin-left: auto">
                                                            <i class="fas fa-university text-blue"
                                                               style="font-size: 1.4rem"></i>
                                                        </h5>
                                                        <span class="ml-3 my-1"
                                                              style="margin-right: auto; font-size: 1.2rem"
                                                              id="editBankAccountModalLabel{{ account.id }}">Edit Bank Account</span>
                                                        <button type="button" class="close mt--4"
                                                                style="margin-left: -30px"
                                                                data-dismiss="modal" aria-label="Close">
                                                            <span aria-hidden="true">&times;</span>
                                                        </button>
                                                    </div>
                                                    <div class="modal-body py-0"
                                                         style="padding-left: 2.5rem; padding-right: 2.5rem">
                                                        <form id="editBankAccountForm{{ account.id }}" method="post"
                                                              action="{% url 'offices_edit_bank_account' office.slug account.id %}">
                                                            {% csrf_token %}
                                                            <div class="form-group form-control-label">
                                                                <label for="bankNameInput">Bank</label>
                                                                <select class="form-control" id="bankNameInput"
                                                                        name="bank" required="" autofocus="">
                                                                    {% for bank in banks %}
                                                                        <option value="{{ bank.0 }}"
                                                                                {% if account.bank_code == bank.0 %}
                                                                                selected
                                                                                {% endif %}>{{ bank.0 }}
                                                                            - {{ bank.1 }}</option>
                                                                    {% endfor %}
                                                                </select>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-3 form-group form-control-label">
                                                                    <label for="agencyInput">Agency</label>
                                                                    <input class="form-control" id="agencyInput"
                                                                           name="agency" required=""
                                                                           type="text" minlength="4" maxlength="4"
                                                                           value="{{ account.agency }}">
                                                                </div>
                                                                <div class="col form-group form-control-label">
                                                                    <label for="accountInput">Account</label>
                                                                    <input class="form-control" id="agencyInput"
                                                                           name="account" required="" autofocus=""
                                                                           type="text"
                                                                           value="{{ account.account }}">
                                                                </div>
                                                            </div>
                                                            <div class="form-group form-control-label mb-3">
                                                                <label for="pixInput">Pix</label>
                                                                <input class="form-control" id="pixInput" name="pix"
                                                                       type="text"
                                                                       value="{{ account.pix|default:'' }}">
                                                            </div>
                                                        </form>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button class="btn btn-secondary" data-dismiss="modal"
                                                                form="addBankAccountForm"
                                                                id="cancelButtonFile" type="button">
                                                            Cancel
                                                        </button>
                                                        {% if perms.home.delete_bankaccount %}
                                                            <a href="" data-dismiss="modal" data-toggle="modal"
                                                               data-target="#deleteConfirmBankAccount{{ account.id }}"
                                                               class="btn btn-danger text-white"
                                                               style="margin-right: 0.5rem">
                                                                Delete
                                                            </a>
                                                        {% endif %}
                                                        <button class="btn btn-primary"
                                                                form="editBankAccountForm{{ account.id }}"
                                                                type="submit">
                                                            Submit
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Delete Confirm Modal -->
                                        {% if perms.home.delete_bankaccount %}
                                            <div aria-hidden="true"
                                                 aria-labelledby="deleteConfirmBankAccountLabel{{ account.id }}"
                                                 class="modal fade" id="deleteConfirmBankAccount{{ account.id }}"
                                                 role="dialog"
                                                 tabindex="-1">
                                                <div class="modal-dialog modal-dialog-centered" style="max-width: 500px"
                                                     role="document">
                                                    <div class="modal-content">
                                                        <div class="modal-header mt-2">
                                                            <h5 class="modal-title my-1"
                                                                style="margin-left: auto">
                                                                <i class="ni ni-fat-delete text-blue"
                                                                   style="font-size: 1.5rem; margin-top: 0.15rem !important"></i>
                                                            </h5>
                                                            <span class="ml-3 my-1"
                                                                  id="deleteConfirmBankAccountLabel{{ account.id }}"
                                                                  style="margin-right: auto; font-size: 1.2rem">Are you sure?</span>
                                                            <button aria-label="Close" class="close mt--4"
                                                                    data-dismiss="modal"
                                                                    style="margin-left: -30px"
                                                                    type="button">
                                                                <span aria-hidden="true">&times;</span>
                                                            </button>
                                                        </div>
                                                        <div class="modal-body py-0"
                                                             style="padding-left: 2.5rem; padding-right: 2.5rem">
                                                            <p class="text-center">Are you sure you want to delete this
                                                                account?
                                                                <br>
                                                                This action cannot be undone.
                                                            </p>
                                                            <form id="deleteBankAccountForm{{ account.id }}"
                                                                  method="post"
                                                                  action="{% url 'offices_delete_bank_account' office.slug account.id %}">
                                                                {% csrf_token %}
                                                                <div class="row">
                                                                    <div class="col-sm-7 form-group form-control-label">
                                                                        <label for="deleteBankAccountInput"
                                                                               style="font-size:0.8125rem; font-weight:600">Bank</label>
                                                                        <input class="form-control"
                                                                               id="deleteBankAccountInput"
                                                                               type="text"
                                                                               value="{{ account.bank_code }} - {{ account.bank_name }}"
                                                                               disabled>
                                                                    </div>
                                                                    <div class="col-sm-5 form-group form-control-label">
                                                                        <label for="deleteBankAccountInput"
                                                                               style="font-size:0.8125rem; font-weight:600">Agency
                                                                            / Account</label>
                                                                        <input class="form-control"
                                                                               id="deleteBankAccountInput"
                                                                               type="text"
                                                                               value="{{ account.agency }} {{ account.account }}"
                                                                               disabled>
                                                                    </div>
                                                                </div>
                                                                <div class="form-group form-control-label">
                                                                    <label for="deleteBankAccountInput"
                                                                           style="font-size:0.8125rem; font-weight:600">Pix</label>
                                                                    <input class="form-control"
                                                                           id="deleteBankAccountInput"
                                                                           type="text" value="{{ account.pix|default:'' }}"
                                                                           disabled>
                                                                </div>
                                                            </form>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button class="btn btn-secondary" data-dismiss="modal"
                                                                    type="button">Cancel
                                                            </button>
                                                            <button class="btn btn-danger text-white" type="submit"
                                                                    form="deleteBankAccountForm{{ account.id }}">
                                                                Delete
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endif %}

                                    {% endif %}

                                {% endfor %}

                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}

            <!-- Add Bank Card -->
            {% if office.bank_accounts.count == 0 and perms.home.add_bankaccount %}
                <a href="#" data-toggle="modal" data-target="#addBankAccountModal">
                    <div class="card">
                        <div class="card-body justify-content-center d-flex">
                            <div class="align-items-center justify-content-center">
                                <i class="fas fa-university align-items-center justify-content-center d-flex mb-1" style="font-size: 1.5rem"></i>
                                <span class="font-weight-bold" style="font-size: 0.8rem">Add Bank</span>
                            </div>
                        </div>
                    </div>
                </a>
            {% endif %}
        
            <div class="card bg-gradient-default">
                <div class="card-body p-4">
                    <div class="row">
                        <div class="col">
                            <h5 class="card-title text-uppercase text-muted mb-0 text-white">PGR</h5>
                            <span class="h2 font-weight-bold mb-0 text-white">{{ office.pgr|date:'d/m/Y'|default:'-' }}</span>
                        </div>
                    </div>
                    <p class="mt-2 mb-0 text-sm">
                            <span class="{% if office.pgr|time_to_date < 30 and office.pgr|time_to_date > 0 %}text-warning{% elif office.pgr|time_to_date < 0 %}text-danger{% else %}text-white{% endif %} badge badge-dot"><span
                                    class="">
                                <i class="{% if office.pgr|time_to_date > 30 %}bg-green{% elif office.pgr|time_to_date > 0 %}bg-warning{% elif office.pgr|time_to_date < 0 %}bg-danger{% else %}bg-info{% endif %}"></i>{{ office.pgr|time_to_date|default:0 }} days</span>
                            <span class="text-nowrap text-light">{% if office.pgr|time_to_date < 0 %}expired{% else %}to
                                expire{% endif %}</span>
                    </p>
                </div>
        </div>
            <div class="card bg-gradient-default">
                <div class="card-body p-4">
                    <div class="row">
                        <div class="col">
                            <h5 class="card-title text-uppercase text-muted mb-0 text-white">PCMSO</h5>
                            <span class="h2 font-weight-bold mb-0 text-white">{{ office.pcmso|date:'d/m/Y'|default:'-' }}</span>
                        </div>
                    </div>
                    <p class="mt-2 mb-0 text-sm">
                        <span class="{% if office.pcmso|time_to_date < 30 and office.pcmso|time_to_date > 0 %}text-warning{% elif office.pcmso|time_to_date < 0 %}text-danger{% else %}text-white{% endif %} badge badge-dot"><span
                                class="">
                            <i class="{% if office.pcmso|time_to_date > 30 %}bg-green{% elif office.pcmso|time_to_date > 0 %}bg-warning{% elif office.pcmso|time_to_date < 0 %}bg-danger{% else %}bg-info{% endif %}"></i>{{ office.pcmso|time_to_date|default:0 }} days</span>
                        <span class="text-nowrap text-light">{% if office.pcmso|time_to_date < 0 %}expired{% else %}to
                            expire{% endif %}</span>
                    </p>
                </div>
            </div>

        </div>

        <!-- Documents Column -->
        <div class="col">
            <div class="card">
                <div class="card-header">
                    <div class="row align-items-center">
                        <div class="col align-items-center">
                            <span class="h5 font-weight-light text-muted mb-0">
                                ({% if office.documents.all.count < 5 %}{{ office.documents.all.count }}{% else %}5{% endif %}/{{ office.documents.all.count }})
                            </span>
                            <span class="h3 mb-0">Last documents</span>
                        </div>
                        <div class="col-auto px-2">
                            <a class="btn btn-sm btn-neutral" href="{% url 'office_documents' office.slug %}">
                                See all
                            </a>
                        </div>
                    </div>
                </div>
                <div class="table-responsive" style="min-height: 23.5rem; overflow-y: auto">
                    <table class="table align-items-center table-flush">
                        <tbody>
                            {% for document in office.documents.all|order_by:'-id'|slice:10 %}
                                <tr>
                                    <th scope="row" class="p-2 align-items-center">
                                        <a class="align-items-center" style="display: flex"
                                           data-target="#watchDocumentModal{{ document.id }}"
                                           data-toggle="modal" href="#">
                                            <div class="row">
                                                <div class="col-auto align-items-center d-flex pr-0">
                                                    <img src="/static/assets/img/icons/extensions/1x/{{ document.file.name|file_extension_icon }}" alt="{{ document.name }}"
                                                         class="pl-2"
                                                         style="height: 18px">
                                                </div>
                                                <div class="col">
                                                    <span class="font-weight-normal text-dark">
                                                        {{ document.name|truncatechars:40 }}
                                                    </span>
                                                    <br>
                                                    {% if document.expired %}
                                                        <span class="text-danger" style="font-size: 0.7rem">
                                                            {{ document.expiration|time_to_date|absolute }} days expired
                                                        </span>
                                                    {% elif document.expiration|time_to_date <= 30 %}
                                                        <span class="text-warning" style="font-size: 0.7rem">
                                                            {{ document.expiration|time_to_date }} days to expire
                                                        </span>
                                                    {% elif document.expiration %}
                                                        <span class="text-info" style="font-size: 0.7rem">
                                                            {{ document.expiration|time_to_date }} days to expire
                                                        </span>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </a>
                                    </th>
                                    <td class="text-right align-items-center pl-0" style="width: 0">
                                        <a href="{% url 'office_download_document' office.slug document.id %}">
                                            <i class="fas fa-download text-success" style="font-size: 0.7125rem"></i>
                                        </a>
                                    </td>
                                </tr>
    
                                <!-- Watch File Modal -->
                                <div aria-hidden="true"
                                     aria-labelledby="watchDocumentModalLabel{{ document.id }}"
                                     class="modal fade" id="watchDocumentModal{{ document.id }}"
                                     role="dialog"
                                     tabindex="-1">
                                    <div class="modal-dialog modal-dialog-centered" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header mt-2 mb--1">
                                                <h5 class="modal-title my-1"
                                                    style="margin-left: auto">
                                                    <i></i>
                                                </h5>
                                                <span class="ml-3 my-1"
                                                      id="newPageModalLabel{{ document.id }}"
                                                      style="margin-right: auto; font-size: 1.2rem"></span>
                                                <button aria-label="Close" class="close mt--4"
                                                        data-dismiss="modal"
                                                        style="margin-left: -30px"
                                                        type="button">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="modal-body py-0"
                                                 style="padding-left: 2.5rem; padding-right: 2.5rem">
                                                <div class="form-group mt--1"
                                                     style="display: flex; justify-content: center">
                                                    <img alt="New File" id="filePreviewModal{{ document.id }}"
                                                         src="/static/assets/img/icons/extensions/1x/{{ document.file.name|file_extension_icon }}"
                                                         style="height: 130px"/>
                                                </div>
                                                <div class="justify-content-center d-flex">
                                                    <span class="h5 mb-0 text-muted font-weight-light text-center">
                                                        {% if 'default' in document.file.name|file_extension_icon %}
                                                            {{ document.file.name|file_name_only_with_extension }}
                                                        {% else %}
                                                            {{ document.file.name|file_name_only }}
                                                        {% endif %}
                                                    </span>
                                                </div>
                                                <div class="form-group form-control-label justify-content-center" style="display: flex">
                                                    <span class="h5 mb-0 text-muted font-weight-light text-center">
                                                        uploaded: {{ document.uploaded_by.first_name }}
                                                        {% if document.uploaded_by %}-{% endif %}
                                                        {{ document.uploaded_at|date:'d/m/Y' }}
                                                    </span>
                                                </div>
                                                <div class="row">
                                                    <div class="col-sm form-group form-control-label">
                                                        <label for="name">Name</label>
                                                        <input class="form-control" id="name" type="text" 
                                                               value="{{ document.name }}" disabled>
                                                    </div>
                                                    <div class="col-sm-4 form-group form-control-label col">
                                                        <label for="category" class="form-control-label">Category</label>
                                                        <input type="text" class="form-control" id="category" 
                                                               value="{{ document.category }}" disabled>
                                                    </div>
                                                    <div class="col-sm-3 form-group form-control-label">
                                                        <label for="expiration">Expiration</label>
                                                        <input class="form-control" id="expiration" type="text" 
                                                               value="{{ document.expiration|date:'d/m/Y' }}" disabled>
                                                    </div>
                                                </div>
                                                <div class="form-group form-control-label">
                                                    <label for="fileDescription{{ document.id }}"
                                                           style="font-size:0.8125rem; font-weight:600">Description</label>
                                                    <textarea class="form-control" name="description"
                                                              id="fileDescription{{ document.id }}" disabled
                                                    >{{ document.description }}</textarea>
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button class="btn btn-secondary" data-dismiss="modal"
                                                        type="button">Cancel
                                                </button>
                                                <a class="btn btn-success"
                                                   href="{% url 'office_download_document' office.slug document.id %}">Download</a>
                                                <a href="{% url 'office_documents' office.slug %}#doc{{ document.id }}" 
                                                   class="btn btn-primary text-white">
                                                    Edit
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
    
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="card-footer align-items-center justify-content-center d-flex
                            {% if office.documents.all.count <= 5 %}py-1 border-top-0{% else %}p-0{% endif %}">
                    {% if office.documents.all.count > 5 %}
                        <a href="{% url 'office_documents' office.slug %}" data-toggle="tooltip" data-original-title="See all"
                           class="text-primary">
                            <i class="fas fa-ellipsis-h"></i>
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>

    </div>

</div>
    
<!-- Footer -->
<div class="container-fluid">
    {% include "includes/footer.html" %}
</div>

<!-- Edit Office Modal -->
<div class="modal fade" id="editOfficeModal" tabindex="-1" role="dialog" aria-labelledby="editOfficeModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header mt-2 align-items-center">
                <h5 class="modal-title" style="margin-left: auto">
                    <i class="ni ni-briefcase-24 text-blue" style="font-size: 1.5rem"></i>
                </h5>
                <span class="ml-3 my-1" style="margin-right: auto; font-size: 1.2rem" id="newEquipmentModalLabel">Edit Office</span>
                <button type="button" class="close mt--4" style="margin-left: -30px" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form method="post" action="{% url 'offices_edit' office.slug  %}">
                {% csrf_token %}
                <div class="modal-body py-0" style="padding-left: 2.5rem; padding-right: 2.5rem">
                    <div class="form-group form-control-label mb-3">
                        <label for="company_name">Company Name</label>
                        <input type="text" class="form-control" id="company_name"
                               name="company_name" value="{{ office.company_name }}" required>
                    </div>
                    <div class="row">
                        <div class="col-7 form-group form-control-label mb-3">
                            <label for="fantasy_name">Fantasy Name</label>
                            <input type="text" class="form-control" id="fantasy_name"
                                   name="fantasy_name" value="{{ office.fantasy_name }}">
                        </div>
                        <div class="col-5 form-group form-control-label mb-3">
                            <label for="cnpj">CNPJ</label>
                            <input type="text" class="form-control" id="cnpj"
                                   name="cnpj" value="{{ office.cnpj }}">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col form-group form-control-label mb-3">
                            <label for="state_inscription">State Inscription</label>
                            <input type="text" class="form-control"
                                   id="state_inscription" name="state_inscription" value="{{ office.state_inscription }}">
                        </div>
                        <div class="col form-group form-control-label mb-3">
                            <label for="municipal_inscription">Municipal Inscription</label>
                            <input type="text" class="form-control"
                                   id="municipal_inscription" name="municipal_inscription"
                                   value="{{ office.municipal_inscription }}">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-8 form-group form-control-label">
                            <label for="address">Address</label>
                            <input inputmode="decimal" class="form-control"
                                   id="address" name="address" value="{{ office.address }}">
                        </div>
                        <div class="col-sm form-group form-control-label mb-3">
                            <label for="duns">DUNS</label>
                            <input type="text" class="form-control" id="duns" name="duns"
                                   minlength="9" maxlength="9" value="{{ office.duns }}" required>
                        </div>
                    </div>
                    <div class="form-group form-control-label">
                        <label for="description">Description</label>
                        <textarea class="form-control" id="description"
                                  name="description">{{ office.description }}</textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>
    
<!-- Change Picture Modal -->
<div class="modal fade" id="pictureModal" tabindex="-1" role="dialog"
     aria-labelledby="pictureModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document" style="max-width: 500px">
        <div class="modal-content">
            <div class="modal-header mt-2">
                <button type="button" class="close ml-auto mt--4" style="margin-left: -30px"
                        data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body py-0"
                 style="padding-left: 2.5rem; padding-right: 2.5rem">
                <form id="pictureForm" method="post"
                      action="{% url 'offices_edit' office.slug %}"
                      enctype="multipart/form-data"
                      onsubmit="disableButtons()">
                    {% csrf_token %}
                    <div class="form-group my-5 mb-0"
                         style="display: flex; justify-content: center">
                        <div class="card-profile-image align-items-center justify-content-center"
                             style="background-color: #adb5bd00; height: 180px; display: flex">
                            <input type="file" id="pictureInput" style="display: none"
                                   accept="image/*" name="avatar" required>
                            <label for="pictureInput">
                                <img class="rounded-circle pointer-hover"
                                     style="min-width: 230px; height: 230px; object-fit: cover; background-color: #fff; z-index: 1"
                                     id="pictureAvatar"
                                     src="{{ office.avatar.url|default:'/static/assets/img/icons/placeholder.webp' }}"
                                     alt="Picture">
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal"
                        id="cancelButton">Cancel
                </button>
                <button type="submit" class="btn btn-primary" form="pictureForm"
                        id="uploadButton">Upload
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Add Bank Account Modal -->
{% if perms.home.add_bankaccount %}
    <div class="modal fade" id="addBankAccountModal" tabindex="-1" role="dialog"
         aria-labelledby="addBankAccountModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document" style="max-width: 500px">
            <div class="modal-content">
                <div class="modal-header mt-2 align-items-center">
                    <h5 class="modal-title" style="margin-left: auto">
                        <i class="fas fa-university text-blue" style="font-size: 1.4rem"></i>
                    </h5>
                    <span class="ml-3 my-1" style="margin-right: auto; font-size: 1.2rem"
                          id="addBankAccountModalLabel">Add Bank Account</span>
                    <button type="button" class="close mt--4" style="margin-left: -30px"
                            data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body py-0" style="padding-left: 2.5rem; padding-right: 2.5rem">
                    <form id="addBankAccountForm" method="post" action="{% url 'offices_add_bank_account' office.slug %}">
                        {% csrf_token %}
                        <div class="form-group form-control-label">
                            <label for="bankNameInput">Bank</label>
                            <select class="form-control" id="bankNameInput" name="bank" required>
                                {% for bank in banks %}
                                    <option value="{{ bank.0 }}">{{ bank.0 }} - {{ bank.1 }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="row">
                            <div class="col-3 form-group form-control-label">
                                <label for="agencyInput">Agency</label>
                                <input class="form-control" id="agencyInput" name="agency" required
                                       type="text" minlength="4" maxlength="4">
                            </div>
                            <div class="col form-group form-control-label">
                                <label for="accountInput">Account</label>
                                <input class="form-control" id="agencyInput" name="account" required
                                       type="text">
                            </div>
                        </div>
                        <div class="form-group form-control-label mb-3">
                            <label for="pixInput">Pix</label>
                            <input class="form-control" id="pixInput" name="pix" type="text">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-dismiss="modal" form="addBankAccountForm"
                            id="cancelButtonFile" type="button">
                        Cancel
                    </button>
                    <button class="btn btn-primary" form="addBankAccountForm" type="submit">
                        Submit
                    </button>
                </div>
            </div>
        </div>
    </div>
{% endif %}

{% endblock content %}

<!-- Specific JS goes HERE -->
{% block javascripts %}
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/5.0.6/jquery.inputmask.min.js"></script>
    
    <script>
        
        function copyToClipboard(element, link) {
            navigator.clipboard.writeText(element).then(function () {
                // Update the tooltip title using Bootstrap Tooltip method
                $(link).attr('data-original-title', 'Copied!').tooltip('show');
            }).catch(function (err) {
                console.error('Unable to copy to clipboard', err);
            });
        }
        
        function clearTitle(element, link) {
            $(link).attr('data-original-title', element).tooltip('hide');
        }
    
        function formatPhone(input) {
            let inputValue = input.value.replace(/\D/g, '');

            if (inputValue.length === 0) {
                input.value = inputValue.replace(/^(\d{0,3})/, '$1');
            } else if (inputValue.length <= 3) {
                input.value = inputValue.replace(/^(\d{0,3})/, '$1');
            } else if (inputValue.length <= 6) {
                input.value = inputValue.replace(/^(\d{3})(\d{0,3})/, '$1 $2');
            } else if (inputValue.length <= 9) {
                input.value = inputValue.replace(/^(\d{3})(\d{3})(\d{0,3})/, '$1 $2 $3');
            } else if (inputValue.length <= 10) {
                input.value = inputValue.replace(/^(\d{2})(\d{4})(\d{4})/, '($1) $2-$3');
            } else if (inputValue.length <= 11) {
                input.value = inputValue.replace(/^(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
            } else if (inputValue.length <= 12) {
                input.value = inputValue.replace(/^(\d{3})(\d{3})(\d{3})(\d{3})/, '+$1 $2 $3 $4');
            } else if (inputValue.length <= 13) {
                input.value = inputValue.replace(/^(\d{2})(\d{2})(\d{5})(\d{4})/, '+$1 ($2) $3 $4');
            } else {
                input.value = inputValue.replace(/^(\d{2})(\d{2})(\d{5})(\d{4}).*/, '+$1 ($2) $3 $4');
            }
        }

        function openTabContent(evt, mode) {
            let tabcontent = document.getElementsByClassName("tabcontent");
            for (let i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }

            let tablinks = document.getElementsByClassName("tabLinks");
            for (let i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace("btn-primary", "btn-neutral");
            }

            document.getElementById(mode).style.display = "block";
            evt.currentTarget.className = evt.currentTarget.className.replace("btn-neutral", "btn-primary");
        }

        try {
            document.getElementById("default_tab").click();
        } catch (e) {
            console.log(e);
        }
    
        $(document).ready(function () {
            function setupInput(input) {
                input.inputmask({
                    alias: "numeric",
                    radixPoint: ",",
                    groupSeparator: ".",
                    autoGroup: true,
                    rightAlign: false,
                    autoUnmask: true,
                    numericInput: true,
                    prefix: "",
                });
            }

            setupInput($("#valueInput"));
            setupInput($("#billInstallmentsValueInput"));
            
            $('[id^="valueInputDetails"]').each(function () {
                setupInput($(this));
            });
            
            $('[id^="billInstallmentsValueInputDetails"]').each(function () {
                setupInput($(this));
            });
        });
        
        document.querySelectorAll('.phone-input').forEach(function (element) {
            element.addEventListener('input', function (event) {
                formatPhone(event.target);
            });
        });
    
        document.getElementById('cnpj').addEventListener('input', function (event) {
            let input = event.target;
            let inputValue = input.value.replace(/\D/g, '');

            if (inputValue.length <= 2) {
                input.value = inputValue.replace(/^(\d{0,2})/, '$1');
            } else if (inputValue.length <= 5) {
                input.value = inputValue.replace(/^(\d{2})(\d{0,3})/, '$1.$2');
            } else if (inputValue.length <= 8) {
                input.value = inputValue.replace(/^(\d{2})(\d{3})(\d{0,3})/, '$1.$2.$3');
            } else if (inputValue.length <= 12) {
                input.value = inputValue.replace(/^(\d{2})(\d{3})(\d{3})(\d{0,4})/, '$1.$2.$3/$4');
            } else if (inputValue.length <= 14) {
                input.value = inputValue.replace(/^(\d{2})(\d{3})(\d{3})(\d{4})(\d{0,2})/, '$1.$2.$3/$4-$5');
            } else {
                input.value = inputValue.replace(/^(\d{2})(\d{3})(\d{3})(\d{4})(\d{2}).*/, '$1.$2.$3/$4-$5');
            }
        });

        document.getElementById('state_inscription').addEventListener('input', function (event) {
            let input = event.target;
            let inputValue = input.value.replace(/\D/g, '');

            if (inputValue.length <= 3) {
                input.value = inputValue.replace(/^(\d{0,3})/, '$1');
            } else if (inputValue.length <= 6) {
                input.value = inputValue.replace(/^(\d{3})(\d{0,3})/, '$1.$2');
            } else if (inputValue.length <= 9) {
                input.value = inputValue.replace(/^(\d{3})(\d{3})(\d{0,3})/, '$1.$2.$3');
            } else if (inputValue.length <= 12) {
                input.value = inputValue.replace(/^(\d{3})(\d{3})(\d{3})(\d{0,3})/, '$1.$2.$3.$4');
            } else {
                input.value = inputValue.replace(/^(\d{3})(\d{3})(\d{3})(\d{3}).*/, '$1.$2.$3.$4');
            }
        });
    
        document.getElementById('pictureInput').addEventListener('change', function (event) {
            const fileInput = event.target;
            const previewImage = document.getElementById('pictureAvatar');

            const file = fileInput.files[0];
            if (file) {
                // Read the selected file as a data URL and set it as the source of the image
                const reader = new FileReader();
                reader.onload = function (e) {
                    previewImage.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        document.addEventListener('DOMContentLoaded', function () {
            let collapseElements = document.querySelectorAll('[data-toggle="collapse"]');

            collapseElements.forEach(function (element) {
                element.addEventListener('click', function (event) {
                    let target = document.querySelector(this.getAttribute('data-target'));
                    let icon = this.querySelector('.rotate');

                    if (target.classList.contains('show')) {
                        icon.classList.remove('down');
                    } else {
                        icon.classList.add('down');
                    }
                });
            });
        });

    </script>

{% endblock javascripts %}
