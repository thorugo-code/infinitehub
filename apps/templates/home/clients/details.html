{% extends 'layouts/base.html' %}

{% block title %} {{ client.name }} {% endblock title %}

{% block stylesheets %}

    <style>
        .pointer-hover:hover {
            cursor: pointer;
        }
        .rotate {
            transition: transform 0.3s ease;
        }
        .rotate.down {
            transform: rotate(180deg);
        }
    </style>

{% endblock stylesheets %}

{% block content %}

{% load filters %}

<!-- Header container -->
<div class="header bg-primary pb-6">
    <div class="container-fluid">
        <div class="header-body">
            <div class="row align-items-center py-4">
                <div class="col-lg-6 col-7">
                    <nav aria-label="breadcrumb" class="d-none d-md-inline-block ml-md-4">
                        <ol class="breadcrumb breadcrumb-links breadcrumb-dark">
                            <li class="breadcrumb-item"><a href="/"><i class="fas fa-home"></i></a></li>
                            <li class="breadcrumb-item"><a href="{% url 'clients_home' %}">Clients</a></li>
                            <li class="breadcrumb-item active">{{ client.name|default:client.slug|truncatechars:25 }}</li>
                        </ol>
                    </nav>
                </div>
                <div class="col-lg-6 col-5 text-right">
                    <a href="#" data-toggle="modal" data-target="#editClientModal" class="btn btn-sm btn-neutral"><i class="fas fa-cog"></i></a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Page content -->
<div class="container-fluid mt--6" style="min-height: 720px">

    <!-- Client Infos Row -->
    <div class="row">
    
        <!-- Client Title Column -->
        <div class="col-lg-7">
            <div class="card card-stats" style="height: calc(100% - 30px)">
                <div class="card-body align-items-center py-5 py-lg-4" style="display: flex">
                    <div class="row px-md-4">
                        <div class="col-md-auto align-items-center mb-md-0 mb-3 justify-content-center" style="display: flex;">
                            <a href="#" data-toggle="modal" data-target="#pictureModal">
                                <img class="rounded-circle"
                                     style="width: 110px; height: 110px; object-fit: cover; background-color: #fff; z-index: 1"
                                     src="{{ client.avatar.url }}" alt="{{ client.name }}">
                            </a>
                        </div>
                        <div class="col-md align-items-center" style="display: flex;">
                            <div class="pl-2 row">
                                <span class="h3 p-0 m-0 pl-4">
                                    <span>{{ client.name }}</span>
                                    <small class="d-block h5 font-weight-light text-muted">{{ client.area|default:'Client Area' }}</small>
                                    {% if client.description %}
                                        <div class="h5 font-weight-500">
                                            <i>" {{ client.description }} "</i>
                                        </div>
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    
        <!-- Contact Infos Column -->
        <div class="col-lg-5">
            <div class="card card-stats" style="height: calc(100% - 30px)">
                <div class="card-body py-lg-4">
                    <div class="row align-items-center" style="height: 100%">
                        <div class="col">
                            <div class="h5 mt-2 pl-2">
                                <a data-toggle="tooltip" data-placement="top" title="Copy" class="pointer-hover"
                                   onpointerdown="copyToClipboard('{{ client.contact_email }}', this)" onpointerleave="clearTitle('Copy', this)">
                                    <i class="fas fa-envelope pr-2 font-weight-light text-blue" style="font-size: 90%"></i>
                                </a>
                                {{ client.contact_email }}
                            </div>
                            {% if client.phone %}
                                <div class="h5 font-weight-light pl-2">
                                    <a data-toggle="tooltip" data-placement="top" title="Copy" class="pointer-hover"
                                       onpointerdown="copyToClipboard('{{ client.phone }}', this)" onpointerleave="clearTitle('Copy', this)">
                                        <i class="fas fa-phone pr-2 text-blue" style="font-size: 90%"></i>
                                    </a>
                                    {{ client.phone }}
                                </div>
                            {% endif %}
                            {% if client.location %}
                                <div class="h5 font-weight-400 pl-2">
                                    <a data-toggle="tooltip" data-placement="top" title="Copy" class="pointer-hover"
                                       onpointerdown="copyToClipboard('{{ client.location }}', this)" onpointerleave="clearTitle('Copy', this)">
                                        <i class="fas fa-map-marker-alt pr-2 text-blue" style="font-size: 90%"></i>
                                    </a>
                                    <span>{{ client.location }}</span>
                                </div>
                            {% endif %}
                            {% if client.xml_email %}
                                <div class="h5 font-weight-light pl-2">
                                    <a data-toggle="tooltip" data-placement="top" title="Copy" class="pointer-hover"
                                       onpointerdown="copyToClipboard('{{ client.xml_email }}', this)" onpointerleave="clearTitle('Copy', this)">
                                        <i class="fas fa-copy pr-2 font-weight-light text-blue" style="font-size: 90%"></i>
                                    </a>
                                    {{ client.xml_email }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    
    </div>

    <!-- Regional Units Accordion -->
    <div class="row" style="margin-bottom: 30px">
        <div class="col">
            <div class="accordion">
                <div class="card shadow my-0">
                    <div class="row">
                        <div class="col pr-0">
                            <div class="card-header" id="heading1" role="button" data-toggle="collapse"
                                 data-target="#collapse1" aria-expanded="false" aria-controls="collapse1">
                                <h5 class="mb-0">
                                    <span class="heading">Regional units</span><span
                                        class="ml-2 heading text-muted">({{ client.branches.all.count }})</span>
                                </h5>
                            </div>
                        </div>
                        <div class="col-auto align-items-center d-flex mr-3 pl-0">
                            <a class="btn btn-sm btn-neutral" style="z-index: 100" data-toggle="modal"
                               data-target="#newRegionalUnitModal" href="#">
                                <i class="fas fa-plus"></i>
                            </a>
                        </div>
                    </div>
                    <div id="collapse1" class="collapse" aria-labelledby="heading1" data-parent=".accordion">
                        <div class="card-body p-0">
                            <div class="table-responsive" style="min-height: 10rem; max-height: 20rem">
                                <table class="table align-items-center table-flush">
                                    <thead class="thead-light">
                                    <tr>
                                        <th scope="col" style="width: 30%">Name</th>
                                        <th scope="col" style="width: 20%">Documents</th>
                                        <th scope="col" style="width: 20%">Bills</th>
{#                                        <th scope="col" style="width: 15%">Balance</th>#}
                                        <th scope="col" style="width: 30%">Local</th>
                                        {% if perms.home.change_branch or perms.home.delete_branch %}
                                            <th scope="col" style="width: 0"></th>
                                        {% endif %}
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for branch in client.branches.all %}
                                        <tr>
                                            <th scope="row">
                                                <a href="" class="text-dark" data-toggle="modal" 
                                                   data-target="#detailsBranchModal{{ branch.id }}">
                                                    {{ branch.name }}
                                                </a>
                                            </th>
                                            <td>
                                                {{ branch.documents.all.count|default:0 }}
                                            </td>
                                            <td>
                                                {{ branch.bills.all.count|default:0 }}
                                            </td>
{#                                            <td>#}
{#                                                <i class="fas {% if branch.balance > 0 %}fa-arrow-up text-success mr-3{% elif branch.balance < 0 %}fa-arrow-down text-warning mr-3{% endif %}"></i> {{ branch.balance|default:'0.00' }}#}
{#                                            </td>#}
                                            <td>
                                                {{ branch.city }}, {{ branch.state }} ({{ branch.country }})
                                            </td>
                                            {% if perms.home.change_branch or perms.home.delete_branch %}
                                                <td class="text-right px-2" style="width: 0">
                                                    <div class="dropdown">
                                                        <a class="btn btn-sm btn-icon-only text-light" href="#"
                                                           role="button"
                                                           data-toggle="dropdown" aria-haspopup="true"
                                                           aria-expanded="false">
                                                            <i class="fas fa-ellipsis-v"></i>
                                                        </a>
                                                        <div class="dropdown-menu dropdown-menu-right dropdown-menu-arrow">
                                                            {% if perms.home.change_branch %}
                                                                <a class="dropdown-item" data-toggle="modal" href=""
                                                                   data-dismiss="modal"
                                                                   data-target="#detailsBranchModal{{ branch.id }}">
                                                                    Open
                                                                </a>
                                                            {% endif %}
                                                            {% if perms.home.delete_branch %}
                                                                <div class="dropdown-divider"></div>
                                                                <a class="dropdown-item text-danger" href=""
                                                                   data-dismiss="modal"
                                                                   data-toggle="modal"
                                                                   data-target="#deleteBranchModal{{ branch.id }}">
                                                                    Delete
                                                                </a>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </td>
                                            {% endif %}
                                        </tr>
                                        
                                        <!-- Branch Details Modal -->
                                        <div aria-hidden="true"
                                             aria-labelledby="detailsBranchModalLabel{{ branch.id }}"
                                             class="modal fade" id="detailsBranchModal{{ branch.id }}"
                                             role="dialog" tabindex="-1">
                                            <div class="modal-dialog modal-dialog-centered" role="document">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <span class="pl-4 mx-auto my-1" style="font-size: 1.2rem"
                                                              id="newPageModalLabel">
                                                            <i class="fas fa-warehouse text-blue mr-2"></i>
                                                            Regional
                                                        </span>
                                                        <button aria-label="Close" class="close ml-0"
                                                                data-dismiss="modal" type="button">
                                                            <span aria-hidden="true">&times;</span>
                                                        </button>
                                                    </div>
                                                    <div class="modal-body py-0"
                                                         style="padding-left: 2.5rem; padding-right: 2.5rem">
                                                    
                                                        {% if perms.home.change_branch %}
                                                            <form action="{% url 'edit_client_branch' client.slug branch.id %}"
                                                                  enctype="multipart/form-data" id="editRegionalUnitForm{{ branch.id }}"
                                                                  method="post" onsubmit="disableByID('editRegionalUnitButton{{ branch.id }}')">
                                                                {% csrf_token %}
                                                                <div class="form-group form-control-label">
                                                                    <label for="regionalUnitNameInput">Name</label>
                                                                    <input class="form-control"
                                                                           id="regionalUnitNameInput"
                                                                           name="name" type="text"
                                                                           value="{{ branch.name|default:'' }}">
                                                                </div>
                                                                <div class="row">
                                                                    <div class="col-sm-4">
                                                                        <div class="form-group form-control-label select-wizard">
                                                                            <label for="editCountry{{ branch.id }}">Country</label>
                                                                            <select id="editCountry{{ branch.id }}"
                                                                                    name="country"
                                                                                    class="form-control"
                                                                                    onload="loadEditStates({{ branch.id }})"
                                                                                    onchange="loadEditStates({{ branch.id }})">
                                                                                <option value="" disabled selected></option>
                                                                                {% for country in world %}
                                                                                    <option value="{{ country }}"
                                                                                            {% if branch.country == country %}selected{% endif %}>{{ country }}</option>
                                                                                {% endfor %}
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-sm-4">
                                                                        <div class="form-group form-control-label bmd-form-group">
                                                                            <label for="editState{{ branch.id }}">State</label>
                                                                            <select id="editState{{ branch.id }}"
                                                                                    name="state"
                                                                                    class="form-control" disabled
                                                                                    onchange="loadEditCities({{ branch.id }})">
                                                                                <option value="" disabled
                                                                                        selected></option>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-sm-4">
                                                                        <div class="form-group form-control-label bmd-form-group">
                                                                            <label for="editCity{{ branch.id }}">City</label>
                                                                            <select id="editCity{{ branch.id }}"
                                                                                    name="city"
                                                                                    class="form-control" disabled>
                                                                                <option value="" disabled
                                                                                        selected></option>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </form>
                                                        {% else %}
                                                            <div class="form-group form-control-label">
                                                                <label for="regionalUnitNameInput">Name</label>
                                                                <input class="form-control" id="regionalUnitNameInput"
                                                                       name="name" type="text" disabled
                                                                       value="{{ branch.name|default:'' }}">
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-sm-4">
                                                                    <div class="form-group form-control-label select-wizard">
                                                                        <label for="editCountry{{ branch.id }}">Country</label>
                                                                        <input class="form-control"
                                                                               id="editCountry{{ branch.id }}"
                                                                               type="text" disabled
                                                                               value="{{ branch.country|default:'' }}">
                                                                    </div>
                                                                </div>
                                                                <div class="col-sm-4">
                                                                    <div class="form-group form-control-label bmd-form-group">
                                                                        <label for="editState{{ branch.id }}">State</label>
                                                                        <input class="form-control"
                                                                               id="editState{{ branch.id }}"
                                                                               type="text" disabled
                                                                               value="{{ branch.state|default:'' }}">
                                                                    </div>
                                                                </div>
                                                                <div class="col-sm-4">
                                                                    <div class="form-group form-control-label bmd-form-group">
                                                                        <label for="editCity{{ branch.id }}">City</label>
                                                                        <input class="form-control"
                                                                               id="editCity{{ branch.id }}"
                                                                               type="text" disabled
                                                                               value="{{ branch.city|default:'' }}">
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        {% endif %}
                                                    
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button class="btn btn-secondary" data-dismiss="modal"
                                                                form="editRegionalUnitForm{{ branch.id }}"
                                                                id="cancelButtonFile" type="button">
                                                            Cancel
                                                        </button>
                                                        {% if perms.home.change_branch %}
                                                            <button class="btn btn-primary"
                                                                    form="editRegionalUnitForm{{ branch.id }}"
                                                                    id="editRegionalUnitButton{{ branch.id }}"
                                                                    type="submit">
                                                                Submit
                                                            </button>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Delete Branch Modal -->
                                        {% if perms.home.delete_branch %}
                                            <div aria-hidden="true"
                                                 aria-labelledby="deleteBranchModalLabel{{ branch.id }}"
                                                 class="modal fade" id="deleteBranchModal{{ branch.id }}"
                                                 role="dialog" tabindex="-1">
                                                <div class="modal-dialog modal-dialog-centered" role="document">
                                                    <div class="modal-content">
                                                        <div class="modal-header mt-2">
                                                            <h5 class="modal-title my-1"
                                                                style="margin-left: auto">
                                                                <i class="ni ni-fat-delete text-blue"
                                                                   style="font-size: 1.5rem; margin-top: 0.15rem !important"></i>
                                                            </h5>
                                                            <span class="ml-3 my-1"
                                                                  id="deleteBranchModalLabel"
                                                                  style="margin-right: auto; font-size: 1.2rem">Are you sure?</span>
                                                            <button aria-label="Close" class="close mt--4"
                                                                    data-dismiss="modal"
                                                                    style="margin-left: -30px"
                                                                    type="button">
                                                                <span aria-hidden="true">&times;</span>
                                                            </button>
                                                        </div>
                                                        <div class="modal-body py-2">
                                                            <form action="{% url 'delete_client_branch' client.slug branch.id %}"
                                                                  id="deleteBranchForm{{ branch.id }}" method="post" 
                                                                  onsubmit="disableByID('deleteBranchButton{{ branch.id }}')">
                                                                {% csrf_token %}
                                                                <div class="form-group form-control-label">
                                                                    <label for="regionalUnitNameInput">Name</label>
                                                                    <input class="form-control"
                                                                           id="regionalUnitNameInput"
                                                                           name="name" type="text" disabled
                                                                           value="{{ branch.name|default:'' }}">
                                                                </div>
                                                                <div class="form-group form-control-label">
                                                                    <label for="deleteBranchLocation{{ branch.id }}">Location</label>
                                                                    <input id="deleteBranchLocation{{ branch.id }}"
                                                                           name="location"
                                                                           class="form-control" disabled
                                                                           value="{{ branch.city }}, {{ branch.state }} ({{ branch.country }})">
                                                                </div>
                                                            </form>
                                                        </div>
                                                        <div class="modal-footer pt-0">
                                                            <button class="btn btn-secondary" data-dismiss="modal"
                                                                    type="button">Cancel
                                                            </button>
                                                            <button class="btn btn-danger"
                                                                    form="deleteBranchForm{{ branch.id }}"
                                                                    id="deleteBranchButton{{ branch.id }}"
                                                                    type="submit">Delete
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endif %}
                                        
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Client Data Row -->
    <div class="row flex-row-reverse flex-wrap-reverse">

        <!-- Balance + Documents Column -->
        <div class="col-md-4">
        
            <!-- Balance Card -->
            <div class="card bg-gradient-default">
                <div class="card-body">
                    <div class="mb-2">
                        <div class="text-light text-sm text-uppercase">Balance</div>
                        <div class="mt-2">
                            <sup class="{% if balance > 0 %}text-success{% elif balance < 0 %}text-danger{% else %}text-white{% endif %}">
                                {% if currency == 'BRL' %}
                                    R$
                                {% else %}
                                    $
                                {% endif %}
                            </sup>
                            <span class="h2 {% if balance > 0 %}text-success{% elif balance < 0 %}text-danger{% else %}text-white{% endif %}">
                                {{ balance|without_currency|default:'0.00' }}
                            </span>
                        </div>
                        <div class="text-sm mt-2">
                            {% if last_month_balance_percentage > 0 %}
                                <span class="text-success font-weight-600">+ {{ last_month_balance_percentage }}%</span>
                                <span class="text-light font-weight-light">|</span>
                            {% elif last_month_balance_percentage < 0 %}
                                <span class="text-danger font-weight-600">- {{ last_month_balance_percentage|absolute }}%</span>
                                <span class="text-light font-weight-light">|</span>
                            {% endif %}
                            <span class="text-light">{{ last_month_balance|default:'0' }}</span>
                            <small class="text-light font-weight-light">Last month</small>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-xl">
                            <small class="text-light">Income: {{ income_percentage|default:0 }}%</small>
                            <div class="progress progress-xs my-2">
                                <div class="progress-bar bg-success" style="width: {{ income_percentage }}%"></div>
                            </div>
                        </div>
                        <div class="col-xl">
                            <small class="text-light">Expense: {{ expense_percentage|default:0 }}%</small>
                            <div class="progress progress-xs my-2">
                                <div class="progress-bar bg-danger" style="width: {{ expense_percentage }}%"></div>
                            </div>
                        </div>
                    </div>
                    <a class="btn btn-sm btn-block btn-primary mt-3" href="{% url 'client_balance' client.slug %}">
                        Manage
                    </a>
                </div>
            </div>
        
            <!-- Documents Card -->
            <div class="card">
                <div class="card-header">
                    <div class="row align-items-center">
                        <div class="col align-items-center">
                            <span class="h5 font-weight-light text-muted mb-0">
                                ({% if client.documents.all.count < 5 %}{{ client.documents.all.count }}{% else %}5{% endif %}/{{ client.documents.all.count }})
                            </span>
                            <span class="h3 mb-0">Last documents</span>
                        </div>
                        <div class="col-auto px-2">
                            <a class="btn btn-sm btn-neutral" href="{% url 'client_documents' client.slug %}">
                                See all
                            </a>
{#                            <button type="button" class="btn btn-sm btn-neutral mr-0" data-toggle="dropdown"#}
{#                                    aria-haspopup="true" aria-expanded="false">#}
{#                                <i class="fas fa-ellipsis-h"></i>#}
{#                            </button>#}
{#                            <div class="dropdown-menu dropdown-menu-right">#}
{#                                <a class="dropdown-item" href="#" data-toggle="modal" data-target="#newDocumentModal">New</a>#}
{#                                <hr class="my-1">#}
{#                                <a class="dropdown-item" href="{% url 'client_documents' client.slug %}">See all</a>#}
{#                            </div>#}
                        </div>
                    </div>
                </div>
                <div class="table-responsive" style="min-height: 4.3rem; max-height: 19.65rem; overflow-y: auto">
                    <table class="table align-items-center table-flush">
                        <tbody>
                            {% for document in highlight_documents %}
                                <tr>
                                    <th scope="row" class="p-2 align-items-center">
                                        <a class="align-items-center" style="display: flex"
                                           data-target="#watchDocumentModal{{ document.id }}"
                                           data-toggle="modal" href="">
                                            <div class="row">
                                                <div class="col-auto align-items-center d-flex pr-0">
                                                    <img src="/static/assets/img/icons/extensions/1x/{{ document.file.name|file_extension_icon }}" alt="{{ document.name }}" 
                                                         class="pl-2"
                                                         style="height: 18px">
                                                </div>
                                                <div class="col">
                                                    <span class="font-weight-normal text-dark">
                                                        {{ document.name|truncatechars:40 }}
                                                    </span>
                                                    <br>
                                                    {% if document.expired %}
                                                        <span class="text-danger" style="font-size: 0.7rem">
                                                            {{ document.expiration|time_to_date|absolute }} days expired
                                                        </span>
                                                    {% elif document.expiration|time_to_date <= 30 %}
                                                        <span class="text-warning" style="font-size: 0.7rem">
                                                            {{ document.expiration|time_to_date }} days to expire
                                                        </span>
                                                    {% else %}
                                                        <span class="text-info" style="font-size: 0.7rem">
                                                            {{ document.expiration|time_to_date }} days to expire
                                                        </span>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </a>
                                    </th>
                                    <td class="text-right align-items-center pl-0" style="width: 0">
                                        <a href="{% url 'download_client_document' client.slug document.id %}">
                                            <i class="fas fa-download text-success" style="font-size: 0.7125rem"></i>
                                        </a>
                                    </td>
                                </tr>

                                <!-- Watch File Modal -->
                                <div aria-hidden="true"
                                     aria-labelledby="watchDocumentModalLabel{{ document.id }}"
                                     class="modal fade" id="watchDocumentModal{{ document.id }}"
                                     role="dialog"
                                     tabindex="-1">
                                    <div class="modal-dialog modal-dialog-centered" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header mt-2 mb--1">
                                                <h5 class="modal-title my-1"
                                                    style="margin-left: auto">
                                                    <i></i>
                                                </h5>
                                                <span class="ml-3 my-1"
                                                      id="newPageModalLabel{{ document.id }}"
                                                      style="margin-right: auto; font-size: 1.2rem"></span>
                                                <button aria-label="Close" class="close mt--4"
                                                        data-dismiss="modal"
                                                        style="margin-left: -30px"
                                                        type="button">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="modal-body py-0"
                                                 style="padding-left: 2.5rem; padding-right: 2.5rem">
                                                <form action="{% url 'edit_client_document' client.slug document.id %}"
                                                      id="editFile{{ document.id }}" method="post" 
                                                      onsubmit="disableByID('editFileButton{{ document.id }}')">
                                                    {% csrf_token %}
                                                    {% load filters %}
                                                    <div class="form-group mt--1"
                                                         style="display: flex; justify-content: center">
                                                        <img alt="New File" id="filePreviewModal{{ document.id }}"
                                                             src="/static/assets/img/icons/extensions/1x/{{ document.file.name|file_extension_icon }}"
                                                             style="height: 130px"/>
                                                    </div>
                                                    <div class="justify-content-center d-flex">
                                                        <span class="h5 mb-0 text-muted font-weight-light text-center">
                                                            {% if 'default' in document.file.name|file_extension_icon %}
                                                                {{ document.file.name|file_name_only_with_extension }}
                                                            {% else %}
                                                                {{ document.file.name|file_name_only }}
                                                            {% endif %}
                                                        </span>
                                                    </div>
                                                    <div class="form-group form-control-label justify-content-center" style="display: flex">
                                                        <span class="h5 mb-0 text-muted font-weight-light text-center">
                                                            uploaded: {{ document.uploaded_by.first_name }}
                                                            {% if document.uploaded_by %}-{% endif %}
                                                            {{ document.uploaded_at|date:'d/m/Y' }}
                                                        </span>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm-7 form-group form-control-label">
                                                            <label for="fileName{{ document.id }}"
                                                                   style="font-size:0.8125rem; font-weight:600">Name</label>
                                                            <input class="form-control" id="fileName{{ document.id }}"
                                                                   type="text" value="{{ document.name }}" name="name">
                                                        </div>
                                                        <div class="col-sm-5 form-group form-control-label">
                                                            <label for="fileType{{ document.id }}"
                                                                   style="font-size:0.8125rem; font-weight:600">Expiration</label>
                                                            <input class="form-control" id="fileType{{ document.id }}"
                                                                   type="date" name="expiration"
                                                                   value="{{ document.expiration|date:'Y-m-d' }}">
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm form-group form-control-label">
                                                            <label for="documentBranchInput">Regional</label>
                                                            <select class="form-control" id="documentBranchInput"
                                                                    name="branch_id">
                                                                <option value=""></option>
                                                                {% for branch in client.branches.all %}
                                                                    <option value="{{ branch.id }}" {% if branch == document.branch %}selected{% endif %}>{{ branch.name }}</option>
                                                                {% endfor %}
                                                            </select>
                                                        </div>
                                                        <div class="col-sm form-group form-control-label col">
                                                            <label for="fileUploadUser{{ document.id }}"
                                                                   style="font-size:0.8125rem; font-weight:600">Category</label>
                                                            <select class="form-control" name="category"
                                                                    id="fileUploadUser{{ document.id }}">
                                                                <option value=""></option>
                                                                <option value="Invoice" {% if document.category == 'Invoice' %}selected{% endif %}>Invoice</option>
                                                                <option value="Lending contract" {% if document.category == 'Lending contract' %}selected{% endif %}>Lending contract</option>
                                                                <option value="Lending invoice" {% if document.category == 'Lending invoice' %}selected{% endif %}>Lending invoice</option>
                                                                <option value="Receipt" {% if document.category == 'Receipt' %}selected{% endif %}>Receipt</option>
                                                                <option value="Sales invoice" {% if document.category == 'Sales invoice' %}selected{% endif %}>Sales invoice</option>
                                                                <option value="Service contract" {% if document.category == 'Service contract' %}selected{% endif %}>Service contract</option>
                                                                <option value="Service invoice" {% if document.category == 'Service invoice' %}selected{% endif %}>Service invoice</option>
                                                                <option value="Others" {% if document.category == 'Others' %}selected{% endif %}>Others</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="form-group form-control-label">
                                                        <label for="fileDescription{{ document.id }}"
                                                               style="font-size:0.8125rem; font-weight:600">Description</label>
                                                        <textarea class="form-control" name="description"
                                                                  id="fileDescription{{ document.id }}">{{ document.description }}</textarea>
                                                    </div>
                                                </form>
                                            </div>
                                            <div class="modal-footer">
                                                <button class="btn btn-secondary" data-dismiss="modal"
                                                        type="button">Cancel
                                                </button>
                                                <button class="btn btn-danger text-white"
                                                        data-dismiss="modal"
                                                        data-target="#deleteConfirmDocument{{ document.id }}"
                                                        data-toggle="modal">
                                                    Delete
                                                </button>
                                                <a class="btn btn-success"
                                                   href="{% url 'download_client_document' client.slug document.id %}">Download</a>
                                                <button class="btn btn-primary text-white"
                                                        type="submit"
                                                        id="editFileButton{{ document.id }}"
                                                        form="editFile{{ document.id }}">
                                                    Save
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Delete Confirm Modal -->
                                <div aria-hidden="true"
                                     aria-labelledby="deleteConfirmDocumentLabel{{ document.id }}"
                                     class="modal fade" id="deleteConfirmDocument{{ document.id }}"
                                     role="dialog"
                                     tabindex="-1">
                                    <div class="modal-dialog modal-dialog-centered" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header mt-2">
                                                <h5 class="modal-title my-1"
                                                    style="margin-left: auto">
                                                    <i class="ni ni-fat-delete text-blue"
                                                       style="font-size: 1.5rem; margin-top: 0.15rem !important"></i>
                                                </h5>
                                                <span class="ml-3 my-1"
                                                      id="deleteConfirmModalLabel"
                                                      style="margin-right: auto; font-size: 1.2rem">Are you sure?</span>
                                                <button aria-label="Close" class="close mt--4"
                                                        data-dismiss="modal"
                                                        style="margin-left: -30px"
                                                        type="button">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="modal-body py-0" style="padding-left: 2.5rem; padding-right: 2.5rem">
                                                <form action="{% url 'delete_client_document' client.slug document.id %}"
                                                      id="deleteConfirmDocumentForm{{ document.id }}" method="post" 
                                                      onsubmit="disableByID('deleteConfirmDocumentButton{{ document.id }}')">
                                                    {% csrf_token %}
                                                    <input type="hidden" name="redirect_to" value="client_details">
                                                    <div class="form-group mt-4"
                                                         style="display: flex; justify-content: center">
                                                        <img alt="New File" id="filePreviewModal" style="height: 130px"
                                                             src="/static/assets/img/icons/extensions/1x/{{ document.file.name|file_extension_icon }}"
                                                        />
                                                    </div>
                                                    <div class="form-group form-control-label">
                                                        <label for="fileName{{ document.id }}"
                                                               style="font-size:0.8125rem; font-weight:600">Name</label>
                                                        <input class="form-control" disabled
                                                               id="fileName{{ document.id }}"
                                                               type="text"
                                                               value="{{ document.name|file_name_only_with_extension }}">
                                                    </div>
                                                </form>
                                            </div>
                                            <div class="modal-footer">
                                                <button class="btn btn-secondary" data-dismiss="modal"
                                                        type="button">Cancel
                                                </button>
                                                <button class="btn btn-danger"
                                                        id="deleteConfirmDocumentButton{{ document.id }}"
                                                        form="deleteConfirmDocumentForm{{ document.id }}"
                                                        type="submit">Delete
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="card-footer align-items-center justify-content-center d-flex py-1
                            {% if client.documents.all.count <= 5 %}border-top-0{% endif %}">
                    {% if client.documents.all.count > 5 %}
                        <i class="fas fa-ellipsis-h text-muted"></i>
                    {% endif %}
                </div>
            </div>
        
        </div>

        <!-- Stats + Bills Column -->
        <div class="col-md-8">
        
            <!-- Stats Row -->
            <div class="card-deck">
                <div class="card bg-gradient-blue" style="min-width: 0; height: 140px">
                    <div class="card-body p-4 ml-2">
                        <div class="row">
                            <div class="col">
                                <h5 class="card-title text-uppercase text-muted mb-0 text-white">Projects</h5>
                                <span class="h2 font-weight-bold mb-0 text-white">{{ client.projects.all.count }}</span>
                            </div>
                            <div class="col-auto">
                                <button type="button" class="btn btn-sm btn-neutral mr-0" data-toggle="dropdown"
                                        aria-haspopup="true" aria-expanded="false">
                                    <i class="fas fa-ellipsis-h"></i>
                                </button>
                                <div class="dropdown-menu dropdown-menu-right">
                                    <a class="dropdown-item" href="#" data-toggle="modal" data-target="#newPageModal">
                                        New
                                    </a>
                                    <hr class="my-1">
                                    <a class="dropdown-item" 
                                       href="{% url 'filtered_projects' 'client='|add_string:client.id|add:'&archive=on' %}">
                                        See all
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <span class="badge badge-dot pr-2">
                            <i class="bg-success"></i>
                            <span class="text-nowrap text-white pr-1">{{ finished_projects|default:0 }}</span>
                            <span class="text-nowrap text-white font-weight-light">Finished</span>
                            </span>
                            <span class="badge badge-dot">
                                <i class="bg-info"></i>
                                <span class="text-nowrap text-white pr-1">{{ working_projects|default:0 }}</span>
                                <span class="text-nowrap text-white font-weight-light">Working</span>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="card {% if requests_to_attend > 0 %}bg-gradient-danger{% else %}bg-gradient-success{% endif %}" style="min-width: 0; height: 140px !important">
                    <div class="card-body p-4 ml-2">
                        <div class="row">
                            <div class="col">
                                <h5 class="card-title text-uppercase text-muted mb-0 text-white">Requests</h5>
                                <span class="h2 font-weight-bold mb-0 text-white">{{ requests_to_attend|default:0 }}</span>
                                <span class="h3 font-weight-normal mb-0 text-white">to attend</span>
                            </div>
                        </div>
                        <div class="mt-3">
                            <span class="text-nowrap text-sm text-white font-weight-light">
                                Total: {{ client.requests.all.count|default:0 }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        
            <!-- Bills in progress card -->
            <div class="card shadow" style="min-height: 19.5rem; max-height: 31.45rem"> {# height: calc(100% - 200px) #}
                <div class="card-header">
                    <div class="row">
                        <div class="col">
                            <span class="h5 font-weight-light text-muted mb-0">
                                ({{ bills_in_progress.count }}/{{ client.bills.all.count }})
                            </span>
                            <span class="h3 mb-0">Bills in progress</span>
                        </div>
                        <div class="col-auto px-2">
                            <a class="btn btn-sm btn-neutral"
                               href="{% url 'client_balance' client.slug %}">
                                See all
                            </a>
                        </div>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive"
                         style="min-height: 14.7rem; max-height: 26.95rem; overflow-y: auto">
                        <table class="table align-items-center table-flush">
                            <tbody>
                            {% for bill in bills_in_progress %}
                                <tr>
                                    <td class="p-0 pl-4">
                                        {% if bill.installments_number > 1 %}
                                            <a class="pointer-hover accordion" data-toggle="collapse" 
                                               data-target="#collapseDetails{{ bill.id }}" aria-expanded="false" 
                                               aria-controls="collapseDetails{{ bill.id }}">
                                                <i class="fas fa-chevron-down text-muted rotate"></i>
                                            </a>
                                        {% endif %}
                                    </td>
                                    <td class="p-0 pl-2" style="width: 0">
                                        {% if bill.category in income_categories %}
                                            <a href="#" data-toggle="modal"
                                               data-target="#detailsBillModal{{ bill.id }}" class="text-dark">
                                                <i class="fas fa-plus text-green"
                                                   style="font-size: 0.7125rem"></i>
                                            </a>
                                        {% elif bill.category in expense_categories %}
                                            <a href="#" data-toggle="modal"
                                               data-target="#detailsBillModal{{ bill.id }}" class="text-dark">
                                                <i class="fas fa-minus text-red"
                                                   style="font-size: 0.7125rem"></i>
                                            </a>
                                        {% else %}
                                            <a href="#" data-toggle="modal"
                                               data-target="#detailsBillModal{{ bill.id }}" class="text-dark">
                                                <i class="fas fa-question text-blue"
                                                   style="font-size: 0.7125rem"></i>
                                            </a>
                                        {% endif %}
                                    </td>
                                    <td class="pl-3">
                                        <a href="#" data-toggle="modal"
                                           data-target="#detailsBillModal{{ bill.id }}" class="text-dark">
                                            {{ bill.title|default:'-' }}
                                            <br>
                                            <span class="text-muted font-weight-light">
                                                {{ bill.category|default:'-' }}
                                            </span>
                                        </a>
                                    </td>
                                    <td>
                                        {{ bill.due_date|date:'d/m/y'|default:'-' }}
                                        {% if bill.due_date %}
                                            <br>
                                            {% if bill.due_date|time_to_date > 30 %}
                                                <span class="text-muted">
                                                    {{ bill.due_date|time_to_date }} days to expire
                                                </span>
                                            {% elif bill.due_date|time_to_date > 0 %}
                                                <span class="text-warning">
                                                    {{ bill.due_date|time_to_date }} days to expire
                                                </span>
                                            {% else %}
                                                <span class="text-danger">
                                                    {{ bill.due_date|time_to_date|absolute }} days expired
                                                </span>
                                            {% endif %}
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if bill.link %}
                                            <a href="{{ bill.link }}" target="_blank">
                                                <i class="fas fa-link"
                                                   style="font-size: 0.7rem"></i> {{ bill.code|default:'Link'|truncatechars:25 }}
                                            </a>
                                        {% else %}
                                            {{ bill.code|default:'-' }}
                                        {% endif %}
                                    </td>
                                    <td>{{ bill.payer.name|default:'-' }}</td>
                                    <td>
                                        {{ bill.total|default:'-' }}
                                        {% if bill.installments_number > 1 %}
                                            <a class="pointer-hover accordion" data-toggle="collapse" 
                                               data-target="#collapseDetails{{ bill.id }}" aria-expanded="false" 
                                               aria-controls="collapseDetails{{ bill.id }}">
                                                ({{ bill.installments_number }}x)
                                            </a>
                                        {% endif %}
                                        <br>
                                        <span class="text-muted font-weight-light">
                                            {{ bill.method }}
                                        </span>
                                    </td>
                                    <td class="text-right px-2" style="width: 0">
                                        <div class="dropdown">
                                            <a class="btn btn-sm btn-icon-only text-light" href="#"
                                               role="button"
                                               data-toggle="dropdown" aria-haspopup="true"
                                               aria-expanded="false">
                                                <i class="fas fa-ellipsis-v"></i>
                                            </a>
                                            <div class="dropdown-menu dropdown-menu-right dropdown-menu-arrow">
                                                <a class="dropdown-item" data-toggle="modal" href=""
                                                   data-dismiss="modal"
                                                   data-target="#detailsBillModal{{ bill.id }}">
                                                    Open
                                                </a>
                                                {% if perms.home.change_bill or perms.home.delete_bill %}
                                                    <div class="dropdown-divider"></div>
                                                    {% if bill.paid and perms.home.change_bill %}
                                                        <a class="dropdown-item text-warning" href=""
                                                           data-dismiss="modal"
                                                           data-toggle="modal"
                                                           data-target="#paidConfirm{{ bill.id }}">
                                                            Set as pending
                                                        </a>
                                                    {% elif perms.home.change_bill %}
                                                        <a class="dropdown-item text-success" href=""
                                                           data-dismiss="modal"
                                                           data-toggle="modal"
                                                           data-target="#paidConfirm{{ bill.id }}">
                                                            Set as paid
                                                        </a>
                                                    {% endif %}
                                                    {% if perms.home.delete_bill %}
                                                        <a class="dropdown-item text-danger" href=""
                                                           data-dismiss="modal"
                                                           data-toggle="modal"
                                                           data-target="#deleteConfirm{{ bill.id }}">
                                                            Delete
                                                        </a>
                                                    {% endif %}
                                                {% endif %}
                                            </div>
                                        </div>
                                    </td>
                                </tr>

                                <tr>
                                    <td colspan="14" class="p-0 border-0">
                                        <div aria-labelledby="collapseDetailsLabel{{ bill.id }}" data-parent=".accordion" id="collapseDetails{{ bill.id }}" class="collapse">
                                            <ul class="list-group list-group-flush list border-top">
                                                {% for installment in bill.installments.all %}
                                                    {% if not installment.paid and installment.due_date|time_to_date <= 40 %}
                                                        
                                                        <li class="list-group-item px-4 border-0">
                                                            <div class="row mx-0 align-items-center">
                                                                <div class="col-auto p-0">
                                                                    <a class="badge badge-sm badge-secondary" href="#" role="button"
                                                                       data-toggle="modal" data-target="#editInstallment{{ installment.id }}">
                                                                        <i class="fas fa-eye"></i>
                                                                    </a>
                                                                </div>
                                                                {% if installment.paid %}
                                                                    <div class="col-auto pl-2 pr-0">
                                                                        <a class="badge badge-sm badge-success" href="" role="button"
                                                                           data-toggle="modal" data-target="#paidInstallmentConfirm{{ installment.id }}">
                                                                            <i class="fas fa-check"></i>
                                                                        </a>
                                                                    </div>
                                                                {% else %}
                                                                    <div class="col-auto pl-2 pr-0">
                                                                        <a class="badge badge-sm badge-warning" href="" role="button"
                                                                           data-toggle="modal" data-target="#paidInstallmentConfirm{{ installment.id }}">
                                                                            <i class="fas fa-hourglass-half"></i>
                                                                        </a>
                                                                    </div>
                                                                {% endif %}
                                                                <div class="col-auto pl-2">
                                                                    <a class="badge badge-sm badge-danger" href="#" role="button"
                                                                       data-toggle="modal" data-target="#deleteInstallmentConfirm{{ installment.id }}">
                                                                        <i class="fas fa-trash"></i>
                                                                    </a>
                                                                </div>
                                                                <div class="col-auto">
                                                                    <small>ID:</small>
                                                                    <h5 class="mb-0">{{ installment.partial_id }}/{{ bill.installments.count }}</h5>
                                                                </div>
                                                                <div class="col-auto">
                                                                    <small>Value:</small>
                                                                    <h5 class="mb-0">{{ installment.value }}</h5>
                                                                </div>
                                                                <div class="col-auto">
                                                                    <small>Due Date:</small>
                                                                    {% if installment.due_date|time_to_date < 10 and not installment.paid %}
                                                                        <h5 class="mb-0 text-warning">
                                                                    {% elif installment.due_date|time_to_date < 0 and not installment.paid %}
                                                                        <h5 class="mb-0 text-danger">
                                                                    {% elif installment.paid %}
                                                                        <h5 class="mb-0 text-success">
                                                                    {% else %}
                                                                        <h5 class="mb-0">
                                                                    {% endif %}
                                                                    {{ installment.due_date|date:"d/m/y"|default:"-" }}</h5>
                                                                </div>
                                                                <div class="col-auto">
                                                                    <small>Paid At:</small>
                                                                    {% if installment.paid %}
                                                                        <h5 class="mb-0">{{ installment.paid_at|date:"d/m/y" }}</h5>
                                                                    {% elif installment.due_date|time_to_date < 10 %}
                                                                        <h5 class="mb-0 text-warning">Pending</h5>
                                                                    {% elif installment.due_date|time_to_date < 0 %}
                                                                        <h5 class="mb-0 text-danger">Late</h5>
                                                                    {% else %}
                                                                        <h5 class="mb-0">Pending</h5>
                                                                    {% endif %}
                                                                </div>
                                                                <div class="col"></div>
                                                            </div>
                                                        </li>
    
                                                        <!-- Edit Installment Modal -->
                                                        <div class="modal fade" id="editInstallment{{ installment.id }}"
                                                             tabindex="-1" role="dialog"
                                                             aria-labelledby="editInstallmentLabel{{ installment.id }}"
                                                             aria-hidden="true">
                                                            <div class="modal-dialog modal-dialog-centered" role="document">
                                                                <div class="modal-content">
                                                                    <div class="modal-header mt-2" style="justify-content: center">
                                                                        <span class="my-1"
                                                                              style="margin: auto; font-size: 1.2rem"
                                                                              id="editInstallmentModalLabel{{ installment.id }}">
                                                                            ({{ installment.partial_id }}/{{ installment.bill.installments.count }}) 
                                                                            {{ installment.bill.title|truncatechars:30 }} 
                                                                        </span>
                                                                        <button type="button" class="close mt--4"
                                                                                style="margin-left: -30px"
                                                                                data-dismiss="modal"
                                                                                aria-label="Close">
                                                                            <span aria-hidden="true">&times;</span>
                                                                        </button>
                                                                    </div>
                                                                    <div class="modal-body py-0" style="padding-left: 2.5rem; padding-right: 2.5rem">
    
                                                                        <input type="hidden" value="{{ sorted_by }}"
                                                                               name="sort_by">
                                                                        <input type="hidden" value="{{ sort_type }}"
                                                                               name="sort_type">
                                                                        <input type="hidden" value="{{ filters }}"
                                                                               name="filters">

                                                                        <div class="row">
                                                                            <div class="col-sm form-group form-control-label">
                                                                                <label for="installment_value{{ installment.id }}">Value</label>
                                                                                <input type="text" class="form-control" 
                                                                                       id="installment_value{{ installment.id }}"
                                                                                       value="{{ installment.value }}" disabled>
                                                                            </div>
                                                                            <div class="col-sm-4 form-group form-control-label">
                                                                                <label for="dueDate">Due date</label>
                                                                                <input type="date" class="form-control" id="dueDate"
                                                                                       value="{{ installment.due_date|date:'Y-m-d' }}" 
                                                                                       disabled>
                                                                            </div>
                                                                            {% if installment.paid %}
                                                                                <div class="col-sm-4 form-group form-control-label">
                                                                                    <label for="paidAt">Paid at</label>
                                                                                    <input type="date"
                                                                                           class="form-control"
                                                                                           id="paidAt"
                                                                                           value="{{ installment.paid_at|date:'Y-m-d' }}"
                                                                                           disabled>
                                                                                </div>
                                                                            {% endif %}
                                                                        </div>
                                                                        <div class="form-group form-control-label">
                                                                                <label for="installmentEditInfoInput">Info</label>
                                                                                <textarea type="date" class="form-control"
                                                                                          id="installmentEditInfoInput"
                                                                                          name="installment_info" disabled
                                                                                >{{ installment.payment_info }}</textarea>
                                                                            </div>
    
                                                                    </div>
                                                                    <div class="modal-footer pt-1">
                                                                        <button type="button" class="btn btn-secondary"
                                                                                data-dismiss="modal">Cancel
                                                                        </button>
                                                                        <a href="#" target="_blank" data-dismiss="modal" data-toggle="modal"
                                                                           data-target="#paidInstallmentConfirm{{ installment.id }}" 
                                                                        {% if installment.paid %}
                                                                           class="btn btn-warning">
                                                                            Set as pending
                                                                        {% else %}
                                                                           class="btn btn-success">
                                                                            Set as paid
                                                                        {% endif %}
                                                                        </a>
                                                                        <a href="{% url 'client_balance' client.slug %}#bill{{ bill.id }}&{{ installment.id }}" 
                                                                           class="btn btn-primary">
                                                                            Edit
                                                                        </a>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                        <!-- Change status Modal -->
                                                        <div class="modal fade"
                                                             id="paidInstallmentConfirm{{ installment.id }}"
                                                             tabindex="-1"
                                                             role="dialog"
                                                             aria-labelledby="paidInstallmentConfirmLabel{{ installment.id }}"
                                                             aria-hidden="true">
                                                            <div class="modal-dialog modal-dialog-centered" role="document">
                                                                <div class="modal-content">
                                                                    <div class="modal-header mt-2">
                                                                        <h5 class="modal-title my-1"
                                                                            style="margin-left: auto">
                                                                            <i class="ni ni-fat-delete text-blue"
                                                                               style="font-size: 1.5rem; margin-top: 0.15rem !important"></i>
                                                                        </h5>
                                                                        <span class="ml-3 my-1"
                                                                              style="margin-right: auto; font-size: 1.2rem"
                                                                              id="paidConfirmModalLabel{{ installment.id }}">Are you sure?</span>
                                                                        <button type="button" class="close mt--4"
                                                                                style="margin-left: -30px"
                                                                                data-dismiss="modal"
                                                                                aria-label="Close">
                                                                            <span aria-hidden="true">&times;</span>
                                                                        </button>
                                                                    </div>
                                                                    <div class="modal-body py-0"
                                                                         style="padding-left: 2.5rem; padding-right: 2.5rem">
                                                                        <p class="text-center">Are you sure you want to
                                                                            change status of this
                                                                            bill?
                                                                            <br>
                                                                            This action can be undone.
                                                                        </p>
                                                                        <form method="post" id="paidInstallmentConfirmForm{{ installment.id }}"
                                                                              action="{% url 'change_client_bill_installment_status' client.slug bill.id installment.id %}" 
                                                                              onsubmit="disableByID('paidInstallmentConfirmButton{{ installment.id }}')">
                                                                            {% csrf_token %}
    
                                                                            <input type="hidden" value="{{ sorted_by }}"
                                                                                   name="sort_by">
                                                                            <input type="hidden" value="{{ sort_type }}"
                                                                                   name="sort_type">
                                                                            <input type="hidden" value="{{ filters }}"
                                                                                   name="filters">
                                                                            <input type="hidden" value="True"
                                                                                   name="client_page">
    
                                                                            <div class="row">
                                                                                <div class="col-sm-8 form-group form-control-label mb-3">
                                                                                    <label for="name">Title</label>
                                                                                    <input class="form-control" id="name"
                                                                                           value="{{ installment.bill.title }} ({{ installment.partial_id }}/{{ installment.bill.installments.count }})"
                                                                                           disabled>
                                                                                </div>
                                                                                <div class="col-sm-4 form-group form-control-label">
                                                                                    <label for="dueDate">Due date</label>
                                                                                    <input type="date" class="form-control"
                                                                                           id="dueDate"
                                                                                           value="{{ installment.due_date|date:'Y-m-d' }}"
                                                                                           disabled>
                                                                                </div>
                                                                            </div>
                                                                            <div class="row">
                                                                                <div class="col-sm form-group form-control-label">
                                                                                    <label for="total">Total</label>
                                                                                    <input inputmode="decimal"
                                                                                           class="form-control"
                                                                                           id="total"
                                                                                           value="{{ installment.value }}"
                                                                                           disabled>
                                                                                </div>
                                                                                {% if installment.paid %}
                                                                                    <div class="col-sm form-group form-control-label">
                                                                                        <label for="paidAt">Paid
                                                                                            at</label>
                                                                                        <input type="date"
                                                                                               class="form-control"
                                                                                               id="paidAt"
                                                                                               value="{{ installment.paid_at|date:'Y-m-d' }}"
                                                                                               disabled>
                                                                                    </div>
                                                                                {% else %}
                                                                                    <div class="col-sm form-group form-control-label">
                                                                                        <label for="billPaidInput">Paid
                                                                                            at</label>
                                                                                        <input type="date"
                                                                                               class="form-control"
                                                                                               id="billPaidInput"
                                                                                               name="bill_paid_at"
                                                                                               required
                                                                                               autofocus>
                                                                                    </div>
                                                                                {% endif %}
                                                                            </div>

                                                                            <div class="row">
                                                                                <div class="col-sm form-group form-control-label">
                                                                                    <label for="invoice">Invoice</label>
                                                                                    <input class="form-control"
                                                                                           id="invoice" name="invoice" 
                                                                                           value="{{ installment.invoice|default:'-' }}">
                                                                                </div>
                                                                                <div class="col-sm form-group form-control-label">
                                                                                    <label for="receipt">Receipt</label>
                                                                                    <input class="form-control"
                                                                                           id="receipt" name="receipt"
                                                                                           value="{{ installment.receipt|default:'-' }}">
                                                                                </div>
                                                                            </div>
                                                                            <div class="form-group form-control-label">
                                                                                <label for="authentication_key">Authentication
                                                                                    key</label>
                                                                                <input class="form-control"
                                                                                       id="authentication_key"
                                                                                       name="authentication_key"
                                                                                       value="{{ installment.authentication_key|default:'-' }}">
                                                                            </div>

                                                                            <div class="form-group form-control-label">
                                                                                <label for="installmentEditInfoInput">Info</label>
                                                                                <textarea type="date"
                                                                                          class="form-control"
                                                                                          id="installmentEditInfoInput"
                                                                                          name="installment_info"
                                                                                          {% if installment.paid %}disabled{% endif %}
                                                                                >{{ installment.payment_info }}</textarea>
                                                                            </div>
    
                                                                        </form>
                                                                    </div>
                                                                    <div class="modal-footer pt-1">
                                                                        <button type="button" class="btn btn-secondary"
                                                                                data-dismiss="modal">Cancel
                                                                        </button>
                                                                        {% if installment.paid %}
                                                                            <button type="submit" class="btn btn-warning"
                                                                                    id="paidInstallmentConfirmButton{{ installment.id }}"
                                                                                    form="paidInstallmentConfirmForm{{ installment.id }}">
                                                                                Set as pending
                                                                            </button>
                                                                        {% else %}
                                                                            <button type="submit" class="btn btn-success"
                                                                                    form="paidInstallmentConfirmForm{{ installment.id }}">
                                                                                Set as paid
                                                                            </button>
                                                                        {% endif %}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
    
                                                        <!-- Delete Modal -->
                                                        <div class="modal fade"
                                                             id="deleteInstallmentConfirm{{ installment.id }}"
                                                             tabindex="-1"
                                                             role="dialog" aria-labelledby="deleteInstallmentConfirmLabel{{ installment.id }}"
                                                             aria-hidden="true">
                                                            <div class="modal-dialog modal-dialog-centered" role="document">
                                                                <div class="modal-content">
                                                                    <div class="modal-header mt-2">
                                                                        <h5 class="modal-title my-1"
                                                                            style="margin-left: auto">
                                                                            <i class="ni ni-fat-delete text-blue"
                                                                               style="font-size: 1.5rem; margin-top: 0.15rem !important"></i>
                                                                        </h5>
                                                                        <span class="ml-3 my-1"
                                                                              style="margin-right: auto; font-size: 1.2rem"
                                                                              id="deleteInstallmentConfirmModalLabel{{ installment.id }}">Are you sure?</span>
                                                                        <button type="button" class="close mt--4"
                                                                                style="margin-left: -30px"
                                                                                data-dismiss="modal"
                                                                                aria-label="Close">
                                                                            <span aria-hidden="true">&times;</span>
                                                                        </button>
                                                                    </div>
                                                                    <div class="modal-body py-0"
                                                                         style="padding-left: 2.5rem; padding-right: 2.5rem">
                                                                        <p class="text-center">Are you sure you want to
                                                                            delete this
                                                                            installment?
                                                                            <br>
                                                                            This action cannot be undone.
                                                                        </p>
                                                                        <form method="post" id="deleteInstallmentConfirmForm{{ installment.id }}"
                                                                              action="{% url 'delete_client_bill_installment' client.slug bill.id installment.id %}" 
                                                                              onsubmit="disableByID('deleteInstallmentConfirmButton{{ installment.id }}')">
                                                                            {% csrf_token %}
                                                                            <input type="hidden" value="{{ sorted_by }}"
                                                                                   name="sort_by">
                                                                            <input type="hidden" value="{{ sort_type }}"
                                                                                   name="sort_type">
                                                                            <input type="hidden" value="{{ filters }}"
                                                                                   name="filters">
                                                                        </form>
                                                                        <div class="row">
                                                                            <div class="col form-group form-control-label mb-3">
                                                                                <label for="name">Title</label>
                                                                                <input class="form-control" id="name"
                                                                                       name="bill_name"
                                                                                       value="{{ installment.bill.title }} ({{ installment.partial_id }}/{{ bill.installments_number }})" disabled>
                                                                            </div>
                                                                        </div>
                                                                        <div class="row">
                                                                            <div class="col form-group form-control-label">
                                                                                <label for="billTotalInfo">Value</label>
                                                                                <input inputmode="decimal"
                                                                                       class="form-control"
                                                                                       id="billTotalInfo"
                                                                                       name="bill_total" placeholder=""
                                                                                       value="{{ installment.value }}" disabled>
                                                                            </div>
                                                                            <div class="col form-group form-control-label">
                                                                                <label for="billDueDateInput">Due
                                                                                    date</label>
                                                                                <input type="date" class="form-control"
                                                                                       id="billDueDateInput"
                                                                                       name="bill_due_date" placeholder=""
                                                                                       value="{{ installment.due_date|date:'Y-m-d' }}"
                                                                                       disabled>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="modal-footer pt-1">
                                                                        <button type="button" class="btn btn-secondary"
                                                                                data-dismiss="modal">Cancel
                                                                        </button>
                                                                        <button type="submit" class="btn btn-danger"
                                                                                id="deleteInstallmentConfirmButton{{ installment.id }}"
                                                                                form="deleteInstallmentConfirmForm{{ installment.id }}">
                                                                            Delete
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                    {% endif %}
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    </td>
                                </tr>

                                <!-- Details Modal -->
                                <div class="modal fade" id="detailsBillModal{{ bill.id }}" tabindex="-1"
                                     role="dialog"
                                     aria-labelledby="detailsBillModal{{ bill.id }}Label" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header mt-2 align-items-center">
                                                <h5 class="modal-title" style="margin-left: auto">
                                                    {% if bill.category in income_categories %}
                                                        <i class="fas fa-plus text-green"
                                                           style="font-size: 1rem"></i>
                                                    {% else %}
                                                        <i class="fas fa-minus text-danger"
                                                           style="font-size: 1rem"></i>
                                                    {% endif %}
                                                </h5>
                                                <span class="ml-3 my-1"
                                                      style="margin-right: auto; font-size: 1.2rem"
                                                      id="detailsBillModal{{ bill.id }}Label">{% if bill.title != '' %}
                                                    {{ bill.title|truncatechars:25 }}{% else %}
                                                    Bill{% endif %}</span>
                                                <button type="button" class="close mt--4"
                                                        style="margin-left: -30px"
                                                        data-dismiss="modal" aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="modal-body py-0" style="padding-left: 2.5rem; padding-right: 2.5rem">
                                                {# OFFICE / REGIONAL #}
                                                <div class="row">
                                                    <div class="col form-group form-control-label mb-3">
                                                        <label for="beneficiaryDetails">Office</label>
                                                        <input type="text" class="form-control" 
                                                               id="beneficiaryDetails" value="{{ bill.office.company_name }}" 
                                                               disabled>
                                                    </div>
                                                    <div class="col-6 form-group form-control-label mb-3">
                                                        <label for="regional">Regional</label>
                                                        <input type="text" id="regional" class="form-control" 
                                                               value="{{ bill.payer.name }}" disabled>
                                                    </div>
                                                </div>
                                                {# ORIGIN / METHOD #}
                                                <div class="row">
                                                    <div class="col-6 form-group form-control-label mb-3">
                                                        <label for="origin">Origin</label>
                                                        <input type="text" id="origin" class="form-control" 
                                                               value="{{ bill.origin }}" disabled>
                                                    </div>
                                                    <div class="col-6 form-group form-control-label mb-3">
                                                        <label for="categoryDetails">Category</label>
                                                        <input type="text" class="form-control" id="categoryDetails" 
                                                               value="{{ bill.category }}" disabled>
                                                    </div>
                                                </div>
                                                {# TOTAL / DUE DATE #}
                                                <div class="row">
                                                    <div class="col form-group form-control-label">
                                                        <label for="valueDetails{{ bill.id }}">Total</label>
                                                        <input type="text" class="form-control"
                                                               id="valueDetails{{ bill.id }}"
                                                               value="{{ bill.total }} ({{ bill.installments_number }}x)" disabled>
                                                    </div>
                                                    <div class="col form-group form-control-label"
                                                         style="flex: 0 0 30%; max-width: 30%">
                                                        <label for="methodDetails">Method</label>
                                                        <input type="text" class="form-control" id="methodDetails"
                                                               value="{{ bill.method }}" disabled>
                                                    </div>
                                                    <div class="col form-group form-control-label"
                                                         style="flex: 0 0 30%; max-width: 30%">
                                                        <label for="billDueDateInputDetails">
                                                            Due date
                                                        </label>
                                                        <input type="date" class="form-control"
                                                               id="billDueDateInputDetails"
                                                               value="{{ bill.due_date|date:'Y-m-d' }}" disabled>
                                                    </div>
                                                </div>
                                                {# CODE / PROOF #}
                                                {% if bill.proofs or bill.code or bill.link %}
                                                    {% if bill.code or bill.link %}
                                                        <div class="form-group form-control-label my-3 pr-0 align-items-center d-flex">
                                                            <a href="{{ bill.link|default:'#' }}">
                                                                <i class="fas fa-link px-2"></i> {{ bill.code|default:bill.link|truncatechars:50 }}
                                                            </a>
                                                        </div>
                                                    {% endif %}
                                                    {% if bill.proofs %}
                                                        {% for proof in bill.proofs.all %}
                                                            <div class="mb-1">
                                                                <a href="{% url 'download_client_proof' client.slug bill.id proof.id %}"
                                                                   class="px-2 text-success">
                                                                    <i class="fas fa-download text-sm"></i>
                                                                </a>
                                                                <span class="text-sm">{{ proof|file_name_only_with_extension|truncatechars:35 }}</span>
                                                            </div>
                                                        {% endfor %}
                                                    {% endif %}
                                                {% endif %}
                                            </div>
                                            <div class="modal-footer pb-4 pt-2">
                                                {% if perms.home.change_bill or bill.proofs %}
                                                    <button type="button" class="btn btn-secondary"
                                                            data-dismiss="modal">Cancel
                                                    </button>
                                                {% endif %}
                                                {% if bill.paid and perms.home.change_bill %}
                                                    <a class="btn btn-warning ml-1 mr-2" href="" data-dismiss="modal"
                                                       data-toggle="modal"
                                                       data-target="#paidConfirm{{ bill.id }}">
                                                        Set as pending
                                                    </a>
                                                {% elif perms.home.change_bill %}
                                                    <a class="btn btn-success ml-1 mr-2" href="" data-dismiss="modal"
                                                       data-toggle="modal"
                                                       data-target="#paidConfirm{{ bill.id }}">
                                                        Set as paid
                                                    </a>
                                                {% endif %}
                                                {% if perms.home.change_bill %}
                                                    <a href="{% url 'client_balance' client.slug %}#bill{{ bill.id }}" class="btn btn-primary mr-0">
                                                        Edit
                                                    </a>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Change Status Modal -->
                                <div class="modal fade"
                                     id="paidConfirm{{ bill.id }}"
                                     tabindex="-1"
                                     role="dialog" aria-labelledby="paidConfirmLabel{{ bill.id }}"
                                     aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header mt-2">
                                                <h5 class="modal-title my-1" style="margin-left: auto">
                                                    <i class="ni ni-fat-delete text-blue"
                                                       style="font-size: 1.5rem; margin-top: 0.15rem !important"></i>
                                                </h5>
                                                <span class="ml-3 my-1"
                                                      style="margin-right: auto; font-size: 1.2rem"
                                                      id="paidConfirmModalLabel{{ bill.id }}">Are you sure?</span>
                                                <button type="button" class="close mt--4"
                                                        style="margin-left: -30px" data-dismiss="modal"
                                                        aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="modal-body py-0"
                                                 style="padding-left: 2.5rem; padding-right: 2.5rem">
                                                <p class="text-center">Are you sure you want to change status of
                                                    this
                                                    bill?
                                                </p>
                                                <form method="post" id="paidConfirmForm{{ bill.id }}"
                                                      action="{% url 'change_client_bill_status' client.slug bill.id %}" 
                                                      onsubmit="disableByID('paidConfirmButton{{ bill.id }}')">
                                                    {% csrf_token %}
                                                
                                                    <input type="hidden" value="{{ sorted_by }}" name="sort_by">
                                                    <input type="hidden" value="{{ sort_type }}" name="sort_type">
                                                    <input type="hidden" value="{{ filters }}" name="filters">
                                                    <input type="hidden" value="True" name="client_page">
                                                
                                                    <div class="row">
                                                        <div class="col-sm-8 form-group form-control-label mb-3">
                                                            <label for="name">Title</label>
                                                            <input class="form-control" id="name"
                                                                   value="{{ bill.title }}" disabled>
                                                        </div>
                                                        <div class="col-sm-4 form-group form-control-label">
                                                            <label for="dueDate">Due date</label>
                                                            <input type="date" class="form-control"
                                                                   id="dueDate"
                                                                   value="{{ bill.due_date|date:'Y-m-d' }}"
                                                                   disabled>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm form-group form-control-label">
                                                            <label for="total">Total</label>
                                                            <input inputmode="decimal" class="form-control" id="total" 
                                                                   value="{{ bill.total }}" disabled>
                                                        </div>
                                                        {% if bill.paid %}
                                                            <div class="col-sm form-group form-control-label">
                                                                <label for="paidAt">Paid at</label>
                                                                <input type="date" class="form-control" id="paidAt"
                                                                       value="{{ bill.paid_at|date:'Y-m-d' }}" disabled>
                                                            </div>
                                                        {% else %}
                                                            <div class="col-sm form-group form-control-label">
                                                                <label for="billPaidInput">Paid at</label>
                                                                <input type="date" class="form-control" id="billPaidInput"
                                                                       name="bill_paid_at" required autofocus>
                                                            </div>
                                                        {% endif %}
                                                    </div>
                                                
                                                    <div class="row">
                                                        <div class="col-sm form-group form-control-label">
                                                            <label for="invoice">Invoice</label>
                                                            <input class="form-control" id="invoice" name="invoice"
                                                                   value="{{ installment.invoice|default:'-' }}">
                                                        </div>
                                                        <div class="col-sm form-group form-control-label">
                                                            <label for="receipt">Receipt</label>
                                                            <input class="form-control" id="receipt" name="receipt"
                                                                   value="{{ installment.receipt|default:'-' }}">
                                                        </div>
                                                    </div>
                                                    <div class="form-group form-control-label">
                                                        <label for="authentication_key">Authentication key</label>
                                                        <input class="form-control" id="authentication_key" 
                                                               name="authentication_key"
                                                               value="{{ installment.authentication_key|default:'-' }}">
                                                    </div>
                                                
                                                    <div class="form-group form-control-label">
                                                        <label for="installmentEditInfoInput">Info</label>
                                                        <textarea class="form-control"
                                                                  id="installmentEditInfoInput"
                                                                  name="payment_info"></textarea>
                                                    </div>
                                                
                                                </form>
                                            </div>
                                            <div class="modal-footer pt-1">
                                                <button type="button" class="btn btn-secondary"
                                                        data-dismiss="modal">Cancel
                                                </button>
                                                {% if bill.paid %}
                                                    <button type="submit" class="btn btn-warning"
                                                            id="paidConfirmButton{{ bill.id }}"
                                                            form="paidConfirmForm{{ bill.id }}">
                                                        Set as pending
                                                    </button>
                                                {% else %}
                                                    <button type="submit" class="btn btn-success"
                                                            id="paidConfirmButton{{ bill.id }}"
                                                            form="paidConfirmForm{{ bill.id }}">
                                                        Set as paid
                                                    </button>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Delete Modal -->
                                <div class="modal fade"
                                     id="deleteConfirm{{ bill.id }}"
                                     tabindex="-1"
                                     role="dialog" aria-labelledby="deleteConfirmLabel{{ bill.id }}"
                                     aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header mt-2">
                                                <h5 class="modal-title my-1" style="margin-left: auto">
                                                    <i class="ni ni-fat-delete text-blue"
                                                       style="font-size: 1.5rem; margin-top: 0.15rem !important"></i>
                                                </h5>
                                                <span class="ml-3 my-1"
                                                      style="margin-right: auto; font-size: 1.2rem"
                                                      id="deleteConfirmModalLabel{{ bill.id }}">Are you sure?</span>
                                                <button type="button" class="close mt--4"
                                                        style="margin-left: -30px" data-dismiss="modal"
                                                        aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="modal-body py-0"
                                                 style="padding-left: 2.5rem; padding-right: 2.5rem">
                                                <p class="text-center">Are you sure you want to delete this
                                                    bill?
                                                    <br>
                                                    This action cannot be undone.
                                                </p>
                                                <form method="post" id="deleteConfirmForm{{ bill.id }}"
                                                      action="{% url 'delete_client_bill' client.slug bill.id %}" 
                                                      onsubmit="disableByID('deleteConfirmButton{{ bill.id }}')">
                                                    {% csrf_token %}
                                                    <input type="hidden" value="{{ sorted_by }}" name="sort_by">
                                                    <input type="hidden" value="{{ sort_type }}"
                                                           name="sort_type">
                                                    <input type="hidden" value="{{ filters }}" name="filters">
                                                    <input type="hidden" value="True" name="client_page">
                                                </form>
                                                <div class="row">
                                                    <div class="col form-group form-control-label mb-3">
                                                        <label for="name">Title</label>
                                                        <input class="form-control" id="name"
                                                               name="bill_name"
                                                               value="{{ bill.title }}" disabled>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col form-group form-control-label mb-3">
                                                        <label for="beneficiary">Office</label>
                                                        <input class="form-control" id="beneficiary"
                                                               name="bill_beneficiary"
                                                               value="{% if bill.office.company_name %}{{ bill.office.company_name }}{% else %}N/A{% endif %}"
                                                               disabled>
                                                    </div>
                                                    <div class="col form-group form-control-label mb-3">
                                                        <label for="category">Category</label>
                                                        <input class="form-control" id="category"
                                                               name="bill_category"
                                                               value="{{ bill.category }}" disabled>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col form-group form-control-label">
                                                        <label for="billTotalInfo">Total</label>
                                                        <input inputmode="decimal"
                                                               class="form-control"
                                                               id="billTotalInfo"
                                                               name="bill_total" placeholder=""
                                                               value="{{ bill.total }}" disabled>
                                                    </div>
                                                    <div class="col form-group form-control-label">
                                                        <label for="billDueDateInput">Due
                                                            date</label>
                                                        <input type="date" class="form-control"
                                                               id="billDueDateInput"
                                                               name="bill_due_date" placeholder=""
                                                               value="{{ bill.due_date|date:'Y-m-d' }}"
                                                               disabled>
                                                    </div>
                                                </div>
                                                {% if bill.proofs %}
                                                    {% for proof in bill.proofs.all %}
                                                    <div>
                                                        <img src="/static/assets/img/icons/extensions/1x/{{ proof|file_extension_icon }}"
                                                             alt="" style="height: 18px">
                                                        <span class="ml-2 text-sm">{{ proof|file_name_only_with_extension }}</span>
                                                    </div>
                                                    {% endfor %}
                                                {% endif %}
                                            </div>
                                            <div class="modal-footer pt-1">
                                                <button type="button" class="btn btn-secondary"
                                                        data-dismiss="modal">Cancel
                                                </button>
                                                <button type="submit" class="btn btn-danger"
                                                        id="deleteConfirmButton{{ bill.id }}"
                                                        form="deleteConfirmForm{{ bill.id }}">
                                                    Delete
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer border-top-0 py-1"></div>
            </div>
        
        </div>
    
    </div>

</div>
    
<!-- Footer -->
<div class="container-fluid">
    {% include "includes/footer.html" %}
</div>

<!-- New Project Modal -->
<div class="modal fade" id="newPageModal" tabindex="-1" role="dialog"
         aria-labelledby="newPageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header mt-2">
                <h5 class="modal-title" style="margin-left: auto">
                    <i class="ni ni-bulb-61 text-blue" style="font-size: 2rem"></i>
                </h5>
                <span class="ml-3 my-1" style="margin-right: auto; font-size: 1.2rem"
                      id="newPageModalLabel">New Project</span>
                <button type="button" class="close mt--4" style="margin-left: -30px"
                        data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body py-0" style="padding-left: 2.5rem; padding-right: 2.5rem">
                <form id="newPageForm" method="post" action="{% url 'create_project' %}" 
                      onsubmit="disableByID('newPageButton')">
                    {% csrf_token %}
                    <input type="hidden" name="client" value="{{ client.id }}">
                    <div class="row">
                        <div class="col-sm-8 form-group form-control-label mb-3">
                            <label for="title">Title</label>
                            <input type="text" class="form-control" id="title" name="title"
                                   placeholder="">
                        </div>
                        <div class="col-sm-4 form-group form-control-label mb-3">
                            <label for="projectCountry">Country</label>
                            <select class="form-control" id="projectCountry" name="country">
                                <option value="br">Brazil</option>
                                <option value="pt">Portugal</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group form-control-label mb-3">
                        <label for="choices-collaborators">
                            Collaborators
                        </label>
                        <select id="choices-collaborators" name="collaborators-choice" multiple>
                            {% for collaborator in collaborators %}
                                <option value="{{ collaborator.id }}">{{ collaborator.user.get_full_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="form-group form-control-label">
                                <label for="start-date">Start</label>
                                <input type="date" id="start-date" name="start_date"
                                       class="form-control" required="" autofocus="">
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-group form-control-label">
                                <label for="deadline-date">Deadline</label>
                                <input type="date" id="deadline-date" name="deadline"
                                       class="form-control" required="" autofocus="">
                            </div>
                        </div>
                    </div>
                    <div class="form-group form-control-label">
                        <label for="about">About</label>
                        <textarea rows="4" class="form-control" id="about" name="about"
                                  placeholder="A few words about the project ..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">
                    Cancel
                </button>
                <button type="submit" class="btn btn-primary" id="newPageButton" form="newPageForm">
                    Create
                </button>
            </div>
        </div>
    </div>
</div>
    
<!-- New Regional Unit Modal -->
<div aria-hidden="true" aria-labelledby="newRegionalUnitModalLabel" class="modal fade" id="newRegionalUnitModal"
     role="dialog" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <span class="pl-4 mx-auto my-1" style="font-size: 1.2rem"
                      id="newPageModalLabel">
                    <i class="fas fa-warehouse text-blue mr-2"></i>
                    Add unit
                </span>
                <button aria-label="Close" class="close ml-0" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body py-0"
                 style="padding-left: 2.5rem; padding-right: 2.5rem">
                <form action="{% url 'new_client_branch' client.slug %}" enctype="multipart/form-data"
                      id="newRegionalUnitForm" method="post" onsubmit="disableByID('newRegionalUnitButton')">
                    {% csrf_token %}
                    <div class="form-group form-control-label">
                        <label for="regionalUnitNameInput">Name</label>
                        <input class="form-control" id="regionalUnitNameInput"
                               name="name" required="" autofocus=""
                               placeholder="" type="text">
                    </div>
                    <div class="row">
                        <div class="col-sm-4">
                            <div class="form-group form-control-label select-wizard">
                                <label for="country">Country</label>
                                <select id="country" name="country" class="form-control"
                                        onchange="loadStates()" autofocus="" required="">
                                    <option value="" disabled selected></option>
                                    {% for country in world %}
                                        <option value="{{ country }}">{{ country }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="form-group form-control-label bmd-form-group">
                                <label for="state">State</label>
                                <select id="state" name="state" class="form-control" disabled
                                        onchange="loadCities()">
                                    <option value="" disabled selected></option>
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="form-group form-control-label bmd-form-group">
                                <label for="city">City</label>
                                <select id="city" name="city" class="form-control" disabled>
                                    <option value="" disabled selected></option>
                                </select>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" form="uploadDocument"
                        id="cancelButtonFile" type="button">
                    Cancel
                </button>
                <button class="btn btn-primary" form="newRegionalUnitForm" id="newRegionalUnitButton"
                        type="submit">
                    Submit
                </button>
            </div>
        </div>
    </div>
</div>
    
<!-- Edit Client Modal -->
<div class="modal fade" id="editClientModal" tabindex="-1" role="dialog" aria-labelledby="editClientModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header mt-2 align-items-center">
                <h5 class="modal-title" style="margin-left: auto">
                    <i class="fas fa-user-tie text-blue" style="font-size: 1.5rem"></i>
                </h5>
                <span class="ml-3 my-1" style="margin-right: auto; font-size: 1.2rem" id="newEquipmentModalLabel">Edit Client</span>
                <button type="button" class="close mt--4" style="margin-left: -30px" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form method="post" action="{% url 'edit_client' client.slug %}" 
                  onsubmit="disableByID('editClientSubmitButton{{ client.id }}')">
                {% csrf_token %}
                <div class="modal-body py-0" style="padding-left: 2.5rem; padding-right: 2.5rem">
                    <div class="row">
                        <div class="col-7 form-group form-control-label mb-3">
                            <label for="name">Name</label>
                            <input type="text" class="form-control" id="name" name="name"
                                   placeholder="Client name" value="{{ client.name }}">
                        </div>
                        <div class="col-5 form-group form-control-label mb-3">
                            <label for="newclientcnpj">CNPJ</label>
                            <input type="text" class="form-control" id="newclientcnpj" name="cnpj"
                                   placeholder="00.000.000/0000-00" value="{{ client.cnpj }}">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-7 form-group form-control-label">
                            <label for="area">Area</label>
                            <input type="text" class="form-control"
                                   id="area" name="area" placeholder="Client area of activity" value="{{ client.area }}">
                        </div>
                        <div class="col-5 form-group form-control-label">
                            <label for="office">Office</label>
                            <select type="text" class="form-control"
                                   id="office" name="office">
                                <option value=""></option>
                                {% for office in offices %}
                                    <option value="{{ office.id }}" {% if office.id == client.office.id %}selected{% endif %}>
                                        {{ office.company_name }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="form-group form-control-label">
                        <label for="address">Address</label>
                        <input type="text" class="form-control"
                               id="address"
                               name="address" placeholder="Client address" value="{{ client.location }}">
                    </div>
                    <div class="row">
                        <div class="col-7 form-group form-control-label">
                            <label for="contact_email">Contact email</label>
                            <input type="email" id="contact_email" name="contact_email"
                                   class="form-control" placeholder="client@email.com" value="{{ client.contact_email }}">
                        </div>
                        <div class="col-5 form-group form-control-label">
                            <label for="phone">Phone</label>
                            <input type="text" id="phone" name="phone"
                                   class="form-control phone-input" placeholder="(00) 0000-0000" value="{{ client.phone }}">
                        </div>
                    </div>
                    <div class="form-group form-control-label">
                        <label for="xml_email">XML</label>
                        <input type="email" id="area" name="xml_email"
                               class="form-control" placeholder="xml@email.com" value="{{ client.xml_email }}">
                    </div>
                    <div class="form-group form-control-label">
                        <label for="about">About</label>
                        <textarea rows="4" class="form-control" id="about" name="about"
                                  placeholder="A few words about the client ...">{{ client.description }}</textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary" id="editClientSubmitButton{{ client.id }}">
                        Save changes
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
    
<!-- Change Picture Modal -->
<div class="modal fade" id="pictureModal" tabindex="-1" role="dialog"
     aria-labelledby="pictureModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document" style="max-width: 500px">
        <div class="modal-content">
            <div class="modal-header mt-2">
                <button type="button" class="close ml-auto mt--4" style="margin-left: -30px"
                        data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body py-0"
                 style="padding-left: 2.5rem; padding-right: 2.5rem">
                <form id="pictureForm" method="post" action="{% url 'change_client_picture' client.slug %}"
                      enctype="multipart/form-data" onsubmit="disableByID('pictureUploadButton')">
                    {% csrf_token %}
                    <div class="form-group my-5 mb-0"
                         style="display: flex; justify-content: center">
                        <div class="card-profile-image align-items-center justify-content-center"
                             style="background-color: #adb5bd00; height: 180px; display: flex">
                            <input type="file" id="pictureInput" style="display: none"
                                   accept="image/*" name="avatar" required>
                            <label for="pictureInput">
                                <img class="rounded-circle pointer-hover"
                                     style="min-width: 230px; height: 230px; object-fit: cover; background-color: #fff; z-index: 1"
                                     id="pictureAvatar"
                                     src="{{ client.avatar.url|default:'/static/assets/img/icons/placeholder.webp' }}"
                                     alt="Picture">
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal"
                        id="cancelButton">Cancel
                </button>
                <button type="submit" class="btn btn-primary" form="pictureForm"
                        id="pictureUploadButton">Upload
                </button>
            </div>
        </div>
    </div>
</div>

{% endblock content %}

<!-- Specific JS goes HERE -->
{% block javascripts %}
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/5.0.6/jquery.inputmask.min.js"></script>
    
    <script>
    
        document.getElementById('newclientcnpj').addEventListener('input', function (event) {
            let input = event.target;
            let inputValue = input.value.replace(/\D/g, '');

            if (inputValue.length <= 2) {
                input.value = inputValue.replace(/^(\d{0,2})/, '$1');
            } else if (inputValue.length <= 5) {
                input.value = inputValue.replace(/^(\d{2})(\d{0,3})/, '$1.$2');
            } else if (inputValue.length <= 8) {
                input.value = inputValue.replace(/^(\d{2})(\d{3})(\d{0,3})/, '$1.$2.$3');
            } else if (inputValue.length <= 12) {
                input.value = inputValue.replace(/^(\d{2})(\d{3})(\d{3})(\d{0,4})/, '$1.$2.$3/$4');
            } else if (inputValue.length <= 14) {
                input.value = inputValue.replace(/^(\d{2})(\d{3})(\d{3})(\d{4})(\d{0,2})/, '$1.$2.$3/$4-$5');
            } else {
                input.value = inputValue.replace(/^(\d{2})(\d{3})(\d{3})(\d{4})(\d{2}).*/, '$1.$2.$3/$4-$5');
            }
        });
        
    </script>
    
    <script>
    
        function formatPhone(input) {
            let inputValue = input.value.replace(/\D/g, '');

            if (inputValue.length === 0) {
                input.value = inputValue.replace(/^(\d{0,3})/, '$1');
            } else if (inputValue.length <= 3) {
                input.value = inputValue.replace(/^(\d{0,3})/, '$1');
            } else if (inputValue.length <= 6) {
                input.value = inputValue.replace(/^(\d{3})(\d{0,3})/, '$1 $2');
            } else if (inputValue.length <= 9) {
                input.value = inputValue.replace(/^(\d{3})(\d{3})(\d{0,3})/, '$1 $2 $3');
            } else if (inputValue.length <= 10) {
                input.value = inputValue.replace(/^(\d{2})(\d{4})(\d{4})/, '($1) $2-$3');
            } else if (inputValue.length <= 11) {
                input.value = inputValue.replace(/^(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
            } else if (inputValue.length <= 12) {
                input.value = inputValue.replace(/^(\d{3})(\d{3})(\d{3})(\d{3})/, '+$1 $2 $3 $4');
            } else if (inputValue.length <= 13) {
                input.value = inputValue.replace(/^(\d{2})(\d{2})(\d{5})(\d{4})/, '+$1 ($2) $3 $4');
            } else {
                input.value = inputValue.replace(/^(\d{2})(\d{2})(\d{5})(\d{4}).*/, '+$1 ($2) $3 $4');
            }
        }
        
        document.querySelectorAll('.phone-input').forEach(function (element) {
            element.addEventListener('input', function (event) {
                formatPhone(event.target);
            });
        });
        
    </script>

    <script>

        function previewExtension(event) {
            const preview = document.getElementById('filePreviewModalImage');
            const fileInput = event.target;

            if (fileInput.files && fileInput.files[0]) {
                const file = fileInput.files[0];
                const extension = file.name.split('.').pop().toLowerCase();

                // Define a mapping of file extensions to image URLs
                const extensionImageMap = {
                    'rvt': '/static/assets/img/icons/extensions/1x/rvt.png',
                    'stp': '/static/assets/img/icons/extensions/1x/stp.png',
                    'igs': '/static/assets/img/icons/extensions/1x/igs.png',
                    'ifc': '/static/assets/img/icons/extensions/1x/ifc.png',
                    'sat': '/static/assets/img/icons/extensions/1x/sat.png',
                    'dxf': '/static/assets/img/icons/extensions/1x/dxf.png',
                    'dwg': '/static/assets/img/icons/extensions/1x/dwg.png',
                    'prt': '/static/assets/img/icons/extensions/1x/prt.png',
                    'catpart': '/static/assets/img/icons/extensions/1x/catpart.png',
                    'catproduct': '/static/assets/img/icons/extensions/1x/catproduct.png',
                    'cgr': '/static/assets/img/icons/extensions/1x/cgr.png',
                    'obj': '/static/assets/img/icons/extensions/1x/obj.png',
                    'stl': '/static/assets/img/icons/extensions/1x/stl.png',
                    'jt': '/static/assets/img/icons/extensions/1x/jt.png',
                    'dgn': '/static/assets/img/icons/extensions/1x/dgn.png',
                    'fbx': '/static/assets/img/icons/extensions/1x/fbx.png',
                    'sldprt': '/static/assets/img/icons/extensions/1x/sldprt.png',
                    'sldasm': '/static/assets/img/icons/extensions/1x/sldasm.png',
                    'rcp': '/static/assets/img/icons/extensions/1x/rcp.png',
                    'rcs': '/static/assets/img/icons/extensions/1x/rcs.png',
                    'pod': '/static/assets/img/icons/extensions/1x/pod.png',
                    'fls': '/static/assets/img/icons/extensions/1x/fls.png',
                    'las': '/static/assets/img/icons/extensions/1x/las.png',
                    'e57': '/static/assets/img/icons/extensions/1x/e57.png',
                    'py': '/static/assets/img/icons/extensions/1x/py.png',
                    'html': '/static/assets/img/icons/extensions/1x/html.png',
                    'css': '/static/assets/img/icons/extensions/1x/css.png',
                    'js': '/static/assets/img/icons/extensions/1x/js.png',
                    'cs': '/static/assets/img/icons/extensions/1x/cs.png',
                    'c': '/static/assets/img/icons/extensions/1x/c.png',
                    'cpp': '/static/assets/img/icons/extensions/1x/cpp.png',
                    'json': '/static/assets/img/icons/extensions/1x/json.png',
                    'xml': '/static/assets/img/icons/extensions/1x/xml.png',
                    'kt': '/static/assets/img/icons/extensions/1x/kt.png',
                    'kts': '/static/assets/img/icons/extensions/1x/kts.png',
                    'exe': '/static/assets/img/icons/extensions/1x/exe.png',
                    'zip': '/static/assets/img/icons/extensions/1x/zip.png',
                    'rar': '/static/assets/img/icons/extensions/1x/rar.png',
                    'assets': '/static/assets/img/icons/extensions/1x/assets.png',
                    'asset': '/static/assets/img/icons/extensions/1x/assets.png',
                    'ress': '/static/assets/img/icons/extensions/1x/ress.png',
                    'sqlite3': '/static/assets/img/icons/extensions/1x/sqlite3.png',
                    'xlsx': '/static/assets/img/icons/extensions/1x/xlsx.png',
                    'docx': '/static/assets/img/icons/extensions/1x/docx.png',
                    'pptx': '/static/assets/img/icons/extensions/1x/pptx.png',
                    'pdf': '/static/assets/img/icons/extensions/1x/pdf.png',
                    'ai': '/static/assets/img/icons/extensions/1x/ai.png',
                    'jpg': '/static/assets/img/icons/extensions/1x/jpg.png',
                    'jpeg': '/static/assets/img/icons/extensions/1x/jpeg.png',
                    'png': '/static/assets/img/icons/extensions/1x/png.png',
                    'gif': '/static/assets/img/icons/extensions/1x/gif.png',
                    'webp': '/static/assets/img/icons/extensions/1x/webp.png',
                    'ico': '/static/assets/img/icons/extensions/1x/ico.png',
                    'mp4': '/static/assets/img/icons/extensions/1x/mp4.png',
                    'avi': '/static/assets/img/icons/extensions/1x/avi.png',
                    'mkv': '/static/assets/img/icons/extensions/1x/mkv.png',
                    'wmv': '/static/assets/img/icons/extensions/1x/wmv.png',
                    'txt': '/static/assets/img/icons/extensions/1x/txt.png',
                    'x_t': '/static/assets/img/icons/extensions/1x/x_t.png',
                    'x_b': '/static/assets/img/icons/extensions/1x/x_b.png',
                    'apk': '/static/assets/img/icons/extensions/1x/apk.png',
                    // Add more extensions and URLs as needed
                };

                // Check if there's a corresponding image URL for the extension
                if (extensionImageMap[extension]) {
                    preview.src = extensionImageMap[extension];
                } else {
                    // If no specific image found, display a default image
                    preview.src = '/static/assets/img/icons/extensions/1x/default.png';
                }
            }
        }
        
        function copyToClipboard(element, link) {
            navigator.clipboard.writeText(element).then(function () {
                // Update the tooltip title using Bootstrap Tooltip method
                $(link).attr('data-original-title', 'Copied!').tooltip('show');
            }).catch(function (err) {
                console.error('Unable to copy to clipboard', err);
            });
        }
        
        function clearTitle(element, link) {
            $(link).attr('data-original-title', element).tooltip('hide');
        }

    </script>

    <script>
    
        document.getElementById('pictureInput').addEventListener('change', function (event) {
            const fileInput = event.target;
            const previewImage = document.getElementById('pictureAvatar');

            const file = fileInput.files[0];
            if (file) {
                // Read the selected file as a data URL and set it as the source of the image
                const reader = new FileReader();
                reader.onload = function (e) {
                    previewImage.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

    </script>
    
    <script>
    
        $(document).ready(function () {
            function setupInput(input) {
                input.inputmask({
                    alias: "numeric",
                    radixPoint: ",",
                    groupSeparator: ".",
                    autoGroup: true,
                    rightAlign: false,
                    autoUnmask: true,
                    numericInput: true,
                    prefix: "",
                });
            }

            setupInput($("#valueInput"));
            setupInput($("#billInstallmentsValueInput"));
            
            $('[id^="valueInputDetails"]').each(function () {
                setupInput($(this));
            });
            
            $('[id^="billInstallmentsValueInputDetails"]').each(function () {
                setupInput($(this));
            });
        });
        
    </script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            let tagsInput = document.getElementById('choices-collaborators');

            let choices = new Choices(tagsInput, {
                removeItemButton: true,
                maxItemCount: 20,
            });
        });
    </script>

    <script>
        const jsonData = {{ world|safe }};
        const countryDropdown = document.getElementById('country');
        const stateDropdown = document.getElementById('state');
        const cityDropdown = document.getElementById('city');

        // Populate the country dropdown
        for (const country in jsonData) {
            const option = document.createElement('option');
            option.value = country;
            option.text = country;
            countryDropdown.add(option);
        }

        function loadStates() {
            // Clear existing options
            stateDropdown.innerHTML = '<option value="" disabled selected></option>';

            const selectedCountry = countryDropdown.value;

            if (selectedCountry && jsonData[selectedCountry]) {
                // Enable the state dropdown
                stateDropdown.disabled = false;

                // Populate the state dropdown
                for (const state in jsonData[selectedCountry]) {
                    const option = document.createElement('option');
                    option.value = state;
                    option.text = state;
                    stateDropdown.add(option);
                }
            } else {
                // If no country is selected, disable the state and city dropdowns
                stateDropdown.disabled = true;
                cityDropdown.disabled = true;
            }
        }

        function loadCities() {
            // Clear existing options
            cityDropdown.innerHTML = '<option value="" disabled selected></option>';

            const selectedCountry = countryDropdown.value;
            const selectedState = stateDropdown.value;

            if (selectedCountry && selectedState && jsonData[selectedCountry][selectedState]) {
                // Enable the city dropdown
                cityDropdown.disabled = false;

                // Populate the city dropdown
                for (const city of jsonData[selectedCountry][selectedState]) {
                    const option = document.createElement('option');
                    option.value = city;
                    option.text = city;
                    cityDropdown.add(option);
                }
            } else {
                // If no country or state is selected, disable the city dropdown
                cityDropdown.disabled = true;
            }
        }

        function loadEditStates(id, value) {
            const countryDropdown = document.getElementById('editCountry' + id);
            const stateDropdown = document.getElementById('editState' + id);
            const cityDropdown = document.getElementById('editCity' + id);
            // Clear existing options
            stateDropdown.innerHTML = '<option value="" disabled selected></option>';

            const selectedCountry = countryDropdown.value;
            console.log('Selected country: ' + selectedCountry)

            if (selectedCountry && jsonData[selectedCountry]) {
                // Enable the state dropdown
                stateDropdown.disabled = false;

                // Populate the state dropdown
                for (const state in jsonData[selectedCountry]) {
                    const option = document.createElement('option');
                    option.value = state;
                    option.text = state;
                    stateDropdown.add(option);
                }
                
                if (value) {
                    stateDropdown.value = value;
                }
                
            } else {
                // If no country is selected, disable the state and city dropdowns
                stateDropdown.disabled = true;
                cityDropdown.disabled = true;
            }
        }

        function loadEditCities(id, value) {
            const countryDropdown = document.getElementById('editCountry' + id);
            const stateDropdown = document.getElementById('editState' + id);
            const cityDropdown = document.getElementById('editCity' + id);
            // Clear existing options
            cityDropdown.innerHTML = '<option value="" disabled selected></option>';

            const selectedCountry = countryDropdown.value;
            const selectedState = stateDropdown.value;

            if (selectedCountry && selectedState && jsonData[selectedCountry][selectedState]) {
                // Enable the city dropdown
                cityDropdown.disabled = false;

                // Populate the city dropdown
                for (const city of jsonData[selectedCountry][selectedState]) {
                    const option = document.createElement('option');
                    option.value = city;
                    option.text = city;
                    cityDropdown.add(option);
                }
                
                if (value) {
                    cityDropdown.value = value;
                }
                
            } else {
                // If no country or state is selected, disable the city dropdown
                cityDropdown.disabled = true;
            }
        }
        
        window.onload = function () {
            let branches_states = {{ client.branches.all|get_states|safe }};
            let branches_cities = {{ client.branches.all|get_cities|safe }};
            try {
                for (let id in branches_states) {
                    loadEditStates(id, branches_states[id]);
                }
                for (let id in branches_cities) {
                    loadEditCities(id, branches_cities[id]);
                }
            } catch (e) {}
        };

        document.addEventListener('DOMContentLoaded', function () {
            let collapseElements = document.querySelectorAll('[data-toggle="collapse"]');

            collapseElements.forEach(function (element) {
                element.addEventListener('click', function (event) {
                    let target = document.querySelector(this.getAttribute('data-target'));
                    let icon = this.querySelector('.rotate');

                    if (target.classList.contains('show')) {
                        icon.classList.remove('down');
                    } else {
                        icon.classList.add('down');
                    }
                });
            });
        });
        
    </script>

{% endblock javascripts %}
