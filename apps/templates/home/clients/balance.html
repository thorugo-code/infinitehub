{% extends 'layouts/base.html' %}

{% block title %} {{ client.name }} {% endblock title %}

{% block stylesheets %}
    
    <style>
        .rotate {
            transition: transform 0.3s ease;
        }
        .rotate.down {
            transform: rotate(180deg);
        }
    </style>
    
{% endblock stylesheets %}

{% block content %}

{% load filters %}

<!-- Header container -->
<div class="header bg-primary pb-6">
    <div class="container-fluid">
        <div class="header-body">
            <div class="row align-items-center py-4">
                <div class="col-lg-6 col-7">
                    <nav aria-label="breadcrumb" class="d-none d-md-inline-block ml-md-4">
                        <ol class="breadcrumb breadcrumb-links breadcrumb-dark">
                            <li class="breadcrumb-item">
                                <a href="/">
                                    <i class="fas fa-home m-0"></i>
                                </a>
                            </li>
                            <li class="breadcrumb-item">
                                <a href="{% url 'clients_home' %}">
                                    Clients
                                </a>
                            </li>
                            <li class="breadcrumb-item active">
                                <a href="{% url 'client_details' client.slug %}">
                                    {{ client.name|default:client.slug|truncatechars:20 }}
                                </a>
                            </li>
                            <li class="breadcrumb-item active">
                                Balance
                            </li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Page content -->
<div class="container-fluid mt--6">

    <!-- Client Infos Row -->
    <div class="row">

        <!-- Client Title Column -->
        <div class="col-lg-7">
            <div class="card card-stats" style="height: calc(100% - 30px)">
                <div class="card-body align-items-center py-5 py-lg-4" style="display: flex">
                    <div class="row px-md-4">
                        <div class="col-md-auto align-items-center mb-md-0 mb-3 justify-content-center"
                             style="display: flex;">
                            <a href="{% url 'client_details' client.slug %}">
                                <img class="rounded-circle"
                                     style="width: 110px; height: 110px; object-fit: cover; background-color: #fff; z-index: 1"
                                     src="{{ client.avatar.url }}" alt="{{ client.name }}">
                            </a>
                        </div>
                        <div class="col-md align-items-center" style="display: flex;">
                            <div class="pl-2 row">
                            <span class="h3 p-0 m-0 pl-4">
                                <span>{{ client.name }}</span>
                                <small class="d-block h5 font-weight-light text-muted">{{ client.area|default:'Client Area' }}</small>
                                {% if client.description %}
                                    <div class="h5 font-weight-500">
                                        <i>" {{ client.description }} "</i>
                                    </div>
                                {% endif %}
                            </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contact Infos Column -->
        <div class="col-lg-5">
            <div class="card card-stats" style="height: calc(100% - 30px)">
                <div class="card-body py-lg-4">
                    <div class="row align-items-center" style="height: 100%">
                        <div class="col">
                            <div class="h5 mt-2 pl-2">
                                <a data-toggle="tooltip" data-placement="top" title="Copy" class="pointer-hover"
                                   onpointerdown="copyToClipboard('{{ client.contact_email }}', this)"
                                   onpointerleave="clearTitle('Copy', this)">
                                    <i class="fas fa-envelope pr-2 font-weight-light text-blue m-0"
                                       style="font-size: 90%"></i>
                                </a>
                                {{ client.contact_email }}
                            </div>
                            {% if client.phone %}
                                <div class="h5 font-weight-light pl-2">
                                    <a data-toggle="tooltip" data-placement="top" title="Copy" class="pointer-hover"
                                       onpointerdown="copyToClipboard('{{ client.phone }}', this)"
                                       onpointerleave="clearTitle('Copy', this)">
                                        <i class="fas fa-phone pr-2 text-blue m-0" style="font-size: 90%"></i>
                                    </a>
                                    {{ client.phone }}
                                </div>
                            {% endif %}
                            {% if client.location %}
                                <div class="h5 font-weight-400 pl-2">
                                    <a data-toggle="tooltip" data-placement="top" title="Copy" class="pointer-hover"
                                       onpointerdown="copyToClipboard('{{ client.location }}', this)"
                                       onpointerleave="clearTitle('Copy', this)">
                                        <i class="fas fa-map-marker-alt pr-2 text-blue m-0" style="font-size: 90%"></i>
                                    </a>
                                    <span>{{ client.location }}</span>
                                </div>
                            {% endif %}
                            {% if client.xml_email %}
                                <div class="h5 font-weight-light pl-2">
                                    <a data-toggle="tooltip" data-placement="top" title="Copy" class="pointer-hover"
                                       onpointerdown="copyToClipboard('{{ client.xml_email }}', this)"
                                       onpointerleave="clearTitle('Copy', this)">
                                        <i class="fas fa-copy pr-2 font-weight-light text-blue m-0"
                                           style="font-size: 90%"></i>
                                    </a>
                                    {{ client.xml_email }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Card stats -->
    <div class="row">
        <div class="col-xl-3 col-md-6">
            <div class="card bg-gradient-green border-0" style="height: calc(100% - 30px)">
                <div class="card-body py-4 align-items-center d-flex">
                    <div class="row">
                        <div class="col">
                            <h5 class="card-title text-uppercase text-muted mb-0 text-white">Received</h5>
                            <span class="h3 font-weight-bold mb-0 text-white">
                            {{ received|default:'0.00' }} / {{ income|default:'0.00' }}
                        </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="card bg-gradient-info border-0" style="height: calc(100% - 30px)">
                <div class="card-body py-4 align-items-center d-flex">
                    <div class="row">
                        <div class="col">
                            <h5 class="card-title text-uppercase text-muted mb-0 text-white">Paid</h5>
                            <span class="h3 font-weight-bold mb-0 text-white">
                            {{ paid|default:'0.00' }} / {{ expense|default:'0.00' }}
                        </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="card bg-gradient-warning border-0" style="height: calc(100% - 30px)">
                <div class="card-body py-4 align-items-center d-flex">
                    <div class="row">
                        <div class="col">
                            <h5 class="card-title text-uppercase text-muted mb-0 text-white">Pending</h5>
                            <span class="h3 font-weight-bold mb-0 text-white align-items-center d-flex">
                                <i class="fas fa-plus-circle mr-2 mt-1" style="font-size: 0.8rem"></i>
                                {{ pending_income|default:'0.00' }}
                            </span>
                            <span class="h3 font-weight-bold mb-0 text-white align-items-center d-flex">
                                <i class="fas fa-minus-circle mr-2 mt-1" style="font-size: 0.8rem"></i>
                                {{ pending_expense|default:'0.00' }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="card bg-gradient-danger border-0" style="height: calc(100% - 30px)">
                <div class="card-body py-4 align-items-center d-flex">
                    <div class="row">
                        <div class="col">
                            <h5 class="card-title text-uppercase text-muted mb-0 text-white">Late</h5>
                            <span class="h3 font-weight-bold mb-0 text-white align-items-center d-flex">
                                <i class="fas fa-plus-circle mr-2 mt-1" style="font-size: 0.8rem"></i>
                                {{ late_income|default:'0.00' }}
                            </span>
                            <span class="h3 font-weight-bold mb-0 text-white align-items-center d-flex">
                                <i class="fas fa-minus-circle mr-2 mt-1" style="font-size: 0.8rem"></i>
                                {{ late_expense|default:'0.00' }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bills Card -->
    <div class="card">
        <div class="card-header">
            <div class="row align-items-center">
                <div class="col align-items-center">
                    <span class="h5 font-weight-light mb-0 mr-sm-1">({{ bills.all.count }})</span>
                    <span class="h3 mb-0">Bills</span>
                </div>
                <div class="col text-right">
                    <a class="btn btn-sm {% if sorted_by is None %}btn-neutral{% else %}btn-primary{% endif %}"
                       data-target="#sortBillModal" data-toggle="modal" href="#">
                        {% if sort_type == 'desc' %}
                            <i class="fas fa-caret-down mr-0"></i>{% elif sort_type == 'asc' %}
                            <i class="fas fa-caret-up mr-0"></i>{% endif %}
                        {% if sorted_by == 'installments_value' %}
                            <span class="ml-1">$ Installments</span>
                        {% elif sorted_by == 'installments_number' %}
                            <span class="ml-1">NÂº Installments</span>
                        {% elif sorted_by == 'payer' %}
                            <span>Regional</span>
                        {% elif sorted_by is not None %}
                            <span>{{ sorted_by|capfirst }}</span>
                        {% else %}
                            <i class="m-0 fas fa-sort"></i>
                        {% endif %}
                    </a>
                    <a class="btn btn-sm {% if filters is None %}btn-neutral{% else %}btn-primary{% endif %}"
                       data-target="#filterBillModal" data-toggle="modal" href="#">
                        <i class="fas fa-filter {% if filters is None %}{% else %}mr-0{% endif %}"></i>
                        {% if filters is not None %}
                            {% load filters %}
                            {% with filters_list=filters|split:'&' %}
                                {% if filters|both_from_to %}
                                    <span>Date</span>
                                {% endif %}
                                {% for filter_item in filters_list %}
                                    {% if 'from=' in filter_item or 'to=' in filter_item %}
                                        {% if filters|xor_from_to %}
                                            <span>Date</span>
                                        {% endif %}
                                    {% elif 'payer=' in filter_item %}
                                        <span>{% if not filters|first_filter:'payer' %} | {% endif %}
                                            Regional</span>
                                    {% elif 'office=' in filter_item %}
                                        <span>{% if not filters|first_filter:'office' %} | {% endif %}
                                            Office</span>
                                    {% elif 'category=' in filter_item %}
                                        <span>{% if not filters|first_filter:'category' %} | {% endif %}
                                            Category</span>
                                    {% elif 'origin=' in filter_item %}
                                        <span>{% if not filters|first_filter:'origin' %} | {% endif %}
                                            Origin</span>
                                    {% elif 'method=' in filter_item %}
                                        <span>{% if not filters|first_filter:'method' %} | {% endif %}
                                            Method</span>
                                    {% elif 'installments=' in filter_item %}
                                        <span>{% if not filters|first_filter:'installments' %} | {% endif %}
                                            Installments</span>
                                    {% elif 'code=' in filter_item %}
                                        <span>{% if not filters|first_filter:'code' %} | {% endif %}
                                            Code</span>
                                    {% endif %}
                                {% endfor %}
                                {% if 'late=' in filters %}
                                    <span>{% if not filters|first_filter:'late' %} | {% endif %}
                                        Status
                                    </span>
                                {% elif 'paid=' in filters %}
                                    <span>{% if not filters|first_filter:'paid' %} | {% endif %}
                                        Status
                                    </span>
                                {% elif 'pending' in filters %}
                                    <span>{% if not filters|first_filter:'pending' %} | {% endif %}
                                        Status
                                    </span>
                                {% endif %}
                                {% if 'value_min=' in filters %}
                                    <span>{% if not filters|first_filter:'value_min' %} | {% endif %}
                                        Total
                                    </span>
                                {% elif 'value_max=' in filters %}
                                    <span>{% if not filters|first_filter:'value_max' %} | {% endif %}
                                        Total
                                    </span>
                                {% endif %}
                            {% endwith %}
                        {% endif %}
                    </a>
                    <a class="btn btn-sm btn-neutral" data-toggle="modal" data-target="#newBillModal"
                       href="">
                        <i class="fas fa-plus m-0"></i>
                    </a>
                </div>
            </div>
        </div>
        <div class="table-responsive" style="height: 35rem; overflow-y: auto">
            <table class="table align-items-center table-flush">
                <thead class="thead-light">
                    <tr>
                        <th scope="col" class="py-1 px-0" style="width: 0"></th>
                        <th scope="col" class="pl-3">
                            Title / Status
                            {% if sorted_by == 'title' %}
                                {% if sort_type == 'asc' %}
                                    <i class="m-0 fas fa-caret-up"></i>
                                {% elif sort_type == 'desc' %}
                                    <i class="m-0 fas fa-caret-down"></i>
                                {% endif %}
                            {% endif %}
                        </th>
                        <th scope="col">
                            Code
                            {% if sorted_by == 'code' %}
                                {% if sort_type == 'asc' %}
                                    <i class="m-0 fas fa-caret-up"></i>
                                {% elif sort_type == 'desc' %}
                                    <i class="m-0 fas fa-caret-down"></i>
                                {% endif %}
                            {% endif %}
                        </th>
                        <th scope="col">
                            Regional
                            {% if sorted_by == 'payer' %}
                                {% if sort_type == 'asc' %}
                                    <i class="m-0 fas fa-caret-up"></i>
                                {% elif sort_type == 'desc' %}
                                    <i class="m-0 fas fa-caret-down"></i>
                                {% endif %}
                            {% endif %}
                        </th>
                        <th scope="col">
                            Expiration
                            {% if sorted_by == 'expiration' %}
                                {% if sort_type == 'asc' %}
                                    <i class="m-0 fas fa-caret-up"></i>
                                {% elif sort_type == 'desc' %}
                                    <i class="m-0 fas fa-caret-down"></i>
                                {% endif %}
                            {% endif %}
                        </th>
                        <th scope="col">
                            Category
                            {% if sorted_by == 'category' %}
                                {% if sort_type == 'asc' %}
                                    <i class="m-0 fas fa-caret-up"></i>
                                {% elif sort_type == 'desc' %}
                                    <i class="m-0 fas fa-caret-down"></i>
                                {% endif %}
                            {% endif %}
                        </th>
                        <th scope="col">
                            Office
                            {% if sorted_by == 'office' %}
                                {% if sort_type == 'asc' %}
                                    <i class="m-0 fas fa-caret-up"></i>
                                {% elif sort_type == 'desc' %}
                                    <i class="m-0 fas fa-caret-down"></i>
                                {% endif %}
                            {% endif %}
                        </th>
                        <th scope="col">
                            Origin
                            {% if sorted_by == 'origin' %}
                                {% if sort_type == 'asc' %}
                                    <i class="m-0 fas fa-caret-up"></i>
                                {% elif sort_type == 'desc' %}
                                    <i class="m-0 fas fa-caret-down"></i>
                                {% endif %}
                            {% endif %}
                        </th>
                        <th scope="col">
                            Method
                            {% if sorted_by == 'method' %}
                                {% if sort_type == 'asc' %}
                                    <i class="m-0 fas fa-caret-up"></i>
                                {% elif sort_type == 'desc' %}
                                    <i class="m-0 fas fa-caret-down"></i>
                                {% endif %}
                            {% endif %}
                        </th>
                        <th scope="col">
                            Total
                            {% if sorted_by == 'total' or 'installment' in sorted_by %}
                                {% if sort_type == 'asc' %}
                                    <i class="m-0 fas fa-caret-up"></i>
                                {% elif sort_type == 'desc' %}
                                    <i class="m-0 fas fa-caret-down"></i>
                                {% endif %}
                            {% endif %}
                        </th>
                        <th scope="col">
                            Created
                            {% if sorted_by == 'date' %}
                                {% if sort_type == 'asc' %}
                                    <i class="m-0 fas fa-caret-up"></i>
                                {% elif sort_type == 'desc' %}
                                    <i class="m-0 fas fa-caret-down"></i>
                                {% endif %}
                            {% endif %}
                        </th>
                        <th scope="col" class="px-2" style="width: 0"></th>
                    </tr>
                </thead>
                <tbody>
                {% for bill in bills.all %}
                    
                    <tr>
                        <td class="p-0 pl-4">
                            {% if bill.installments_number > 1 %}
                                <a class="pointer-hover accordion" data-toggle="collapse" 
                                   data-target="#collapseDetails{{ bill.id }}" aria-expanded="false" 
                                   aria-controls="collapseDetails{{ bill.id }}">
                                    <i class="m-0 fas fa-chevron-down text-muted rotate"></i>
                                </a>
                            {% endif %}
                        </td>
                        <td class="pl-3">
                            <a href="#" data-toggle="modal" data-target="#detailsBillModal{{ bill.id }}"
                               class="text-dark">
                                {{ bill.title|default:'-' }}<br>
                                {% if bill.paid and bill.reconciled %}
                                    <span class="badge badge-dot mr-4">
                                        <i class="bg-success"></i><span
                                            class="status text-success">paid and reconciled</span>
                                    </span>
                                {% elif bill.paid %}
                                    <span class="badge badge-dot mr-4">
                                        <i class="bg-success"></i><span class="status text-success">paid</span>
                                    </span>
                                {% elif bill.late %}
                                    <span class="badge badge-dot mr-4">
                                        <i class="bg-red"></i><span class="status text-danger">late</span>
                                    </span>
                                {% elif bill.due_date|time_to_date < 30 %}
                                    <span class="badge badge-dot mr-4">
                                        <i class="bg-warning"></i><span class="status text-warning">pending</span>
                                    </span>
                                {% else %}
                                    <span class="badge badge-dot mr-4">
                                        <i class="bg-info"></i><span class="status text-info">pending</span>
                                    </span>
                                {% endif %}
                            </a>
                        </td>
                        <td>
                            {% if bill.link %}
                                <a href="{{ bill.link }}" target="_blank">
                                    <i class="m-0 fas fa-link"
                                       style="font-size: 0.7rem"></i> {{ bill.code|default:'Link'|truncatechars:25 }}
                                </a>
                            {% else %}
                                {{ bill.code|default:'-' }}
                            {% endif %}
                        </td>
                        <td>{{ bill.payer.name|default:'-' }}</td>
                        <td>
                            {{ bill.due_date|date:'d/m/y'|default:'-' }}
                            <br>
                            {% if bill.due_date and not bill.paid %}
                                {% if bill.due_date|time_to_date > 30 %}
                                    <span class="text-muted">
                                        {{ bill.due_date|time_to_date }} days to expire
                                    </span>
                                {% elif bill.due_date|time_to_date > 0 %}
                                    <span class="text-warning">
                                        {{ bill.due_date|time_to_date }} days to expire
                                    </span>
                                {% else %}
                                    <span class="text-danger">
                                        {{ bill.due_date|time_to_date|absolute }} days expired
                                    </span>
                                {% endif %}
                            {% elif bill.paid and bill.paid_at|time_to_date <= 0 %}
                                <span class="text-success">
                                    paid {{ bill.paid_at|time_to_date|absolute }} days ago
                                </span>
                            {% elif bill.paid and bill.paid_at|time_to_date > 0 %}
                                <span class="text-success">
                                    will be paid in {{ bill.paid_at|time_to_date }} days
                                </span>
                            {% endif %}
                        </td>
                        <td>
                            {% if bill.category in income_categories %}
                                <a href="#" data-toggle="modal" data-target="#detailsBillModal{{ bill.id }}"
                                   class="text-dark">
                                    <i class="m-0 fas fa-plus text-green" style="font-size: 0.7125rem"></i>
                                </a>
                            {% elif bill.category in expense_categories %}
                                <a href="#" data-toggle="modal" data-target="#detailsBillModal{{ bill.id }}"
                                   class="text-dark">
                                    <i class="m-0 fas fa-minus text-red" style="font-size: 0.7125rem"></i>
                                </a>
                            {% else %}
                                <a href="#" data-toggle="modal" data-target="#detailsBillModal{{ bill.id }}"
                                   class="text-dark">
                                    <i class="m-0 fas fa-question text-blue" style="font-size: 0.7125rem"></i>
                                </a>
                            {% endif %}
                            <span class="pl-1">{{ bill.category|default:'-'|truncatechars:20 }}</span>
                        </td>
                        <td>{{ bill.office.company_name|default:'-' }}</td>
                        <td>{{ bill.origin|default:'-' }}</td>
                        <td>{{ bill.method|default:'-' }}</td>
                        <td>{{ bill.total|default:'-' }} 
                        {% if bill.installments_number %}
                            <a href="" class="pointer-hover accordion" data-toggle="collapse" 
                               data-target="#collapseDetails{{ bill.id }}" aria-expanded="false" 
                               aria-controls="collapseDetails{{ bill.id }}">
                                ({{ bill.installments_number }}x)
                            </a>
                        {% endif %}
                        </td>
                        <td>
                            <span>{{ bill.created_by.get_full_name|default:'' }}</span>
                            <br>
                            <span>{{ bill.created_at|date:'d/m/y'|default:'-' }}</span>
                        </td>
                        <td class="px-2">
                            <div class="dropdown">
                                <a class="btn btn-sm btn-icon-only text-light" href="#" role="button"
                                   data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <i class="m-0 fas fa-ellipsis-v"></i>
                                </a>
                                <div class="dropdown-menu dropdown-menu-right dropdown-menu-arrow">
                                    <a class="dropdown-item" data-toggle="modal" href=""
                                       data-dismiss="modal"
                                       data-target="#detailsBillModal{{ bill.id }}">
                                        Open
                                    </a>
                                    {% if perms.home.change_bill or perms.home.delete_bill %}
                                        <div class="dropdown-divider"></div>
                                        {% if bill.paid and perms.home.change_bill %}
                                            <a class="dropdown-item text-warning" href=""
                                               data-dismiss="modal"
                                               data-toggle="modal"
                                               data-target="#paidConfirm{{ bill.id }}">
                                                Set as pending
                                            </a>
                                        {% elif perms.home.change_bill %}
                                            <a class="dropdown-item text-success" href=""
                                               data-dismiss="modal"
                                               data-toggle="modal"
                                               data-target="#paidConfirm{{ bill.id }}">
                                                Set as paid
                                            </a>
                                        {% endif %}
                                        {% if perms.home.delete_bill %}
                                            <a class="dropdown-item text-danger" href=""
                                               data-dismiss="modal"
                                               data-toggle="modal"
                                               data-target="#deleteConfirm{{ bill.id }}">
                                                Delete
                                            </a>
                                        {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                        </td>
                    </tr>

                    <!-- Installments Collapse -->
                    {% if bill.installments.count > 0 %}
                        <tr>
                            <td colspan="14" class="p-0 border-0">
                                <div aria-labelledby="collapseDetailsLabel{{ bill.id }}" data-parent=".accordion" id="collapseDetails{{ bill.id }}" class="collapse">
                                    <ul class="list-group list-group-flush list border-top">
                                        
                                        <li class="list-group-item px-4 border-0">
                                            <a href="" class="btn btn-sm btn-secondary" data-toggle="modal" 
                                               data-target="#editAllInstallments{{ bill.id }}">
                                                <i class="mr-1 fas fa-cog text-blue"></i>
                                                <span class="text-blue">Edit all</span>
                                            </a>
                                        </li>
                                    
                                        <!-- Edit All Installments Modal -->
                                        <div class="modal fade" id="editAllInstallments{{ bill.id }}"
                                             tabindex="-1" role="dialog"
                                             aria-labelledby="editAllInstallmentsLabel{{ bill.id }}"
                                             aria-hidden="true">
                                            <div class="modal-dialog modal-dialog-centered" role="document">
                                                <div class="modal-content">
                                                    <div class="modal-header mt-2 align-items-center">
                                                        <h5 class="modal-title" style="margin-left: auto">
                                                            <i class="m-0 fas fa-file-invoice-dollar text-blue"
                                                               style="font-size: 1.2rem"></i>
                                                        </h5>
                                                        <span class="ml-3 my-1"
                                                              style="margin-right: auto; font-size: 1.2rem"
                                                              id="editAllInstallmentsModalLabel{{ bill.id }}">
                                                            Installments
                                                        </span>
                                                        <button type="button" class="close mt--4"
                                                                style="margin-left: -30px"
                                                                data-dismiss="modal"
                                                                aria-label="Close">
                                                            <span aria-hidden="true">&times;</span>
                                                        </button>
                                                    </div>
                                                    <div class="modal-body py-0"
                                                         style="padding-left: 2.5rem; padding-right: 2.5rem">
                                                        <p class="text-center">Edit all installments of "{{ bill.title }}"</p>
                                                        <form method="post" id="editAllInstallmentsForm{{ bill.id }}"
                                                              action="{% url 'edit_client_bill_all_installments' client.slug bill.id %}" 
                                                              onsubmit="disableByID('editAllInstallmentsButton{{ bill.id }}')">
                                                            {% csrf_token %}
    
                                                            <input type="hidden" value="{{ sorted_by }}"
                                                                   name="sort_by">
                                                            <input type="hidden" value="{{ sort_type }}"
                                                                   name="sort_type">
                                                            <input type="hidden" value="{{ filters }}"
                                                                   name="filters">
    
                                                            {% for installment in bill.installments.all %}
                                                                <div class="row">
                                                                    <div class="col-2 form-group form-control-label">
                                                                        <label for="installment_id_{{ bill.id }}">ID</label>
                                                                        <input type="text" id="installment_id_{{ bill.id }}" 
                                                                               class="form-control" disabled
                                                                               value="{{ installment.partial_id }}/{{ bill.installments_number }}">
                                                                    </div>
                                                                    <div class="col-6 form-group form-control-label">
                                                                        <label for="installment_value_{{ installment.id }}">Value</label>
                                                                        <input inputmode="decimal"
                                                                               class="form-control" id="installment_value_{{ installment.id }}"
                                                                               name="installment_value_{{ installment.id }}"
                                                                               value="{{ installment.value|without_currency }}">
                                                                    </div>
                                                                    <div class="col-4 form-group form-control-label">
                                                                        <label for="dueDate">Due date</label>
                                                                        <input type="date" class="form-control"
                                                                               id="dueDate" name="installment_due_date_{{ installment.id }}"
                                                                               value="{{ installment.due_date|date:'Y-m-d' }}">
                                                                    </div>
                                                                </div>
                                                            {% endfor %}
                                                        </form>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary ml-auto"
                                                                data-dismiss="modal">
                                                            Close
                                                        </button>
                                                        <button type="submit" form="editAllInstallmentsForm{{ bill.id }}"
                                                                class="btn btn-primary" id="editAllInstallmentsButton{{ bill.id }}">
                                                            Save
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    
                                        {% for installment in bill.installments.all %}
                                            
                                            <li class="list-group-item px-4 border-0">
                                                <div class="row mx-0 align-items-center">
                                                    <div class="col-auto p-0">
                                                        <a class="badge badge-sm badge-secondary" href="#" role="button"
                                                           data-toggle="modal" data-target="#editInstallment{{ installment.id }}">
                                                            <i class="m-0 fas fa-cog"></i>
                                                        </a>
                                                    </div>
                                                    {% if installment.paid %}
                                                        <div class="col-auto pl-2 pr-0">
                                                            <a class="badge badge-sm badge-success" href="" role="button"
                                                               data-toggle="modal" data-target="#paidInstallmentConfirm{{ installment.id }}">
                                                                <i class="m-0 fas fa-check"></i>
                                                            </a>
                                                        </div>
                                                    {% else %}
                                                        <div class="col-auto pl-2 pr-0">
                                                            <a class="badge badge-sm badge-warning" href="" role="button"
                                                               data-toggle="modal" data-target="#paidInstallmentConfirm{{ installment.id }}">
                                                                <i class="m-0 fas fa-hourglass-half"></i>
                                                            </a>
                                                        </div>
                                                    {% endif %}
                                                    <div class="col-auto pl-2">
                                                        <a class="badge badge-sm badge-danger" href="#" role="button"
                                                           data-toggle="modal" data-target="#deleteInstallmentConfirm{{ installment.id }}">
                                                            <i class="m-0 fas fa-trash"></i>
                                                        </a>
                                                    </div>
                                                    <div class="col-auto">
                                                        <small>ID:</small>
                                                        <h5 class="mb-0">{{ installment.partial_id }}/{{ bill.installments.count }}</h5>
                                                    </div>
                                                    <div class="col-auto">
                                                        <small>Value:</small>
                                                        <h5 class="mb-0">{{ installment.value }}</h5>
                                                    </div>
                                                    <div class="col-auto">
                                                        <small>Due Date:</small>
                                                        {% if installment.due_date|time_to_date < 10 and not installment.paid %}
                                                            <h5 class="mb-0 text-warning">
                                                        {% elif installment.due_date|time_to_date < 0 and not installment.paid %}
                                                            <h5 class="mb-0 text-danger">
                                                        {% elif installment.paid %}
                                                            <h5 class="mb-0 text-success">
                                                        {% else %}
                                                            <h5 class="mb-0">
                                                        {% endif %}
                                                        {{ installment.due_date|date:"d/m/y"|default:"-" }}</h5>
                                                    </div>
                                                    <div class="col-auto">
                                                        <small>Paid At:</small>
                                                        {% if installment.paid %}
                                                            <h5 class="mb-0">{{ installment.paid_at|date:"d/m/y" }}</h5>
                                                        {% elif installment.due_date|time_to_date < 10 %}
                                                            <h5 class="mb-0 text-warning">Pending</h5>
                                                        {% elif installment.due_date|time_to_date < 0 %}
                                                            <h5 class="mb-0 text-danger">Late</h5>
                                                        {% else %}
                                                            <h5 class="mb-0">Pending</h5>
                                                        {% endif %}
                                                    </div>
                                                    <div class="col-auto">
                                                        <small>Invoice:</small>
                                                        <h5 class="mb-0">{{ installment.invoice|default:'-' }}</h5>
                                                    </div>
                                                    <div class="col-auto">
                                                        <small>Receipt:</small>
                                                        <h5 class="mb-0">{{ installment.receipt|default:'-' }}</h5>
                                                    </div>
                                                    <div class="col-auto">
                                                        <small>Authentication key:</small>
                                                        <h5 class="mb-0">{{ installment.authentication_key|default:'-' }}</h5>
                                                    </div>
                                                    <div class="col"></div>
                                                </div>
                                            </li>
    
                                            <!-- Edit Installment Modal -->
                                            <div class="modal fade" id="editInstallment{{ installment.id }}"
                                                 tabindex="-1" role="dialog"
                                                 aria-labelledby="editInstallmentLabel{{ installment.id }}"
                                                 aria-hidden="true">
                                                <div class="modal-dialog modal-dialog-centered" role="document">
                                                    <div class="modal-content">
                                                        <div class="modal-header mt-2" style="justify-content: center">
                                                            <span class="my-1"
                                                                  style="margin: auto; font-size: 1.2rem"
                                                                  id="editInstallmentModalLabel{{ installment.id }}">
                                                                ({{ installment.partial_id }}/{{ installment.bill.installments.count }}) 
                                                                {{ installment.bill.title|truncatechars:30 }} 
                                                            </span>
                                                            <button type="button" class="close mt--4"
                                                                    style="margin-left: -30px"
                                                                    data-dismiss="modal"
                                                                    aria-label="Close">
                                                                <span aria-hidden="true">&times;</span>
                                                            </button>
                                                        </div>
                                                        <div class="modal-body py-0"
                                                             style="padding-left: 2.5rem; padding-right: 2.5rem">
                                                            <form method="post" id="editInstallmentForm{{ installment.id }}"
                                                                  action="{% url 'edit_client_bill_installment' client.slug bill.id installment.id %}" 
                                                                  onsubmit="disableByID('editInstallmentButton{{ installment.id }}')">
                                                                {% csrf_token %}
    
                                                                <input type="hidden" value="{{ sorted_by }}"
                                                                       name="sort_by">
                                                                <input type="hidden" value="{{ sort_type }}"
                                                                       name="sort_type">
                                                                <input type="hidden" value="{{ filters }}"
                                                                       name="filters">
    
                                                                <div class="row">
                                                                    <div class="col-sm form-group form-control-label">
                                                                        <label for="installment_value_{{ installment.id }}">Value</label>
                                                                        <input inputmode="decimal"
                                                                               class="form-control" id="installment_value_{{ installment.id }}"
                                                                               name="installment_value"
                                                                               value="{{ installment.value|without_currency }}">
                                                                    </div>
                                                                    <div class="col-sm-4 form-group form-control-label">
                                                                        <label for="dueDate">Due date</label>
                                                                        <input type="date" class="form-control"
                                                                               id="dueDate" name="installment_due_date"
                                                                               value="{{ installment.due_date|date:'Y-m-d' }}">
                                                                    </div>
                                                                    {% if installment.paid %}
                                                                        <div class="col-sm-4 form-group form-control-label">
                                                                            <label for="paidAt">Paid at</label>
                                                                            <input type="date"
                                                                                   class="form-control"
                                                                                   id="paidAt"
                                                                                   value="{{ installment.paid_at|date:'Y-m-d' }}"
                                                                                   disabled>
                                                                        </div>
                                                                    {% endif %}
                                                                </div>
                                                                <div class="row">
                                                                    <div class="col-sm-6 form-group form-control-label">
                                                                        <label for="invoice">Invoice</label>
                                                                        <input class="form-control" id="invoice" name="invoice"
                                                                               value="{{ installment.invoice|default:'' }}">
                                                                    </div>
                                                                    <div class="col-sm-6 form-group form-control-label">
                                                                        <label for="receipt">Receipt</label>
                                                                        <input class="form-control" id="receipt" name="receipt"
                                                                               value="{{ installment.receipt|default:'' }}">
                                                                    </div>
                                                                    <div class="col-sm-12 form-group form-control-label">
                                                                        <label for="authentication_key">Authentication key</label>
                                                                        <input class="form-control" id="authentication_key" name="authentication_key"
                                                                               value="{{ installment.authentication_key|default:'' }}">
                                                                    </div>
                                                                </div>
                                                                <div class="form-group form-control-label">
                                                                    <label for="installmentEditInfoInput">Info</label>
                                                                    <textarea type="date"
                                                                              class="form-control"
                                                                              id="installmentEditInfoInput"
                                                                              name="installment_info"
                                                                    >{{ installment.payment_info }}</textarea>
                                                                </div>
    
                                                            </form>
                                                        </div>
                                                        <div class="modal-footer pt-1">
                                                            <button type="button" class="btn btn-secondary"
                                                                    data-dismiss="modal">Cancel
                                                            </button>
                                                            <a href="#" target="_blank" data-dismiss="modal" data-toggle="modal"
                                                               data-target="#paidInstallmentConfirm{{ installment.id }}" 
                                                            {% if installment.paid %}
                                                               class="btn btn-warning">
                                                                Set as pending
                                                            {% else %}
                                                               class="btn btn-success">
                                                                Set as paid
                                                            {% endif %}
                                                            </a>
                                                            <button type="submit" class="btn btn-primary"
                                                                    id="editInstallmentButton{{ installment.id }}"
                                                                    form="editInstallmentForm{{ installment.id }}">
                                                                Save
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Change status Modal -->
                                            <div class="modal fade"
                                                 id="paidInstallmentConfirm{{ installment.id }}"
                                                 tabindex="-1"
                                                 role="dialog"
                                                 aria-labelledby="paidInstallmentConfirmLabel{{ installment.id }}"
                                                 aria-hidden="true">
                                                <div class="modal-dialog modal-dialog-centered" role="document">
                                                    <div class="modal-content">
                                                        <div class="modal-header mt-2">
                                                            <h5 class="modal-title my-1"
                                                                style="margin-left: auto">
                                                                <i class="ni ni-fat-delete text-blue"
                                                                   style="font-size: 1.5rem; margin-top: 0.15rem !important"></i>
                                                            </h5>
                                                            <span class="ml-3 my-1"
                                                                  style="margin-right: auto; font-size: 1.2rem"
                                                                  id="paidConfirmModalLabel{{ installment.id }}">Are you sure?</span>
                                                            <button type="button" class="close mt--4"
                                                                    style="margin-left: -30px"
                                                                    data-dismiss="modal"
                                                                    aria-label="Close">
                                                                <span aria-hidden="true">&times;</span>
                                                            </button>
                                                        </div>
                                                        <div class="modal-body py-0"
                                                             style="padding-left: 2.5rem; padding-right: 2.5rem">
                                                            <p class="text-center">Are you sure you want to
                                                                change status of this
                                                                bill?
                                                                <br>
                                                                This action can be undone.
                                                            </p>
                                                            <form method="post" id="paidInstallmentConfirmForm{{ installment.id }}"
                                                                  action="{% url 'change_client_bill_installment_status' client.slug bill.id installment.id %}" 
                                                                  onsubmit="disableByID('paidInstallmentConfirmButton{{ installment.id }}')">
                                                                {% csrf_token %}
    
                                                                <input type="hidden" value="{{ sorted_by }}"
                                                                       name="sort_by">
                                                                <input type="hidden" value="{{ sort_type }}"
                                                                       name="sort_type">
                                                                <input type="hidden" value="{{ filters }}"
                                                                       name="filters">
    
                                                                <div class="row">
                                                                    <div class="col-sm-8 form-group form-control-label mb-3">
                                                                        <label for="name">Title</label>
                                                                        <input class="form-control" id="name"
                                                                               value="{{ installment.bill.title }} ({{ installment.partial_id }}/{{ installment.bill.installments.count }})"
                                                                               disabled>
                                                                    </div>
                                                                    <div class="col-sm-4 form-group form-control-label">
                                                                        <label for="dueDate">Due date</label>
                                                                        <input type="date" class="form-control"
                                                                               id="dueDate"
                                                                               value="{{ installment.due_date|date:'Y-m-d' }}"
                                                                               disabled>
                                                                    </div>
                                                                </div>
                                                                <div class="row">
                                                                    <div class="col-sm-8 form-group form-control-label">
                                                                        <label for="total">Total</label>
                                                                        <input inputmode="decimal"
                                                                               class="form-control" id="total"
                                                                               value="{{ installment.value }}"
                                                                               disabled>
                                                                    </div>
                                                                    {% if installment.paid %}
                                                                        <div class="col-sm-4 form-group form-control-label">
                                                                            <label for="paidAt">Paid at</label>
                                                                            <input type="date"
                                                                                   class="form-control"
                                                                                   id="paidAt"
                                                                                   value="{{ installment.paid_at|date:'Y-m-d' }}"
                                                                                   disabled>
                                                                        </div>
                                                                    {% else %}
                                                                        <div class="col-sm-4 form-group form-control-label">
                                                                            <label for="billPaidInput">Paid
                                                                                at</label>
                                                                            <input type="date"
                                                                                   class="form-control"
                                                                                   id="billPaidInput"
                                                                                   name="bill_paid_at" required
                                                                                   autofocus>
                                                                        </div>
                                                                        <div class="col-sm-6 form-group form-control-label">
                                                                            <label for="invoice">Invoice</label>
                                                                            <input class="form-control" id="invoice" 
                                                                                   name="invoice">
                                                                        </div>
                                                                        <div class="col-sm-6 form-group form-control-label">
                                                                            <label for="receipt">Receipt</label>
                                                                            <input class="form-control" id="receipt" 
                                                                                   name="receipt">
                                                                        </div>
                                                                        <div class="col-sm-12 form-group form-control-label">
                                                                            <label for="authentication_key">Authentication key</label>
                                                                            <input class="form-control" id="authentication_key" 
                                                                                   name="authentication_key">
                                                                        </div>
                                                                    {% endif %}
                                                                </div>
                                                                <div class="form-group form-control-label">
                                                                    <label for="installmentEditInfoInput">Info</label>
                                                                    <textarea type="date"
                                                                              class="form-control"
                                                                              id="installmentEditInfoInput"
                                                                              name="installment_info"
                                                                              {% if installment.paid %}disabled{% endif %}
                                                                    >{{ installment.payment_info }}</textarea>
                                                                </div>
    
                                                            </form>
                                                        </div>
                                                        <div class="modal-footer pt-1">
                                                            <button type="button" class="btn btn-secondary"
                                                                    data-dismiss="modal">Cancel
                                                            </button>
                                                            {% if installment.paid %}
                                                                <button type="submit" class="btn btn-warning"
                                                                        id="paidInstallmentConfirmButton{{ installment.id }}"
                                                                        form="paidInstallmentConfirmForm{{ installment.id }}">
                                                                    Set as pending
                                                                </button>
                                                            {% else %}
                                                                <button type="submit" class="btn btn-success"
                                                                        id="paidInstallmentConfirmButton{{ installment.id }}"
                                                                        form="paidInstallmentConfirmForm{{ installment.id }}">
                                                                    Set as paid
                                                                </button>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
    
                                            <!-- Delete Modal -->
                                            <div class="modal fade"
                                                 id="deleteInstallmentConfirm{{ installment.id }}"
                                                 tabindex="-1"
                                                 role="dialog" aria-labelledby="deleteInstallmentConfirmLabel{{ installment.id }}"
                                                 aria-hidden="true">
                                                <div class="modal-dialog modal-dialog-centered" role="document">
                                                    <div class="modal-content">
                                                        <div class="modal-header mt-2">
                                                            <h5 class="modal-title my-1"
                                                                style="margin-left: auto">
                                                                <i class="ni ni-fat-delete text-blue"
                                                                   style="font-size: 1.5rem; margin-top: 0.15rem !important"></i>
                                                            </h5>
                                                            <span class="ml-3 my-1"
                                                                  style="margin-right: auto; font-size: 1.2rem"
                                                                  id="deleteInstallmentConfirmModalLabel{{ installment.id }}">Are you sure?</span>
                                                            <button type="button" class="close mt--4"
                                                                    style="margin-left: -30px"
                                                                    data-dismiss="modal"
                                                                    aria-label="Close">
                                                                <span aria-hidden="true">&times;</span>
                                                            </button>
                                                        </div>
                                                        <div class="modal-body py-0"
                                                             style="padding-left: 2.5rem; padding-right: 2.5rem">
                                                            <p class="text-center">Are you sure you want to
                                                                delete this
                                                                installment?
                                                                <br>
                                                                This action cannot be undone.
                                                            </p>
                                                            <form method="post" id="deleteInstallmentConfirmForm{{ installment.id }}"
                                                                  action="{% url 'delete_client_bill_installment' client.slug bill.id installment.id %}" 
                                                                  onsubmit="disableByID('deleteInstallmentConfirmButton{{ installment.id }}')">
                                                                {% csrf_token %}
                                                                <input type="hidden" value="{{ sorted_by }}"
                                                                       name="sort_by">
                                                                <input type="hidden" value="{{ sort_type }}"
                                                                       name="sort_type">
                                                                <input type="hidden" value="{{ filters }}"
                                                                       name="filters">
                                                            </form>
                                                            <div class="row">
                                                                <div class="col form-group form-control-label mb-3">
                                                                    <label for="name">Title</label>
                                                                    <input class="form-control" id="name"
                                                                           name="bill_name"
                                                                           value="{{ installment.bill.title }} ({{ installment.partial_id }}/{{ bill.installments_number }})" disabled>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col form-group form-control-label">
                                                                    <label for="billTotalInfo">Value</label>
                                                                    <input inputmode="decimal"
                                                                           class="form-control"
                                                                           id="billTotalInfo"
                                                                           name="bill_total" placeholder=""
                                                                           value="{{ installment.value }}" disabled>
                                                                </div>
                                                                <div class="col form-group form-control-label">
                                                                    <label for="installmentDueDateInput{{ installment.value }}">Due
                                                                        date</label>
                                                                    <input type="date" class="form-control"
                                                                           id="installmentDueDateInput{{ installment.value }}"
                                                                           name="bill_due_date" placeholder=""
                                                                           value="{{ installment.due_date|date:'Y-m-d' }}"
                                                                           disabled>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="modal-footer pt-1">
                                                            <button type="button" class="btn btn-secondary"
                                                                    data-dismiss="modal">Cancel
                                                            </button>
                                                            <button type="submit" class="btn btn-danger"
                                                                    id="deleteInstallmentConfirmButton{{ installment.id }}"
                                                                    form="deleteInstallmentConfirmForm{{ installment.id }}">
                                                                Delete
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
    
                                        {% endfor %}
                                    </ul>
                                </div>
                            </td>
                        </tr>
                    {% endif %}

                    <!-- Details Modal -->
                    <div class="modal fade" id="detailsBillModal{{ bill.id }}" tabindex="-1" role="dialog"
                         aria-labelledby="detailsBillModal{{ bill.id }}Label" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered" role="document">
                            <div class="modal-content">
                                <div class="modal-header mt-2 align-items-center">
                                    <h5 class="modal-title" style="margin-left: auto">
                                        {% if bill.category in income_categories %}
                                            <i class="m-0 fas fa-plus text-green" style="font-size: 1rem"></i>
                                        {% elif bill.category in expense_categories %}
                                            <i class="m-0 fas fa-minus text-red" style="font-size: 1rem"></i>
                                        {% else %}
                                            <i class="m-0 fas fa-question text-blue" style="font-size: 1rem"></i>
                                        {% endif %}
                                    </h5>
                                    <span class="ml-3 my-1" style="margin-right: auto; font-size: 1.2rem"
                                          id="detailsBillModal{{ bill.id }}Label">{% if bill.title != '' %}{{ bill.title|truncatechars:25 }}{% else %}Bill{% endif %}</span>
                                    <button type="button" class="close mt--4" style="margin-left: -30px"
                                            data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body py-0" style="padding-left: 2.5rem; padding-right: 2.5rem">
                                    <div class="wizard-container">
                                        <div class="wizard-card" data-color="red" id="wizard">
                                            <form id="editBillForm{{ bill.id }}" method="post" 
                                                  action="{% url 'edit_client_bill' client.slug bill.id %}"
                                                  enctype="multipart/form-data"
                                                  onsubmit=disableByID('editBillButton{{ bill.id }}')>
                                                {% csrf_token %}
                                                <input type="hidden" value="{{ sorted_by }}" name="sort_by">
                                                <input type="hidden" value="{{ sort_type }}" name="sort_type">
                                                <input type="hidden" value="{{ filters }}" name="filters">
                                                <input type="hidden" value="{{ client.slug }}" name="client_slug">
                                            
                                                <div class="wizard-navigation">
                                                    <ul class="nav nav-pills m-auto" style="width: 70%">
                                                        <li class="nav-item">
                                                            <a class="nav-link text-center p-2 active" href="#billInfos{{ bill.id }}" 
                                                               data-toggle="tab" role="tab" aria-selected="false" disabled>
                                                                Infos
                                                            </a>
                                                        </li>
                                                        <li class="nav-item">
                                                            <a class="nav-link text-center p-2" href="#billPayment{{ bill.id }}"
                                                               data-toggle="tab" role="tab" disabled>
                                                                Payment
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            
                                                <div class="tab-content pt-4 mt-2 mb-3">
                                                
                                                    <div class="tab-pane active" id="billInfos{{ bill.id }}">
                                                        {# TITLE / CATEGORY #}
                                                        <div class="row">
                                                            <div class="col-6 form-group form-control-label mb-3">
                                                                <label for="nameDetails">Title</label>
                                                                <input class="form-control" id="nameDetails" 
                                                                       name="title" value="{{ bill.title }}" 
                                                                       {% if not perms.home.change_bill %}disabled{% endif %}>
                                                            </div>
                                                            <div class="col-6 form-group form-control-label mb-3">
                                                                <label for="categoryDetails">Category</label>
                                                                <select class="form-control" id="categoryDetails" name="category" 
                                                                        {% if not perms.home.change_bill %}disabled{% endif %}>
                                                                    <option value=""></option>
                                                                    <optgroup label="Income (+)" class="text-green">
                                                                        {% for category in income_categories %}
                                                                            <option value="{{ category }}" class="text-dark" {% if bill.category == category %}selected{% endif %}>
                                                                                {{ category|capfirst }}
                                                                            </option>
                                                                        {% endfor %}
                                                                    </optgroup>
                                                                    <optgroup label="Expense (-)" class="text-red">
                                                                        {% for category in expense_categories %}
                                                                            <option value="{{ category }}" class="text-dark" {% if bill.category == category %}selected{% endif %}>
                                                                                {{ category|capfirst }}
                                                                            </option>
                                                                        {% endfor %}
                                                                    </optgroup>
                                                                </select>
                                                            </div>
                                                        </div> 
                                                        {# OFFICE / REGIONAL #}
                                                        <div class="row">
                                                            <div class="col form-group form-control-label mb-3">
                                                                <label for="beneficiaryDetails">Office</label>
                                                                <select class="form-control" id="beneficiaryDetails" name="office_id" {% if not perms.home.change_bill %}disabled{% endif %}>
                                                                    <option value=""></option>
                                                                    {% for office in offices %}
                                                                        <option value="{{ office.id }}" {% if bill.office.id == office.id %}selected{% endif %}>{{ office.company_name }}</option>
                                                                    {% endfor %}
                                                                </select>
                                                            </div>
                                                            <div class="col-6 form-group form-control-label mb-3">
                                                                <label for="payer">Regional</label>
                                                                <select id="payer" name="payer_id" class="form-control">
                                                                    <option value=""></option>
                                                                    {% for payer in client.branches.all %}
                                                                        <option value="{{ payer.id }}" {% if bill.payer == payer %}selected{% endif %}>{{ payer.name }}</option>
                                                                    {% endfor %}
                                                                </select>
                                                            </div>
                                                        </div> 
                                                        {# ORIGIN / CODE #}
                                                        <div class="row">
                                                            <div class="col form-group form-control-label mb-3">
                                                                <label for="origin">Origin</label>
                                                                <select id="origin" name="origin" class="form-control">
                                                                    <option value=""></option>
                                                                    <option value="Individual" {% if bill.origin == 'Individual' %}selected{% endif %}>Individual</option>
                                                                    <option value="Sale" {% if bill.origin == 'Sale' %}selected{% endif %}>Sale</option>
                                                                    <option value="Service" {% if bill.origin == 'Service' %}selected{% endif %}>Service</option>
                                                                </select>
                                                            </div>
                                                            <div class="col form-group form-control-label mb-3">
                                                                <label for="code">Code</label>
                                                                <input class="form-control" id="code" name="code" value="{{ bill.code|default:'' }}">
                                                            </div>
                                                        </div> 
                                                        {# LINK #}
                                                        <div class="row">
                                                            <div class="col form-group form-control-label mb-3">
                                                                <label for="link">Link</label>
                                                                <input type="url" class="form-control" id="link"
                                                                       name="link" value="{{ bill.link|default:'' }}">
                                                            </div>
                                                        </div> 
                                                    </div>
                                                
                                                    <div class="tab-pane" id="billPayment{{ bill.id }}">
                                                        {# ISSUE DATE / DUE DATE / PAID AT #}
                                                        <div class="row">
                                                            <div class="col{% if bill.paid %}-4{% endif %} form-group form-control-label">
                                                                <label for="billIssueDateInput">Issue date</label>
                                                                <input type="date" class="form-control"
                                                                       id="billIssueDateInput"
                                                                       onchange="enableByID('editBillButton{{ bill.id }}')"
                                                                       name="issue_date" required
                                                                       value="{{ bill.issue_date|date:'Y-m-d' }}">
                                                            </div>
                                                            <div class="col{% if bill.paid %}-4{% endif %} form-group form-control-label">
                                                                <label for="billDueDateInputDetails">Due date</label>
                                                                <input type="date" class="form-control"
                                                                       id="billDueDateInputDetails"
                                                                       name="due_date" required
                                                                       onchange="enableByID('editBillButton{{ bill.id }}')"
                                                                       value="{{ bill.due_date|date:'Y-m-d' }}" 
                                                                       {% if not perms.home.change_bill or bill.installments.count > 0 %}disabled{% endif %}>
                                                            </div>
                                                            {% if bill.paid %}
                                                                <div class="col-4 form-group form-control-label">
                                                                    <label for="billIssueDateInput">Paid at</label>
                                                                    <input type="date" class="form-control"
                                                                           id="billIssueDateInput"
                                                                           onchange="enableByID('newBillButton')"
                                                                           name="paid_at" value="{{ bill.paid_at|date:'Y-m-d' }}" 
                                                                           required>
                                                                </div>
                                                            {% endif %}
                                                        </div>
                                                        {# TOTAL / CURRENCY / METHOD #}
                                                        <div class="row">
                                                            <div class="col form-group form-control-label mb-3"
                                                                 style="flex: 0 0 20%; max-width: 20%">
                                                                <label for="currencyDetails">Currency</label>
                                                                <select class="form-control" id="currencyDetails" 
                                                                        name="currency" {% if not perms.home.change_bill or bill.installments.count > 0 %}disabled{% endif %}>
                                                                    <option value="BRL" {% if bill.currency == 'BRL' %}selected{% endif %}>BRL</option>
                                                                    {#<option value="USD">USD</option>#}
                                                                    {#<option value="EUR">EUR</option>#}
                                                                </select>
                                                            </div>
                                                            <div class="col form-group form-control-label">
                                                                <label for="valueInputDetails{{ bill.id }}">Total</label>
                                                                <input inputmode="decimal" class="form-control"
                                                                       id="valueInputDetails{{ bill.id }}"
                                                                       name="total"
                                                                       value="{{ bill.total|without_currency }}" 
                                                                       {% if not perms.home.change_bill or bill.installments.count > 0 %}disabled{% endif %}>
                                                            </div>
                                                            <div class="col form-group form-control-label mb-3">
                                                                <label for="methodDetails">Method</label>
                                                                <select class="form-control" id="methodDetails" name="method" {% if not perms.home.change_bill %}disabled{% endif %}>
                                                                    <option value=""></option>
                                                                    <option value="Bank slip" {% if bill.method == 'Bank slip' %}selected{% endif %}>Bank slip</option>
                                                                    <option value="Pix" {% if bill.method == 'Pix' %}selected{% endif %}>Pix</option>
                                                                    <option value="Transfer" {% if bill.method == 'Transfer' %}selected{% endif %}>Transfer</option>
                                                                    <option value="Credit card" {% if bill.method == 'Credit card' %}selected{% endif %}>Credit card</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                        {# PAYMENT INFO #}
                                                        <div class="row">
                                                            <div class="col-sm form-group form-control-label">
                                                                <label for="invoice">Invoice</label>
                                                                <input class="form-control" id="invoice" name="invoice"
                                                                       value="{{ bill.invoice|default:'' }}">
                                                            </div>
                                                            <div class="col-sm form-group form-control-label">
                                                                <label for="receipt">Receipt</label>
                                                                <input class="form-control" id="receipt" name="receipt"
                                                                       value="{{ bill.receipt|default:'' }}">
                                                            </div>
                                                        </div>
                                                        <div class="form-group form-control-label">
                                                            <label for="authentication_key">Authentication key</label>
                                                            <input class="form-control" id="authentication_key" name="authentication_key"
                                                                   value="{{ bill.authentication_key|default:'' }}">
                                                        </div>
                                                        <div class="form-group form-control-label">
                                                            <label for="installmentEditInfoInput">Info</label>
                                                            <textarea class="form-control"
                                                                      id="installmentEditInfoInput"
                                                                      name="payment_info"
                                                            >{{ bill.payment_info }}</textarea>
                                                        </div>
                                                        {# PROOF #}
                                                        {% if bill.proofs.all %}
                                                            <div class="mb-2">
                                                                <span class="form-group form-control-label">Proofs</span>
                                                                <a href="#" class="ml-1" data-dismiss="modal" data-toggle="modal" 
                                                                   data-target="#editProofsModal{{ bill.id }}">
                                                                    <i class="m-0 fas fa-cog text-sm"></i>
                                                                </a>
                                                            </div>
                                                            {% for proof in bill.proofs.all %}
                                                                <div class="mb-1">
                                                                    <a href="{% url 'download_client_proof' client.slug bill.id proof.id %}"
                                                                       class="px-2 text-sm text-success">
                                                                        <i class="m-0 fas fa-download"></i>
                                                                    </a>
                                                                    <span class="text-sm">
                                                                        {{ proof|file_name_only_with_extension|truncatechars:40 }}
                                                                    </span>
                                                                </div>
                                                            {% endfor %}
                                                        {% else %}
                                                            <div class="form-group form-control-label mt-2">
                                                                <input type="file" id="documentChangeInput{{ bill.id }}" style="display: none" name="proofs" multiple>
                                                                <label for="documentChangeInput{{ bill.id }}" id="fileInputLabel{{ bill.id }}" class="justify-content-center d-flex">
                                                                    <span class="btn btn-sm {% if bill.proof %}btn-success{% else %}btn-neutral{% endif %} align-items-center" style="width: 100%">
                                                                        {% if bill.proof %}{{ bill.proof|file_name_only_with_extension|truncatechars:40 }}{% else %}Attach proof{% endif %}
                                                                    </span>
                                                                </label>
                                                            </div>
                                                        {% endif %} 
                                                    </div>
                                                    
                                                </div>
                                            
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer pb-4 pt-3">
                                    {% if perms.home.change_bill or bill.proof %}
                                        <button type="button" class="btn btn-secondary"
                                                data-dismiss="modal">Cancel
                                        </button>
                                    {% endif %}
                                    {% if perms.home.delete_bill %}
                                        <a class="btn btn-danger" href="#"
                                           data-dismiss="modal"
                                           data-toggle="modal"
                                           data-target="#deleteConfirm{{ bill.id }}">
                                            Delete
                                        </a>
                                    {% endif %}
                                    {% if bill.paid and perms.home.change_bill %}
                                        <a class="btn btn-warning ml-1 mr-2" href="#" data-dismiss="modal"
                                           data-toggle="modal"
                                           data-target="#paidConfirm{{ bill.id }}">
                                            Set as pending
                                        </a>
                                    {% elif perms.home.change_bill %}
                                        <a class="btn btn-success ml-1 mr-2" href="#" data-dismiss="modal"
                                           data-toggle="modal"
                                           data-target="#paidConfirm{{ bill.id }}">
                                            Set as paid
                                        </a>
                                    {% endif %}
                                    {% if perms.home.change_bill %}
                                        <button type="submit" class="btn btn-primary"
                                                id="editBillButton{{ bill.id }}"
                                                form="editBillForm{{ bill.id }}">
                                            Save
                                        </button>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Edit Proofs Modal -->
                    <div class="modal fade" id="editProofsModal{{ bill.id }}" role="dialog"
                         aria-labelledby="editProofsModal{{ bill.id }}Label" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered" role="document">
                            <div class="modal-content">
                                <div class="modal-header mt-2 align-items-center">
                                    <h5 class="modal-title" style="margin-left: auto">
                                        <i class="m-0 fas fa-paperclip text-blue" style="font-size: 1rem"></i>
                                    </h5>
                                    <span class="ml-3 my-1" style="margin-right: auto; font-size: 1.2rem"
                                          id="editProofsModal{{ bill.id }}Label">Proofs</span>
                                    <button type="button" class="close mt--4" style="margin-left: -30px"
                                            data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body pt-0 px-5">
                                    <p class="text-center">Attach proofs to bill "{{ bill.title }}"</p>
                                    <ul class="list-group list-group-flush list">
                                        {% for proof in bill.proofs.all %}
                                            <li class="list-group-item px-0" style="border: 0">
                                                <div class="row align-items-center">
                                                    <div class="col-auto">
                                                        <div class="avatar">
                                                            <img class="avatar-img rounded bg-white" alt="..." 
                                                                 src="/static/assets/img/icons/extensions/1x/{{ proof.file.name|file_extension_icon }}">
                                                        </div>
                                                    </div>
                                                    <div class="col ml--3">
                                                        <h4 class="mb-1">{{ proof.file.name|file_name_only_with_extension }}</h4>
                                                        <p class="small text-muted mb-0">{{ proof.file.size|filesizeformat }}</p>
                                                    </div>
                                                    <div class="col-auto">
                                                        <a href="#" data-dismiss="modal" data-toggle="modal" 
                                                           data-target="#deleteProofConfirmModal{{ proof.id }}">
                                                            <i class="m-0 fas fa-times text-danger pointer-hover"></i>
                                                        </a>
                                                    </div>
                                                </div>
                                            </li>
                                        {% endfor %}
                                    </ul>
                                    <form id="editProofsForm{{ bill.id }}" method="post" 
                                          action="{% url 'upload_client_bill_proofs' client.slug %}"
                                          enctype="multipart/form-data"
                                          onsubmit="disableByID('editProofsButton{{ bill.id }}')">
                                        {% csrf_token %}
                                        <input type="hidden" value="{{ sorted_by }}" name="sort_by">
                                        <input type="hidden" value="{{ sort_type }}" name="sort_type">
                                        <input type="hidden" value="{{ filters }}" name="filters">
                                        <input type="hidden" value="{{ bill.id }}" name="bill_id">
                                        <div class="form-group form-control-label my-3">
                                            <input type="file" id="documentChangeInput{{ bill.id }}"
                                                   style="display: none" name="proofs" multiple required 
                                                   onchange="enableByID('editProofsButton{{ bill.id }}')">
                                            <label for="documentChangeInput{{ bill.id }}"
                                                   id="fileInputLabel{{ bill.id }}"
                                                   class="justify-content-center d-flex">
                                                <span class="btn btn-sm {% if bill.proof %}btn-success{% else %}btn-neutral{% endif %} align-items-center"
                                                      style="width: 100%">
                                                    {% if bill.proof %}
                                                        {{ bill.proof|file_name_only_with_extension|truncatechars:40 }}
                                                    {% else %}
                                                        <i class="fas fa-plus mr-2"></i>Add more files
                                                    {% endif %}
                                                </span>
                                            </label>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer pb-4 pt-2">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                    <button type="submit" class="btn btn-primary" 
                                            id="editProofsButton{{ bill.id }}"
                                            form="editProofsForm{{ bill.id }}" disabled>
                                        Upload
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Change Status Modal -->
                    <div class="modal fade"
                         id="paidConfirm{{ bill.id }}"
                         tabindex="-1"
                         role="dialog" aria-labelledby="paidConfirmLabel{{ bill.id }}"
                         aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered" role="document">
                            <div class="modal-content">
                                <div class="modal-header mt-2">
                                    <h5 class="modal-title my-1" style="margin-left: auto">
                                        <i class="ni ni-fat-delete text-blue"
                                           style="font-size: 1.5rem; margin-top: 0.15rem !important"></i>
                                    </h5>
                                    <span class="ml-3 my-1"
                                          style="margin-right: auto; font-size: 1.2rem"
                                          id="paidConfirmModalLabel{{ bill.id }}">Are you sure?</span>
                                    <button type="button" class="close mt--4"
                                            style="margin-left: -30px" data-dismiss="modal"
                                            aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body py-0"
                                     style="padding-left: 2.5rem; padding-right: 2.5rem">
                                    <p class="text-center">Are you sure you want to change status of this
                                        bill?
                                        <br>
                                        This action can be undone.
                                    </p>
                                    <form method="post" id="paidConfirmForm{{ bill.id }}"
                                          action="{% url 'change_client_bill_status' client.slug bill.id %}" 
                                          onsubmit="disableByID('paidConfirmButton{{ bill.id }}')">
                                        {% csrf_token %}

                                        <input type="hidden" value="{{ sorted_by }}" name="sort_by">
                                        <input type="hidden" value="{{ sort_type }}" name="sort_type">
                                        <input type="hidden" value="{{ filters }}" name="filters">

                                        <div class="row">
                                            <div class="col-sm-8 form-group form-control-label mb-3">
                                                <label for="name">Title</label>
                                                <input class="form-control" id="name"
                                                       value="{{ bill.title }}" disabled>
                                            </div>
                                            <div class="col-sm-4 form-group form-control-label">
                                                <label for="dueDate">Due date</label>
                                                <input type="date" class="form-control"
                                                       id="dueDate"
                                                       value="{{ bill.due_date|date:'Y-m-d' }}"
                                                       disabled>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-sm form-group form-control-label">
                                                <label for="total">Total</label>
                                                <input inputmode="decimal" class="form-control" id="total"
                                                       value="{{ bill.total }}" disabled>
                                            </div>
                                            {% if bill.paid %}
                                                <div class="col-sm form-group form-control-label">
                                                    <label for="paidAt">Paid at</label>
                                                    <input type="date" class="form-control" id="paidAt"
                                                           value="{{ bill.paid_at|date:'Y-m-d' }}" disabled>
                                                </div>
                                            {% else %}
                                                <div class="col-sm form-group form-control-label">
                                                    <label for="billPaidInput">Paid at</label>
                                                    <input type="date" class="form-control" id="billPaidInput"
                                                           name="bill_paid_at" required autofocus>
                                                </div>
                                            {% endif %}
                                        </div>
                                        {% if not bill.paid %}
                                            <div class="row">
                                                <div class="col form-group form-control-label">
                                                    <label for="invoice">Invoice</label>
                                                    <input class="form-control" id="invoice" name="invoice">
                                                </div>
                                                <div class="col form-group form-control-label">
                                                    <label for="receipt">Receipt</label>
                                                    <input class="form-control" id="receipt" name="receipt">
                                                </div>
                                            </div>
                                            <div class="form-group form-control-label">
                                                <label for="authentication_key">Authentication key</label>
                                                <input class="form-control" id="authentication_key" name="authentication_key">
                                            </div>
                                        {% endif %}
                                        <div class="form-group form-control-label">
                                            <label for="installmentEditInfoInput">Info</label>
                                            <textarea type="date"
                                                      class="form-control"
                                                      id="installmentEditInfoInput"
                                                      name="payment_info"
                                                      {% if bill.paid %}disabled{% endif %}
                                            >{{ bill.payment_info }}</textarea>
                                        </div>
                                        {% if bill.proof %}
                                            <div class="align-items-center d-flex mb-2">
                                                <img src="/static/assets/img/icons/extensions/1x/{{ bill.proof.name|file_extension_icon }}" alt="" style="height: 18px">
                                                <span class="ml-2 text-sm">{{ bill.proof|file_name_only_with_extension }}</span>
                                            </div>
                                        {% endif %}

                                    </form>
                                </div>
                                <div class="modal-footer pt-1">
                                    <button type="button" class="btn btn-secondary"
                                            data-dismiss="modal">Cancel
                                    </button>
                                    {% if bill.paid %}
                                        <button type="submit" class="btn btn-warning"
                                                id="paidConfirmButton{{ bill.id }}"
                                                form="paidConfirmForm{{ bill.id }}">
                                            Set as pending
                                        </button>
                                    {% else %}
                                        <button type="submit" class="btn btn-success"
                                                id="paidConfirmButton{{ bill.id }}"
                                                form="paidConfirmForm{{ bill.id }}">
                                            Set as paid
                                        </button>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Delete Modal -->
                    <div class="modal fade"
                         id="deleteConfirm{{ bill.id }}"
                         tabindex="-1"
                         role="dialog" aria-labelledby="deleteConfirmLabel{{ bill.id }}"
                         aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered" role="document">
                            <div class="modal-content">
                                <div class="modal-header mt-2">
                                    <h5 class="modal-title my-1" style="margin-left: auto">
                                        <i class="ni ni-fat-delete text-blue"
                                           style="font-size: 1.5rem; margin-top: 0.15rem !important"></i>
                                    </h5>
                                    <span class="ml-3 my-1"
                                          style="margin-right: auto; font-size: 1.2rem"
                                          id="deleteConfirmModalLabel{{ bill.id }}">Are you sure?</span>
                                    <button type="button" class="close mt--4"
                                            style="margin-left: -30px" data-dismiss="modal"
                                            aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body py-0"
                                     style="padding-left: 2.5rem; padding-right: 2.5rem">
                                    <p class="text-center">Are you sure you want to delete this
                                        bill?
                                        <br>
                                        This action cannot be undone.
                                    </p>
                                    <form method="post" id="deleteConfirmForm{{ bill.id }}"
                                          action="{% url 'delete_client_bill' client.slug bill.id %}" 
                                          onsubmit="disableByID('deleteConfirmButton{{ bill.id }}')">
                                        {% csrf_token %}
                                        <input type="hidden" value="{{ sorted_by }}" name="sort_by">
                                        <input type="hidden" value="{{ sort_type }}" name="sort_type">
                                        <input type="hidden" value="{{ filters }}" name="filters">
                                    </form>
                                    <div class="row">
                                        <div class="col form-group form-control-label mb-3">
                                            <label for="name">Title</label>
                                            <input class="form-control" id="name"
                                                   name="bill_name"
                                                   value="{{ bill.title }}" disabled>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col form-group form-control-label mb-3">
                                            <label for="beneficiary">Office</label>
                                            <input class="form-control" id="beneficiary"
                                                   name="bill_beneficiary"
                                                   value="{% if bill.office.company_name %}{{ bill.office.company_name }}{% else %}N/A{% endif %}" disabled>
                                        </div>
                                        <div class="col form-group form-control-label mb-3">
                                            <label for="category">Category</label>
                                            <input class="form-control" id="category"
                                                   name="bill_category"
                                                   value="{{ bill.category }}" disabled>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col form-group form-control-label">
                                            <label for="billTotalInfo">Total</label>
                                            <input inputmode="decimal"
                                                   class="form-control"
                                                   id="billTotalInfo"
                                                   name="bill_total" placeholder=""
                                                   value="{{ bill.total }}" disabled>
                                        </div>
                                        <div class="col form-group form-control-label">
                                            <label for="billDueDateInput{{ bill.id }}">Due
                                                date</label>
                                            <input type="date" class="form-control"
                                                   id="billDueDateInput{{ bill.id }}"
                                                   name="bill_due_date" placeholder=""
                                                   value="{{ bill.due_date|date:'Y-m-d' }}"
                                                   disabled>
                                        </div>
                                    </div>
                                    {% if bill.proofs.all %}
                                        {% for proof in bill.proofs.all %}
                                            <div class="align-items-center d-flex mb-2">
                                                <img src="/static/assets/img/icons/extensions/1x/{{ proof|file_extension_icon }}" alt="" style="height: 18px">
                                                <span class="ml-2 text-sm">{{ proof|file_name_only_with_extension }}</span>
                                            </div>
                                        {% endfor %}
                                    {% endif %}
                                </div>
                                <div class="modal-footer pt-1">
                                    <button type="button" class="btn btn-secondary"
                                            data-dismiss="modal">Cancel
                                    </button>
                                    <button type="submit" class="btn btn-danger"
                                            id="deleteConfirmButton{{ bill.id }}"
                                            form="deleteConfirmForm{{ bill.id }}">
                                        Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="card-footer py-1" style="border-top: 0 !important"></div>
    </div>

</div>
    
<!-- Footer -->
<div class="container-fluid">
    {% include "includes/footer.html" %}
</div>
    
<!--New Bill Modal -->
<div class="modal fade" id="newBillModal" tabindex="-1" role="dialog"
     aria-labelledby="newBillModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header mt-2 align-items-center">
                <h5 class="modal-title" style="margin-left: auto">
                    <i class="m-0 fas fa-plus text-blue" style="font-size: 1rem"></i>
                </h5>
                <span class="ml-3 my-1" style="margin-right: auto; font-size: 1.2rem"
                      id="newPageModalLabel">Bills</span>
                <button type="button" class="close mt--4" style="margin-left: -30px"
                        data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body py-0" style="padding-left: 2.5rem; padding-right: 2.5rem">
                <div class="wizard-container">
                    <div class="wizard-card" data-color="red" id="wizard">
                        <form id="newBillForm" method="post" action="{% url 'new_client_bill' client.slug %}"
                              enctype="multipart/form-data" 
                              onsubmit=disableByID('newBillButton')>
                            {% csrf_token %}
                            <input type="hidden" value="{{ sorted_by }}" name="sort_by">
                            <input type="hidden" value="{{ sort_type }}" name="sort_type">
                            <input type="hidden" value="{{ filters }}" name="filters">
                        
                            <div class="wizard-navigation">
                                <ul class="nav nav-pills m-auto" style="width: 70%">
                                    <li class="nav-item">
                                        <a class="nav-link text-center p-2 active" href="#billInfos" 
                                           data-toggle="tab" role="tab" aria-selected="false" disabled>
                                            Infos
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link text-center p-2" href="#billPayment"
                                           data-toggle="tab" role="tab" disabled>
                                            Payment
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        
                            <div class="tab-content pt-4 mt-2">
                                <div class="tab-pane active" id="billInfos">
                                    {# TITLE / CATEGORY #}
                                    <div class="row">
                                        <div class="col-6 form-group form-control-label mb-3">
                                            <label for="name">Title</label>
                                            <input class="form-control" id="name" name="title">
                                        </div>
                                        <div class="col-6 form-group form-control-label mb-3">
                                            <label for="category">Category</label>
                                            <select class="form-control" id="category" name="category">
                                                <option value=""></option>
                                                <optgroup label="Income (+)" class="text-green">
                                                    {% for category in income_categories %}
                                                        <option value="{{ category }}" class="text-dark">
                                                            {{ category|capfirst }}
                                                        </option>
                                                    {% endfor %}
                                                </optgroup>
                                                <optgroup label="Expense (-)" class="text-red">
                                                    {% for category in expense_categories %}
                                                        <option value="{{ category }}" class="text-dark">
                                                            {{ category|capfirst }}
                                                        </option>
                                                    {% endfor %}
                                                </optgroup>
                                            </select>
                                        </div>
                                    </div>
                                    {# OFFICE / REGIONAL #}
                                    <div class="row">
                                        <div class="col form-group form-control-label">
                                            <label for="beneficiary">Office</label>
                                            <select class="form-control" id="beneficiary" name="office_id">
                                                <option value=""></option>
                                                {% for office in offices %}
                                                    <option value="{{ office.id }}">{{ office.company_name }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        <div class="col-6 form-group form-control-label mb-3">
                                            <label for="payer">Regional</label>
                                            <select id="payer" name="payer_id" class="form-control">
                                                <option value=""></option>
                                                {% for payer in client.branches.all %}
                                                    <option value="{{ payer.id }}">{{ payer.name }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div> 
                                    {# ORIGIN / CODE #}
                                    <div class="row">
                                        <div class="col form-group form-control-label mb-3">
                                            <label for="origin">Origin</label>
                                            <select id="origin" name="origin" class="form-control">
                                                <option value=""></option>
                                                <option value="Individual">Individual</option>
                                                <option value="Sale">Sale</option>
                                                <option value="Service">Service</option>
                                            </select>
                                        </div>
                                        <div class="col form-group form-control-label mb-3">
                                            <label for="code">Code</label>
                                            <input class="form-control" id="code" name="code">
                                        </div>
                                    </div> 
                                    {# LINK #}
                                    <div class="row">
                                        <div class="col form-group form-control-label mb-3">
                                            <label for="link">Link</label>
                                            <input type="url" class="form-control" id="link" name="link">
                                        </div>
                                    </div> 
                                </div>
                            
                                <div class="tab-pane" id="billPayment">
                                    <div class="mt-2 form-group form-control-label align-items-center" style="display: flex">
                                        <label class="mb-0 mr-3">Installments</label>
                                        <label class="custom-toggle">
                                            <input type="checkbox" onchange="blockInstallmentsInputs()">
                                            <span class="custom-toggle-slider rounded-circle" data-label-off="No"
                                                  data-label-on="Yes"></span>
                                        </label>
                                    </div>
                                    {# ISSUE DATE / DUE DATE #}
                                    <div class="row">
                                        <div class="col form-group form-control-label">
                                            <label for="billIssueDateInput">Issue date</label>
                                            <input type="date" class="form-control"
                                                   id="billIssueDateInput"
                                                   onchange="enableByID('newBillButton')"
                                                   name="issue_date" required>
                                        </div>
                                        <div class="col form-group form-control-label">
                                            <label for="billDueDateInput">Due date</label>
                                            <input type="date" class="form-control"
                                                   id="billDueDateInput"
                                                   onchange="enableByID('newBillButton')"
                                                   name="due_date" required>
                                        </div>
                                    </div>
                                    {# INSTALLMENTS #}
                                    <div class="row">
                                        <div class="col-3 form-group form-control-label">
                                            <label for="billInstallmentsNumberMethodInput">NÂº</label>
                                            <select class="form-control" id="billInstallmentsNumberMethodInput"
                                                    name="installments" disabled>
                                                <script>
                                                    for (let i = 1; i <= 24; i++) {
                                                        document.write(`<option value="${i}">${i}x</option>`);
                                                    }
                                                </script>
                                            </select>
                                        </div>
                                        <div class="col-5 form-group form-control-label">
                                            <label for="billInstallmentsValueInput">Value</label>
                                            <input inputmode="decimal" class="form-control"
                                                   id="billInstallmentsValueInput"
                                                   name="installments_value" placeholder="" disabled>
                                        </div>
                                        <div class="col-4 form-group form-control-label">
                                            <label for="billInstallmentsFrequencyInput">Frequency</label>
                                            <div class="input-group input-group-merge">
                                                <input inputmode="decimal" class="form-control"
                                                       id="billInstallmentsFrequencyInput"
                                                       name="installments_frequency" placeholder="" disabled>
                                                <div class="input-group-append">
                                                    <span class="input-group-text" id="billInstallmentsFrequencyInputAppend" style="background-color: #f1f1f1;">days</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    {# TOTAL / CURRENCY / METHOD #}
                                    <div class="row">
                                        <div class="col form-group form-control-label mb-3"
                                             style="flex: 0 0 20%; max-width: 20%">
                                            <label for="currency">Currency</label>
                                            <select class="form-control" id="currency" name="currency">
                                                <option value="BRL">BRL</option>
                                                {#<option value="USD">USD</option>#}
                                                {#<option value="EUR">EUR</option>#}
                                            </select>
                                        </div>
                                        <div class="col form-group form-control-label">
                                            <label for="valueInput">Total</label>
                                            <input inputmode="decimal" class="form-control" 
                                                   id="valueInput" name="total">
                                        </div>
                                        <div class="col form-group form-control-label">
                                            <label for="billMethodInput">Method</label>
                                            <select class="form-control" id="billMethodInput" name="method">
                                                <option value=""></option>
                                                <option value="Bank slip">Bank slip</option>
                                                <option value="Pix">Pix</option>
                                                <option value="Transfer">Transfer</option>
                                                <option value="Credit card">Credit card</option>
                                            </select>
                                        </div>
                                    </div>
                                    {# PROOF #}
                                    <div class="form-group form-control-label my-3">
                                        <input type="file" id="documentInput" style="display: none" name="proofs" multiple>
                                        <label for="documentInput" id="fileInputLabel" class="justify-content-center d-flex">
                                            <span class="btn btn-sm btn-neutral align-items-center" style="width: 100%">
                                                Attach proof
                                            </span>
                                        </label>
                                    </div>
                                </div>
                                
                            </div>
                        </form>
                        <div class="wizard-footer card-footer border-0 mb-2">
                            <div class="row">
                                <div class="mr-auto">
                                    <button type="button" class="btn btn-secondary ml--2" data-dismiss="modal">Cancel</button>
                                </div>
                                <div class="ml-auto">
                                    <input type="button"
                                           class="btn btn-previous btn-fill btn-secondary btn-wd ml--2 disabled"
                                           name="previous" value="Previous" style="display: none;">
                                    <input type="button" class="btn btn-next btn-fill btn-primary btn-wd mr--2"
                                           name="next"
                                           value="Next">
                                    <button type="submit" class="btn btn-finish btn-fill btn-primary btn-wd mr--2"
                                            name="finish" form="newBillForm" id="newBillButton"
                                            value="Finish" style="display: none;">
                                        Submit
                                    </button>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
    
<!-- Filter Documents Modal -->
<div aria-hidden="true" aria-labelledby="filterBillModalLabel" class="modal fade" id="filterBillModal"
     role="dialog" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header mt-2 align-items-center">
                <h5 class="modal-title" style="margin-left: auto">
                    <i class="ni ni-ui-04 text-blue" style="font-size: 1.5rem"></i>
                </h5>
                <span class="ml-3 my-1" style="margin-right: auto; font-size: 1.2rem"
                      id="filterModalLabel">Filter</span>
                <button type="button" class="close mt--4" style="margin-left: -30px"
                        data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body py-0" style="padding-left: 2.5rem; padding-right: 2.5rem">
                <form id="filterForm" method="post" action="{% url 'filter_client_balance' client.slug %}" 
                      onsubmit="disableByID('filterButton')">
                    {% csrf_token %}
                    <input type="hidden" name="sort_by" value="{{ sorted_by }}">
                    <input type="hidden" name="sort_type" value="{{ sort_type }}">

                    {# PAYER | OFFICE #}
                    <div class="row">
                        <div class="col-sm-6 form-group form-control-label">
                            <label for="payerFilter">Regional</label>
                            <select class="form-control" id="payerFilter" name="payer">
                                <option value=""></option>
                                {% for payer in client.branches.all %}
                                    <option value="{{ payer.id }}"
                                            {% if filters|extract_from_key:'payer' == payer.id %}selected{% endif %}>
                                        {{ payer.name }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-sm-6 form-group form-control-label">
                            <label for="officeFilter">Office</label>
                            <select class="form-control" id="officeFilter" name="office">
                                <option value=""></option>
                                {% for office in offices %}
                                    <option value="{{ office.id }}"
                                            {% if filters|extract_from_key:'office' == office.id %}selected{% endif %}>{{ office.company_name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    {# FROM | TO #}
                    <div class="row">
                        <div class="col-6 form-group form-control-label">
                            <label for="startDateFilter">From</label>
                            <input type="date" class="form-control"
                                   id="startDateFilter"
                                   name="from"
                                   value="{% if 'from=' in filters %}{{ filters|extract_from_key:'from' }}{% else %}{% endif %}">
                        </div>
                        <div class="col-6 form-group form-control-label">
                            <label for="endDateFilter">To</label>
                            <input type="date" class="form-control"
                                   id="endDateFilter"
                                   name="to"
                                   value="{% if 'to=' in filters %}{{ filters|extract_from_key:'to' }}{% else %}{% endif %}">
                        </div>
                    </div>
                    {# CATEGORY | ORIGIN | METHOD #}
                    <div class="row">
                        <div class="col-sm form-group form-control-label">
                            <label for="categoryFilter">Category</label>
                            <select class="form-control" id="categoryFilter" name="category" aria-selected="income">
                                <option value=""></option>
                                <option value="income"
                                        {% if filters|extract_from_key:'category' == 'income' %}selected{% endif %}>
                                    All Income
                                </option>
                                <option value="expense"
                                        {% if filters|extract_from_key:'category' == 'expense' %}selected{% endif %}>
                                    All Expense
                                </option>
                                <optgroup label="Income (+)" class="text-green">
                                    {% for category in income_categories %}
                                        <option value="{{ category }}" class="text-dark" {% if filters|extract_from_key:'category' == category %}selected{% endif %}>
                                            {{ category|capfirst }}
                                        </option>
                                    {% endfor %}
                                </optgroup>
                                <optgroup label="Expense (-)" class="text-red">
                                    {% for category in expense_categories %}
                                        <option value="{{ category }}" class="text-dark" {% if filters|extract_from_key:'category' == category %}selected{% endif %}>
                                            {{ category|capfirst }}
                                        </option>
                                    {% endfor %}
                                </optgroup>
                            </select>
                        </div>
                        <div class="col-sm form-group form-control-label mb-3">
                            <label for="origin">Origin</label>
                            <select id="origin" name="origin" class="form-control">
                                <option value=""></option>
                                <option value="Individual" {% if filters|extract_from_key:'origin' == 'Individual' %}selected{% endif %}>Individual</option>
                                <option value="Sale" {% if filters|extract_from_key:'origin' == 'Sale' %}selected{% endif %}>Sale</option>
                                <option value="Service" {% if filters|extract_from_key:'origin' == 'Service' %}selected{% endif %}>Service</option>
                            </select>
                        </div>
                        <div class="col-sm form-group form-control-label">
                            <label for="methodFilter">Method</label>
                            <select class="form-control" id="methodFilter" name="method">
                                {% if 'method=' in filters %}
                                    {% with method_from_filter=filters|extract_from_key:'method' %}
                                        <option value=""></option>
                                        <option value="bank-slip"
                                                {% if method_from_filter == 'bank-slip' %}selected{% endif %}>Bank
                                            slip
                                        </option>
                                        <option value="pix" {% if method_from_filter == 'pix' %}selected{% endif %}>
                                            Pix
                                        </option>
                                        <option value="transfer"
                                                {% if method_from_filter == 'transfer' %}selected{% endif %}>
                                            Transfer
                                        </option>
                                        <option value="credit-card"
                                                {% if method_from_filter == 'credit-card' %}selected{% endif %}>
                                            Credit card
                                        </option>
                                    {% endwith %}
                                {% else %}
                                    <option value=""></option>
                                    <option value="bank-slip">Bank slip</option>
                                    <option value="pix">Pix</option>
                                    <option value="transfer">Transfer</option>
                                    <option value="credit-card">Credit card</option>
                                {% endif %}
                            </select>
                        </div>
                    </div>
                    {# INSTALLMENTS | CODE #}
                    <div class="row">
                        <div class="col-6 form-group form-control-label">
                            <label for="installmentsFilter">Installments</label>
                            <select id="installmentsFilter" class="form-control" name="installments">
                                <option value=""></option>
                                <option value="true" {% if filters|extract_from_key:'installments' == 'true' %}selected{% endif %}>
                                    With installments
                                </option>
                                <option value="false" {% if filters|extract_from_key:'installments' == 'false' %}selected{% endif %}>
                                    Without installments
                                </option>
                            </select>
                        </div>
                        <div class="col-6 form-group form-control-label">
                            <label for="codeFilter">Code</label>
                            <select id="codeFilter" class="form-control" name="code">
                                <option value=""></option>
                                <option value="code" {% if filters|extract_from_key:'code' == 'code' %}selected{% endif %}>
                                    Code
                                </option>
                                <option value="link" {% if filters|extract_from_key:'code' == 'link' %}selected{% endif %}>
                                    Link
                                </option>
                                <option value="both" {% if filters|extract_from_key:'code' == 'both' %}selected{% endif %}>
                                    Link + Code
                                </option>
                            </select>
                        </div>
                    </div>
                    {# STATUS #}
                    <label class="form-control-label">Status</label>
                    <div class="mt-2 form-group align-items-center" style="display: flex">
                        <label class="mb-0 mr-2" style="font-size: 0.875rem">Late</label>
                        <label class="custom-toggle custom-toggle-danger mr-4">
                            <input type="checkbox"
                                   {% if filters|extract_from_key:'late' == 'false' %}{% else %}checked=""{% endif %}
                                   name="late_filter">
                            <span class="custom-toggle-slider rounded-circle" data-label-off="No"
                                  data-label-on="Yes"></span>
                        </label>
                        <label class="mb-0 mr-2" style="font-size: 0.875rem">Paid</label>
                        <label class="custom-toggle custom-toggle-success mr-4">
                            <input type="checkbox"
                                   {% if filters|extract_from_key:'paid' == 'false' %}{% else %}checked=""{% endif %}
                                   name="paid_filter">
                            <span class="custom-toggle-slider rounded-circle" data-label-off="No"
                                  data-label-on="Yes"></span>
                        </label>
                        <label class="mb-0 mr-2" style="font-size: 0.875rem">Pending</label>
                        <label class="custom-toggle custom-toggle-info">
                            <input type="checkbox"
                                   {% if filters|extract_from_key:'pending' == 'false' %}{% else %}checked=""{% endif %}
                                   name="pending_filter">
                            <span class="custom-toggle-slider rounded-circle" data-label-off="No"
                                  data-label-on="Yes"></span>
                        </label>
                    </div>
                    {# TOTAL #}
                    <div class="form-group form-control-label">
                        <label for="valueFilter">Total</label>
                        <div id="input-slider-range" data-range-value-min="{% if 'value_min' in filters %}{{ filters|extract_from_key:'value_min' }}{% else %}{{ min_value }}{% endif %}"
                             data-range-value-max="{% if 'value_max' in filters %}{{ filters|extract_from_key:'value_max' }}{% else %}{{ max_value }}{% endif %}">
                        </div>
                        <div class="row">
                            <div class="col-6">
                                <span class="range-slider-value value-low"
                                      data-range-value-low="{% if 'value_min' in filters %}{{ filters|extract_from_key:'value_min' }}{% else %}{{ min_value }}{% endif %}"
                                      id="input-slider-range-value-low"></span>
                            </div>
                            <div class="col-6 text-right">
                                <span class="range-slider-value value-high"
                                      data-range-value-high="{% if 'value_max' in filters %}{{ filters|extract_from_key:'value_max' }}{% else %}{{ max_value }}{% endif %}"
                                      id="input-slider-range-value-high"></span>
                            </div>
                        </div>
                        <input type="hidden" id="rangeValueLowInput" name="range_value_low">
                        <input type="hidden" id="rangeValueHighInput" name="range_value_high">
                    </div>
                </form>

                <form action="{% url 'sort_client_balance' client.slug %}" method="post" id="unfilterForm" 
                      onsubmit="disableByID('unfilterButton')">
                    {% csrf_token %}
                    <input type="hidden" value="{{ sorted_by }}" name="sort_by">
                    {% if sort_type == 'asc' %}
                        <input type="hidden" value="True" name="asc">
                    {% elif sort_type == 'desc' %}
                        <input type="hidden" value="True" name="desc">
                    {% endif %}
                </form>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">
                    Cancel
                </button>
                {% if filters and sorted_by %}
                    <button type="submit" class="btn btn-danger" id="unfilterButton" form="unfilterForm">
                        Unfilter
                    </button>
                {% elif filters %}
                    <a href="{% url 'client_balance' client.slug %}" class="btn btn-danger">
                        Unfilter
                    </a>
                {% endif %}
                <button type="submit" class="btn btn-primary" id="filterButton" form="filterForm">
                    Filter
                </button>
            </div>
        </div>
    </div>
</div>
    
<!-- Sort Bills Modal -->
<div class="modal fade" id="sortBillModal" tabindex="-1" role="dialog"
     aria-labelledby="sortBillModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header mt-2 align-items-center">
                <h5 class="modal-title" style="margin-left: auto">
                    <i class="ni ni-bullet-list-67 text-blue" style="font-size: 1.4rem"></i>
                </h5>
                <span class="ml-3 my-1" style="margin-right: auto; font-size: 1.2rem"
                      id="sortBillModalLabel">Sort</span>
                <button type="button" class="close mt--4" style="margin-left: -30px"
                        data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body py-0" style="padding-left: 2.5rem; padding-right: 2.5rem">
                <form id="sortForm" method="post" action="{% url 'sort_client_balance' client.slug %}" 
                      onsubmit="disableByID('sortButton')">
                    {% csrf_token %}
                    <input type="hidden" name="filters" value="{{ filters }}">
                    <label class="form-control-label" for="sortByModalInput">Data</label>
                    <div class="row">
                        <div class="col-8 form-group form-control-label">
                            <select class="form-control" id="sortByModalInput" name="sort_by"
                                    onchange="clearChks(this)">
                                <option value=""></option>
                                <option value="category" {% if sorted_by == 'category' %} selected {% endif %}>
                                    Category
                                </option>
                                <option value="code" {% if sorted_by == 'code' %} selected {% endif %}>
                                    Code
                                </option>
                                <option value="date" {% if sorted_by == 'date' %} selected {% endif %}>
                                    Date
                                </option>
                                <option value="expiration" {% if sorted_by == 'expiration' %} selected {% endif %}>
                                    Expiration
                                </option>
                                <option value="installments_number" {% if sorted_by == 'installments_number' %}
                                        selected {% endif %}>
                                    Installments number
                                </option>
                                <option value="method" {% if sorted_by == 'method' %} selected {% endif %}>
                                    Method
                                </option>
                                <option value="office" {% if sorted_by == 'office' %} selected {% endif %}>
                                    Office
                                </option>
                                <option value="origin" {% if sorted_by == 'origin' %} selected {% endif %}>
                                    Origin
                                </option>
                                <option value="payer" {% if sorted_by == 'payer' %} selected {% endif %}>
                                    Regional
                                </option>
                                <option value="title" {% if sorted_by == 'title' %} selected {% endif %}>
                                    Title
                                </option>
                                <option value="total" {% if sorted_by == 'total' %} selected {% endif %}>
                                    Total
                                </option>
                            </select>
                        </div>
                        <div class="col-4 form-group align-items-center" style="display: flex">
                            <div class="custom-control custom-checkbox custom-checkbox-primary mr-4">
                                <input class="custom-control-input" id="chk-asc" type="checkbox" name="asc"
                                        {% if sort_type == 'asc' %} checked {% endif %}
                                       onclick="changeAscDesc(event)">
                                <label class="custom-control-label" for="chk-asc">ASC</label>
                            </div>
                            <div class="custom-control custom-checkbox custom-checkbox-primary">
                                <input class="custom-control-input" id="chk-desc" type="checkbox" name="desc"
                                        {% if sort_type == 'desc' %} checked {% endif %}
                                       onclick="changeAscDesc(event)">
                                <label class="custom-control-label" for="chk-desc">DESC</label>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer  pt-1">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary" id="sortButton" form="sortForm">
                    Sort
                </button>
            </div>
        </div>
    </div>
</div>
    
{% for bill in bills.all %}
    {% for proof in bill.proofs.all %}
        <!-- Delete Proof Confirm -->
        <div class="modal fade"
             id="deleteProofConfirmModal{{ proof.id }}"
             tabindex="-1" role="dialog" 
             aria-labelledby="deleteProofConfirmModal{{ proof.id }}Label"
             aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document" style="max-width: 400px">
                <div class="modal-content">
                    <div class="modal-header mt-2">
                        <h5 class="modal-title my-1" style="margin-left: auto">
                            <i class="ni ni-fat-delete text-blue"
                               style="font-size: 1.5rem; margin-top: 0.15rem !important"></i>
                        </h5>
                        <span class="ml-3 my-1"
                              style="margin-right: auto; font-size: 1.2rem"
                              id="deleteProofConfirmModal{{ proof.id }}Label">Are you sure?</span>
                        <a href="#" class="close mt--4"
                                style="margin-left: -30px" data-dismiss="modal"
                                data-toggle="modal" data-target="#editProofsModal{{ bill.id }}"
                                aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </a>
                    </div>
                    <div class="modal-body py-0"
                         style="padding-left: 2.5rem; padding-right: 2.5rem">
                        <p class="text-center">Are you sure you want to delete this
                            proof?
                            <br>
                            This action cannot be undone.
                        </p>
                        <div class="row align-items-center justify-content-center my-3 py-3">
                            <div class="col-auto">
                                <div class="avatar">
                                    <img class="avatar-img rounded bg-white" alt="..." 
                                         src="/static/assets/img/icons/extensions/1x/{{ proof.file.name|file_extension_icon }}">
                                </div>
                            </div>
                            <div class="col-auto pl-0">
                                <h4 class="mb-1">{{ proof.file.name|file_name_only_with_extension }}</h4>
                                <p class="small text-muted mb-0">{{ proof.file.size|filesizeformat }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer pt-1">
                        <a href="#" data-dismiss="modal" data-toggle="modal"
                           data-target="#editProofsModal{{ proof.bill.id }}"
                           class="btn btn-secondary">
                            Cancel
                        </a>
                        <a href="{% url 'delete_client_bill_proof' client.slug proof.id %}#proofs{{ proof.bill.id }}" class="btn btn-danger"
                           id="deleteProofConfirmButton{{ proof.id }}" 
                           onclick="disableByID('deleteProofConfirmButton{{ proof.id }}')">
                            Delete
                        </a>
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}
{% endfor %}

{% endblock content %}

<!-- Specific JS goes HERE -->
{% block javascripts %}

    <script src="/static/assets/js/wizard.js"></script>
    
    <script src="/static/assets/vendor/clipboard/dist/clipboard.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/5.0.6/jquery.inputmask.min.js"></script>

    <script src="/static/assets/vendor/nouislider/distribute/nouislider.min.js"></script>

    <script src="/static/assets/vendor/dropzone/dist/min/dropzone.min.js"></script>
    
    <script>

        function blockInstallmentsInputs() {
            let installmentsNumber = document.getElementById("billInstallmentsNumberMethodInput");
            let installmentsValue = document.getElementById("billInstallmentsValueInput");
            let installmentsFrequency = document.getElementById("billInstallmentsFrequencyInput");
            let installmentsFrequencyAppend = document.getElementById("billInstallmentsFrequencyInputAppend");
            let totalValue = document.getElementById("valueInput");
            let dueDate = document.getElementById("billDueDateInput");

            if (installmentsNumber.disabled === true) {
                installmentsNumber.disabled = false;
                installmentsValue.disabled = false;
                installmentsFrequency.disabled = false;
                installmentsFrequencyAppend.style.backgroundColor = "#ffffff";
                totalValue.disabled = true;
                totalValue.value = '';
                dueDate.value = '';
                dueDate.disabled = true;
                dueDate.required = false;
            } else {
                installmentsNumber.disabled = true;
                installmentsNumber.value = 1;
                installmentsValue.disabled = true;
                installmentsValue.value = '';
                installmentsFrequency.disabled = true;
                installmentsFrequency.value = '';
                installmentsFrequencyAppend.style.backgroundColor = "#f1f1f1";
                totalValue.disabled = false;
                dueDate.disabled = false;
                dueDate.required = true;
            }
        }

        function submitCheckboxForm(form) {
            document.getElementById(form).submit();
        }

        function changeAscDesc(event) {
            let chkAsc = document.getElementById("chk-asc");
            let chkDesc = document.getElementById("chk-desc");

            if (event.target.id === "chk-asc" && chkAsc.checked) {
                chkDesc.checked = false;
            } else if (event.target.id === "chk-desc" && chkDesc.checked) {
                chkAsc.checked = false;
            }
        }

        function clearChks(selectObject) {
            let chkAsc = document.getElementById("chk-asc");
            let chkDesc = document.getElementById("chk-desc");
            let optionValue = selectObject.value

            if (optionValue === '') {
                chkAsc.checked = false;
                chkDesc.checked = false;
            } else if (chkAsc.checked === false && chkDesc.checked === false) {
                chkDesc.checked = true;
            }
        }

        function copyToClipboard(element, link) {
            navigator.clipboard.writeText(element).then(function () {
                // Update the tooltip title using Bootstrap Tooltip method
                $(link).attr('data-original-title', 'Copied!').tooltip('show');
            }).catch(function (err) {
                console.error('Unable to copy to clipboard', err);
            });
        }

        function clearTitle(element, link) {
            $(link).attr('data-original-title', element).tooltip('hide');
        }

        function updateFileName(event, id = 0) {
            const fileInput = event.target;
            let fileInputLabel;
            if (id > 0) {
                fileInputLabel = document.getElementById(`fileInputLabel${id}`);
                console.log('fileInputLabel', fileInputLabel)
            } else {
                fileInputLabel = document.getElementById('fileInputLabel');
                console.log('fileInputLabel', fileInputLabel)
            }

            if (fileInput.files.length === 0) {
                fileInputLabel.textContent = 'Attach proof';
                fileInputLabel.classList.remove('btn-success');
                fileInputLabel.classList.add('btn');
                fileInputLabel.classList.add('btn-sm');
                fileInputLabel.classList.add('btn-neutral');
            } else if (fileInput.files.length === 1) {
                const fileName = fileInput.files[0].name;
                if (fileName.length > 60) {
                    fileInputLabel.textContent = fileName.slice(':60') + '...';
                } else {
                    fileInputLabel.textContent = fileName;
                }
                fileInputLabel.classList.remove('btn-neutral');
                fileInputLabel.classList.add('btn');
                fileInputLabel.classList.add('btn-sm');
                fileInputLabel.classList.add('btn-success');
            } else {
                fileInputLabel.textContent = 'Loaded ' + fileInput.files.length + ' files';
                fileInputLabel.classList.remove('btn-neutral');
                fileInputLabel.classList.add('btn');
                fileInputLabel.classList.add('btn-sm');
                fileInputLabel.classList.add('btn-success');
            }
        }
            
        $('[id^="documentChangeInput"]').each(function () {
            document.getElementById(this.id).addEventListener(
                'change', () => updateFileName(event, this.id.split('documentChangeInput')[1])
            );
        });
        
        document.getElementById('documentInput').addEventListener('change', updateFileName)

    </script>

    <script>
    
        // Input Mask for Currency //
        $(document).ready(function () {
            function setupInput(input) {
                input.inputmask({
                    alias: "numeric",
                    radixPoint: ",",
                    groupSeparator: ".",
                    autoGroup: true,
                    rightAlign: false,
                    autoUnmask: true,
                    numericInput: true,
                    prefix: "",
                });
            }

            setupInput($("#valueInput"));
            setupInput($("#billInstallmentsValueInput"));
            
            $('[id^="valueInputDetails"]').each(function () {
                setupInput($(this));
            });
            
            $('[id^="billInstallmentsValueInputDetails"]').each(function () {
                setupInput($(this));
            });
            
            $('[id^="installment_value_"]').each(function () {
                setupInput($(this));
            });
        });
    
        // Filter Slider Configuration //
        document.addEventListener('DOMContentLoaded', function () {
            let slider = document.getElementById('input-slider-range');
            let lowValue = document.getElementById('input-slider-range-value-low');
            let highValue = document.getElementById('input-slider-range-value-high');
            let rangeValueLowInput = document.getElementById('rangeValueLowInput');
            let rangeValueHighInput = document.getElementById('rangeValueHighInput');

            slider.noUiSlider.on('update', function (values, handle) {
                if (handle === 0) {
                    lowValue.textContent = values[0];
                } else {
                    highValue.textContent = values[1];
                }

                rangeValueLowInput.value = values[0];
                rangeValueHighInput.value = values[1];
            });
        });

        // Installments Collapses Animation //
        document.addEventListener('DOMContentLoaded', function () {
            let collapseElements = document.querySelectorAll('[data-toggle="collapse"]');

            collapseElements.forEach(function (element) {
                element.addEventListener('click', function (event) {
                    let target = document.querySelector(this.getAttribute('data-target'));
                    let icon = this.querySelector('.rotate');

                    if (target.classList.contains('show')) {
                        icon.classList.remove('down');
                    } else {
                        icon.classList.add('down');
                    }
                });
            });
        });
        
        // Auto Modal Open //
        document.addEventListener("DOMContentLoaded", function() {
            const completeArg = window.location.hash.substring(1);
            
            if (completeArg.startsWith('proofs')) {
                let billId = completeArg.slice(6, window.location.hash.length);
                const modal = document.getElementById('editProofsModal' + billId);
                let bsModal = new bootstrap.Modal(modal);
                bsModal.show();
            } else {
                let argList = completeArg.slice(4, window.location.hash.length).split('&');
                let billId = argList[0];
                let installmentId = argList[1];

                if (billId && installmentId) {
                    const accordion = document.getElementById('collapseDetails' + billId);
                    const modal = document.getElementById('editInstallment' + installmentId);
                    let bsModal = new bootstrap.Modal(modal);
                    accordion.classList.add('show');
                    accordion.focus();
                    bsModal.show();
                } else if (billId) {
                    const modal = document.getElementById('detailsBillModal' + billId);
                    let bsModal = new bootstrap.Modal(modal);
                    bsModal.show();
                }
            }
        });
        
    </script>

{% endblock javascripts %}
